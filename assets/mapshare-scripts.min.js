$=jQuery.noConflict(!0),function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e(t.L={})}(this,function(t){"use strict";function h(t){for(var e,i,n=1,o=arguments.length;n<o;n++)for(e in i=arguments[n])t[e]=i[e];return t}function p(t,e){var i=Array.prototype.slice;if(t.bind)return t.bind.apply(t,i.call(arguments,1));var n=i.call(arguments,2);return function(){return t.apply(e,n.length?n.concat(i.call(arguments)):arguments)}}function r(t){return t._leaflet_id=t._leaflet_id||++Gt,t._leaflet_id}function e(t,e,i){var n,o,s,a=function(){n=!1,o&&(s.apply(i,o),o=!1)};return s=function(){n?o=arguments:(t.apply(i,arguments),setTimeout(a,e),n=!0)}}function i(t,e,i){var n=e[1],o=e[0],e=n-o;return t===n&&i?t:((t-o)%e+e)%e+o}function l(){return!1}function n(t,e){e=Math.pow(10,void 0===e?6:e);return Math.round(t*e)/e}function o(t){return t.trim?t.trim():t.replace(/^\s+|\s+$/g,"")}function c(t){return o(t).split(/\s+/)}function s(t,e){for(var i in t.hasOwnProperty("options")||(t.options=t.options?Wt(t.options):{}),e)t.options[i]=e[i];return t.options}function a(t,e,i){var n,o=[];for(n in t)o.push(encodeURIComponent(i?n.toUpperCase():n)+"="+encodeURIComponent(t[n]));return(e&&-1!==e.indexOf("?")?"&":"?")+o.join("&")}function u(t,i){return t.replace(qt,function(t,e){e=i[e];if(void 0===e)throw new Error("No value provided for variable "+t);return e="function"==typeof e?e(i):e})}function d(t,e){for(var i=0;i<t.length;i++)if(t[i]===e)return i;return-1}function _(t){return window["webkit"+t]||window["moz"+t]||window["ms"+t]}function m(t){var e=+new Date,i=Math.max(0,16-(e-$t));return $t=e+i,window.setTimeout(t,i)}function x(t,e,i){if(!i||Kt!==m)return Kt.call(window,p(t,e));t.call(e)}function f(t){t&&Xt.call(window,t)}function g(){}function y(t,e,i){this.x=i?Math.round(t):t,this.y=i?Math.round(e):e}function v(t,e,i){return t instanceof y?t:Vt(t)?new y(t[0],t[1]):null==t?t:"object"==typeof t&&"x"in t&&"y"in t?new y(t.x,t.y):new y(t,e,i)}function w(t,e){if(t)for(var i=e?[t,e]:t,n=0,o=i.length;n<o;n++)this.extend(i[n])}function b(t,e){return!t||t instanceof w?t:new w(t,e)}function T(t,e){if(t)for(var i=e?[t,e]:t,n=0,o=i.length;n<o;n++)this.extend(i[n])}function P(t,e){return t instanceof T?t:new T(t,e)}function k(t,e,i){if(isNaN(t)||isNaN(e))throw new Error("Invalid LatLng object: ("+t+", "+e+")");this.lat=+t,this.lng=+e,void 0!==i&&(this.alt=+i)}function M(t,e,i){return t instanceof k?t:Vt(t)&&"object"!=typeof t[0]?3===t.length?new k(t[0],t[1],t[2]):2===t.length?new k(t[0],t[1]):null:null==t?t:"object"==typeof t&&"lat"in t?new k(t.lat,"lng"in t?t.lng:t.lon,t.alt):void 0===e?null:new k(t,e,i)}function C(t,e,i,n){if(Vt(t))return this._a=t[0],this._b=t[1],this._c=t[2],void(this._d=t[3]);this._a=t,this._b=e,this._c=i,this._d=n}function E(t,e,i,n){return new C(t,e,i,n)}function S(t){return document.createElementNS("http://www.w3.org/2000/svg",t)}function z(t,e){for(var i,n,o,s,a="",r=0,h=t.length;r<h;r++){for(i=0,n=(o=t[r]).length;i<n;i++)a+=(i?"L":"M")+(s=o[i]).x+" "+s.y;a+=e?Ue?"z":"x":""}return a||"M0 0"}function B(t){return 0<=navigator.userAgent.toLowerCase().indexOf(t)}function I(t,e,i,n){return"touchstart"===e?(r=t,h=i,l=n,c=p(function(t){if("mouse"!==t.pointerType&&t.MSPOINTER_TYPE_MOUSE&&t.pointerType!==t.MSPOINTER_TYPE_MOUSE){if(!(qe.indexOf(t.target.tagName)<0))return;ft(t)}O(t,h)}),r["_leaflet_touchstart"+l]=c,r.addEventListener(Fe,c,!1),Ye||(document.documentElement.addEventListener(Fe,N,!0),document.documentElement.addEventListener(He,A,!0),document.documentElement.addEventListener(We,Z,!0),document.documentElement.addEventListener(Ge,Z,!0),Ye=!0)):"touchmove"===e?(a=i,(c=t)["_leaflet_touchmove"+n]=u,c.addEventListener(He,u,!1)):"touchend"===e&&(s=i,(t=t)["_leaflet_touchend"+n]=o,t.addEventListener(We,o,!1),t.addEventListener(Ge,o,!1)),this;function o(t){O(t,s)}var s,a,r,h,l,c;function u(t){(t.pointerType!==t.MSPOINTER_TYPE_MOUSE&&"mouse"!==t.pointerType||0!==t.buttons)&&O(t,a)}}function N(t){Ve[t.pointerId]=t,$e++}function A(t){Ve[t.pointerId]&&(Ve[t.pointerId]=t)}function Z(t){delete Ve[t.pointerId],$e--}function O(t,e){for(var i in t.touches=[],Ve)t.touches.push(Ve[i]);t.changedTouches=[t],e(t)}function D(t,o,e){function i(t){var e,i;if(Ae){if(!me||"mouse"===t.pointerType)return;i=$e}else i=t.touches.length;1<i||(i=(e=Date.now())-(s||e),a=t.touches?t.touches[0]:t,r=0<i&&i<=250,s=e)}function n(t){if(r&&!a.cancelBubble){if(Ae){if(!me||"mouse"===t.pointerType)return;var e,i,n={};for(i in a)e=a[i],n[i]=e&&e.bind?e.bind(a):e;a=n}a.type="dblclick",o(a),s=null}}var s,a,r=!1;return t[Je+Ke+e]=i,t[Je+Xe+e]=n,t[Je+"dblclick"+e]=o,t.addEventListener(Ke,i,!1),t.addEventListener(Xe,n,!1),t.addEventListener("dblclick",o,!1),this}function R(t,e){var i=t[Je+Ke+e],n=t[Je+Xe+e],e=t[Je+"dblclick"+e];return t.removeEventListener(Ke,i,!1),t.removeEventListener(Xe,n,!1),me||t.removeEventListener("dblclick",e,!1),this}function U(t){return"string"==typeof t?document.getElementById(t):t}function j(t,e){var i=t.style[e]||t.currentStyle&&t.currentStyle[e];return"auto"===(i=(!i||"auto"===i)&&document.defaultView?(t=document.defaultView.getComputedStyle(t,null))?t[e]:null:i)?null:i}function F(t,e,i){t=document.createElement(t);return t.className=e||"",i&&i.appendChild(t),t}function H(t){var e=t.parentNode;e&&e.removeChild(t)}function W(t){for(;t.firstChild;)t.removeChild(t.firstChild)}function G(t){var e=t.parentNode;e&&e.lastChild!==t&&e.appendChild(t)}function q(t){var e=t.parentNode;e&&e.firstChild!==t&&e.insertBefore(t,e.firstChild)}function V(t,e){if(void 0!==t.classList)return t.classList.contains(e);t=X(t);return 0<t.length&&new RegExp("(^|\\s)"+e+"(\\s|$)").test(t)}function Y(t,e){var i;if(void 0!==t.classList)for(var n=c(e),o=0,s=n.length;o<s;o++)t.classList.add(n[o]);else V(t,e)||K(t,((i=X(t))?i+" ":"")+e)}function $(t,e){void 0!==t.classList?t.classList.remove(e):K(t,o((" "+X(t)+" ").replace(" "+e+" "," ")))}function K(t,e){void 0===t.className.baseVal?t.className=e:t.className.baseVal=e}function X(t){return void 0===(t=t.correspondingElement?t.correspondingElement:t).className.baseVal?t.className:t.className.baseVal}function J(t,e){"opacity"in t.style?t.style.opacity=e:"filter"in t.style&&function(t,e){var i=!1,n="DXImageTransform.Microsoft.Alpha";try{i=t.filters.item(n)}catch(t){if(1===e)return}e=Math.round(100*e),i?(i.Enabled=100!==e,i.Opacity=e):t.style.filter+=" progid:"+n+"(opacity="+e+")"}(t,e)}function Q(t){for(var e=document.documentElement.style,i=0;i<t.length;i++)if(t[i]in e)return t[i];return!1}function tt(t,e,i){e=e||new y(0,0);t.style[Qe]=(Ce?"translate("+e.x+"px,"+e.y+"px)":"translate3d("+e.x+"px,"+e.y+"px,0)")+(i?" scale("+i+")":"")}function et(t,e){t._leaflet_pos=e,ze?tt(t,e):(t.style.left=e.x+"px",t.style.top=e.y+"px")}function it(t){return t._leaflet_pos||new y(0,0)}function nt(){lt(window,"dragstart",ft)}function ot(){ct(window,"dragstart",ft)}function st(t){for(;-1===t.tabIndex;)t=t.parentNode;t.style&&(at(),ni=(ii=t).style.outline,t.style.outline="none",lt(window,"keydown",at))}function at(){ii&&(ii.style.outline=ni,ni=ii=void 0,ct(window,"keydown",at))}function rt(t){for(;!((t=t.parentNode).offsetWidth&&t.offsetHeight||t===document.body););return t}function ht(t){var e=t.getBoundingClientRect();return{x:e.width/t.offsetWidth||1,y:e.height/t.offsetHeight||1,boundingClientRect:e}}function lt(t,e,i,n){if("object"==typeof e)for(var o in e)ut(t,o,e[o],i);else for(var s=0,a=(e=c(e)).length;s<a;s++)ut(t,e[s],i,n);return this}function ct(t,e,i,n){if("object"==typeof e)for(var o in e)pt(t,o,e[o],i);else if(e)for(var s=0,a=(e=c(e)).length;s<a;s++)pt(t,e[s],i,n);else{for(var r in t[si])pt(t,r,t[si][r]);delete t[si]}return this}function ut(e,t,i,n){var o=t+r(i)+(n?"_"+r(n):"");if(e[si]&&e[si][o])return this;var s=function(t){return i.call(n||e,t||window.event)},a=s;Ae&&0===t.indexOf("touch")?I(e,t,s,o):!Ze||"dblclick"!==t||Ae&&be?"addEventListener"in e?"mousewheel"===t?e.addEventListener("onwheel"in e?"wheel":"mousewheel",s,!1):"mouseenter"===t||"mouseleave"===t?(s=function(t){t=t||window.event,bt(e,t)&&a(t)},e.addEventListener("mouseenter"===t?"mouseover":"mouseout",s,!1)):("click"===t&&ge&&(s=function(t){var e,i,n;i=a,n=(e=t).timeStamp||e.originalEvent&&e.originalEvent.timeStamp,(t=oi&&n-oi)&&100<t&&t<500||e.target._simulatedClick&&!e._simulated?gt(e):(oi=n,i(e))}),e.addEventListener(t,s,!1)):"attachEvent"in e&&e.attachEvent("on"+t,s):D(e,s,o),e[si]=e[si]||{},e[si][o]=s}function pt(t,e,i,n){var o,s=e+r(i)+(n?"_"+r(n):""),a=t[si]&&t[si][s];if(!a)return this;Ae&&0===e.indexOf("touch")?(n=(o=t)["_leaflet_"+(i=e)+(n=s)],"touchstart"===i?o.removeEventListener(Fe,n,!1):"touchmove"===i?o.removeEventListener(He,n,!1):"touchend"===i&&(o.removeEventListener(We,n,!1),o.removeEventListener(Ge,n,!1))):!Ze||"dblclick"!==e||Ae&&be?"removeEventListener"in t?"mousewheel"===e?t.removeEventListener("onwheel"in t?"wheel":"mousewheel",a,!1):t.removeEventListener("mouseenter"===e?"mouseover":"mouseleave"===e?"mouseout":e,a,!1):"detachEvent"in t&&t.detachEvent("on"+e,a):R(t,s),t[si][s]=null}function dt(t){return t.stopPropagation?t.stopPropagation():t.originalEvent?t.originalEvent._stopped=!0:t.cancelBubble=!0,wt(t),this}function _t(t){return ut(t,"mousewheel",dt),this}function mt(t){return lt(t,"mousedown touchstart dblclick",dt),ut(t,"click",xt),this}function ft(t){return t.preventDefault?t.preventDefault():t.returnValue=!1,this}function gt(t){return ft(t),dt(t),this}function yt(t,e){if(!e)return new y(t.clientX,t.clientY);var i=ht(e),n=i.boundingClientRect;return new y((t.clientX-n.left)/i.x-e.clientLeft,(t.clientY-n.top)/i.y-e.clientTop)}function vt(t){return me?t.wheelDeltaY/2:t.deltaY&&0===t.deltaMode?-t.deltaY/ai:t.deltaY&&1===t.deltaMode?20*-t.deltaY:t.deltaY&&2===t.deltaMode?60*-t.deltaY:t.deltaX||t.deltaZ?0:t.wheelDelta?(t.wheelDeltaY||t.wheelDelta)/2:t.detail&&Math.abs(t.detail)<32765?20*-t.detail:t.detail?t.detail/-32765*60:0}function xt(t){ri[t.type]=!0}function wt(t){var e=ri[t.type];return ri[t.type]=!1,e}function bt(t,e){var i=e.relatedTarget;if(!i)return!0;try{for(;i&&i!==t;)i=i.parentNode}catch(t){return!1}return i!==t}function Lt(t,e){if(!e||!t.length)return t.slice();e*=e;return function(t,e){var i=t.length,n=new(typeof Uint8Array!=void 0+""?Uint8Array:Array)(i);n[0]=n[i-1]=1,function t(e,i,n,o,s){var a,r,h,l=0;for(r=o+1;r<=s-1;r++)(h=Ct(e[r],e[o],e[s],!0))>l&&(a=r,l=h);n<l&&(i[a]=1,t(e,i,n,o,a),t(e,i,n,a,s))}(t,n,e,0,i-1);var o,s=[];for(o=0;o<i;o++)n[o]&&s.push(t[o]);return s}(t=function(t,e){for(var i=[t[0]],n=1,o=0,s=t.length;n<s;n++)(function(t,e){var i=e.x-t.x,t=e.y-t.y;return i*i+t*t})(t[n],t[o])>e&&(i.push(t[n]),o=n);return o<s-1&&i.push(t[s-1]),i}(t,e),e)}function Tt(t,e,i){return Math.sqrt(Ct(t,e,i,!0))}function Pt(t,e,i,n,o){var s,a,r,h=n?mi:Mt(t,i),l=Mt(e,i);for(mi=l;;){if(!(h|l))return[t,e];if(h&l)return!1;r=Mt(a=kt(t,e,s=h||l,i,o),i),s===h?(t=a,h=r):(e=a,l=r)}}function kt(t,e,i,n,o){var s,a,r=e.x-t.x,h=e.y-t.y,e=n.min,n=n.max;return 8&i?(s=t.x+r*(n.y-t.y)/h,a=n.y):4&i?(s=t.x+r*(e.y-t.y)/h,a=e.y):2&i?(s=n.x,a=t.y+h*(n.x-t.x)/r):1&i&&(s=e.x,a=t.y+h*(e.x-t.x)/r),new y(s,a,o)}function Mt(t,e){var i=0;return t.x<e.min.x?i|=1:t.x>e.max.x&&(i|=2),t.y<e.min.y?i|=4:t.y>e.max.y&&(i|=8),i}function Ct(t,e,i,n){var o=e.x,s=e.y,a=i.x-o,r=i.y-s,e=a*a+r*r;return 0<e&&(1<(e=((t.x-o)*a+(t.y-s)*r)/e)?(o=i.x,s=i.y):0<e&&(o+=a*e,s+=r*e)),a=t.x-o,r=t.y-s,n?a*a+r*r:new y(o,s)}function Et(t){return!Vt(t[0])||"object"!=typeof t[0][0]&&void 0!==t[0][0]}function St(t){return console.warn("Deprecated use of _flat, please use L.LineUtil.isFlat instead."),Et(t)}function zt(t,e,i){for(var n,o,s,a,r,h,l,c=[1,4,2,8],u=0,p=t.length;u<p;u++)t[u]._code=Mt(t[u],e);for(s=0;s<4;s++){for(h=c[s],n=[],u=0,o=(p=t.length)-1;u<p;o=u++)a=t[u],r=t[o],a._code&h?r._code&h||((l=kt(r,a,h,e,i))._code=Mt(l,e),n.push(l)):(r._code&h&&((l=kt(r,a,h,e,i))._code=Mt(l,e),n.push(l)),n.push(a));t=n}return t}function Bt(t,e){var i,n,o,s,a="Feature"===t.type?t.geometry:t,r=a?a.coordinates:null,h=[],l=e&&e.pointToLayer,c=e&&e.coordsToLatLng||It;if(!r&&!a)return null;switch(a.type){case"Point":return i=c(r),l?l(t,i):new Mi(i);case"MultiPoint":for(o=0,s=r.length;o<s;o++)i=c(r[o]),h.push(l?l(t,i):new Mi(i));return new Li(h);case"LineString":case"MultiLineString":return n=Nt(r,"LineString"===a.type?0:1,c),new zi(n,e);case"Polygon":case"MultiPolygon":return n=Nt(r,"Polygon"===a.type?1:2,c),new Bi(n,e);case"GeometryCollection":for(o=0,s=a.geometries.length;o<s;o++){var u=Bt({geometry:a.geometries[o],type:"Feature",properties:t.properties},e);u&&h.push(u)}return new Li(h);default:throw new Error("Invalid GeoJSON object.")}}function It(t){return new k(t[1],t[0],t[2])}function Nt(t,e,i){for(var n,o=[],s=0,a=t.length;s<a;s++)n=e?Nt(t[s],e-1,i):(i||It)(t[s]),o.push(n);return o}function At(t,e){return e="number"==typeof e?e:6,void 0!==t.alt?[n(t.lng,e),n(t.lat,e),n(t.alt,e)]:[n(t.lng,e),n(t.lat,e)]}function Zt(t,e,i,n){for(var o=[],s=0,a=t.length;s<a;s++)o.push(e?Zt(t[s],e-1,i,n):At(t[s],n));return!e&&i&&o.push(o[0]),o}function Ot(t,e){return t.feature?h({},t.feature,{geometry:e}):Dt(e)}function Dt(t){return"Feature"===t.type||"FeatureCollection"===t.type?t:{type:"Feature",properties:{},geometry:t}}function Rt(t,e){return new Ii(t,e)}function Ut(t,e){return new ji(t,e)}function jt(t){return Re?new Wi(t):null}function Ft(t){return Ue||je?new Vi(t):null}var Ht=Object.freeze;Object.freeze=function(t){return t};var Wt=Object.create||function(t){return Qt.prototype=t,new Qt},Gt=0,qt=/\{ *([\w_-]+) *\}/g,Vt=Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)},Yt="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=",$t=0,Kt=window.requestAnimationFrame||_("RequestAnimationFrame")||m,Xt=window.cancelAnimationFrame||_("CancelAnimationFrame")||_("CancelRequestAnimationFrame")||function(t){window.clearTimeout(t)},Jt=(Object.freeze||Object)({freeze:Ht,extend:h,create:Wt,bind:p,lastId:Gt,stamp:r,throttle:e,wrapNum:i,falseFn:l,formatNum:n,trim:o,splitWords:c,setOptions:s,getParamString:a,template:u,isArray:Vt,indexOf:d,emptyImageUrl:Yt,requestFn:Kt,cancelFn:Xt,requestAnimFrame:x,cancelAnimFrame:f});function Qt(){}g.extend=function(t){function e(){this.initialize&&this.initialize.apply(this,arguments),this.callInitHooks()}var i,n=e.__super__=this.prototype,o=Wt(n);for(i in(o.constructor=e).prototype=o,this)this.hasOwnProperty(i)&&"prototype"!==i&&"__super__"!==i&&(e[i]=this[i]);return t.statics&&(h(e,t.statics),delete t.statics),t.includes&&(function(t){if(void 0!==L&&L&&L.Mixin){t=Vt(t)?t:[t];for(var e=0;e<t.length;e++)t[e]===L.Mixin.Events&&console.warn("Deprecated include of L.Mixin.Events: this property will be removed in future releases, please inherit from L.Evented instead.",(new Error).stack)}}(t.includes),h.apply(null,[o].concat(t.includes)),delete t.includes),o.options&&(t.options=h(Wt(o.options),t.options)),h(o,t),o._initHooks=[],o.callInitHooks=function(){if(!this._initHooksCalled){n.callInitHooks&&n.callInitHooks.call(this),this._initHooksCalled=!0;for(var t=0,e=o._initHooks.length;t<e;t++)o._initHooks[t].call(this)}},e},g.include=function(t){return h(this.prototype,t),this},g.mergeOptions=function(t){return h(this.prototype.options,t),this},g.addInitHook=function(t){var e=Array.prototype.slice.call(arguments,1),i="function"==typeof t?t:function(){this[t].apply(this,e)};return this.prototype._initHooks=this.prototype._initHooks||[],this.prototype._initHooks.push(i),this};var te={on:function(t,e,i){if("object"==typeof t)for(var n in t)this._on(n,t[n],e);else for(var o=0,s=(t=c(t)).length;o<s;o++)this._on(t[o],e,i);return this},off:function(t,e,i){if(t)if("object"==typeof t)for(var n in t)this._off(n,t[n],e);else for(var o=0,s=(t=c(t)).length;o<s;o++)this._off(t[o],e,i);else delete this._events;return this},_on:function(t,e,i){this._events=this._events||{};var n=this._events[t];n||(this._events[t]=n=[]);for(var t={fn:e,ctx:i=i===this?void 0:i},o=n,s=0,a=o.length;s<a;s++)if(o[s].fn===e&&o[s].ctx===i)return;o.push(t)},_off:function(t,e,i){var n,o,s;if(this._events&&(n=this._events[t]))if(e){if(i===this&&(i=void 0),n)for(o=0,s=n.length;o<s;o++){var a=n[o];if(a.ctx===i&&a.fn===e)return a.fn=l,this._firingCount&&(this._events[t]=n=n.slice()),void n.splice(o,1)}}else{for(o=0,s=n.length;o<s;o++)n[o].fn=l;delete this._events[t]}},fire:function(t,e,i){if(!this.listens(t,i))return this;var n=h({},e,{type:t,target:this,sourceTarget:e&&e.sourceTarget||this});if(this._events){var o=this._events[t];if(o){this._firingCount=this._firingCount+1||1;for(var s=0,a=o.length;s<a;s++){var r=o[s];r.fn.call(r.ctx||this,n)}this._firingCount--}}return i&&this._propagateEvent(n),this},listens:function(t,e){var i=this._events&&this._events[t];if(i&&i.length)return!0;if(e)for(var n in this._eventParents)if(this._eventParents[n].listens(t,e))return!0;return!1},once:function(t,e,i){if("object"==typeof t){for(var n in t)this.once(n,t[n],e);return this}var o=p(function(){this.off(t,e,i).off(t,o,i)},this);return this.on(t,e,i).on(t,o,i)},addEventParent:function(t){return this._eventParents=this._eventParents||{},this._eventParents[r(t)]=t,this},removeEventParent:function(t){return this._eventParents&&delete this._eventParents[r(t)],this},_propagateEvent:function(t){for(var e in this._eventParents)this._eventParents[e].fire(t.type,h({layer:t.target,propagatedFrom:t.target},t),!0)}};te.addEventListener=te.on,te.removeEventListener=te.clearAllEventListeners=te.off,te.addOneTimeEventListener=te.once,te.fireEvent=te.fire,te.hasEventListeners=te.listens;var ee=g.extend(te),ie=Math.trunc||function(t){return 0<t?Math.floor(t):Math.ceil(t)};y.prototype={clone:function(){return new y(this.x,this.y)},add:function(t){return this.clone()._add(v(t))},_add:function(t){return this.x+=t.x,this.y+=t.y,this},subtract:function(t){return this.clone()._subtract(v(t))},_subtract:function(t){return this.x-=t.x,this.y-=t.y,this},divideBy:function(t){return this.clone()._divideBy(t)},_divideBy:function(t){return this.x/=t,this.y/=t,this},multiplyBy:function(t){return this.clone()._multiplyBy(t)},_multiplyBy:function(t){return this.x*=t,this.y*=t,this},scaleBy:function(t){return new y(this.x*t.x,this.y*t.y)},unscaleBy:function(t){return new y(this.x/t.x,this.y/t.y)},round:function(){return this.clone()._round()},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},floor:function(){return this.clone()._floor()},_floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.clone()._ceil()},_ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},trunc:function(){return this.clone()._trunc()},_trunc:function(){return this.x=ie(this.x),this.y=ie(this.y),this},distanceTo:function(t){var e=(t=v(t)).x-this.x,t=t.y-this.y;return Math.sqrt(e*e+t*t)},equals:function(t){return(t=v(t)).x===this.x&&t.y===this.y},contains:function(t){return t=v(t),Math.abs(t.x)<=Math.abs(this.x)&&Math.abs(t.y)<=Math.abs(this.y)},toString:function(){return"Point("+n(this.x)+", "+n(this.y)+")"}},w.prototype={extend:function(t){return t=v(t),this.min||this.max?(this.min.x=Math.min(t.x,this.min.x),this.max.x=Math.max(t.x,this.max.x),this.min.y=Math.min(t.y,this.min.y),this.max.y=Math.max(t.y,this.max.y)):(this.min=t.clone(),this.max=t.clone()),this},getCenter:function(t){return new y((this.min.x+this.max.x)/2,(this.min.y+this.max.y)/2,t)},getBottomLeft:function(){return new y(this.min.x,this.max.y)},getTopRight:function(){return new y(this.max.x,this.min.y)},getTopLeft:function(){return this.min},getBottomRight:function(){return this.max},getSize:function(){return this.max.subtract(this.min)},contains:function(t){var e,i;return(t=("number"==typeof t[0]||t instanceof y?v:b)(t))instanceof w?(e=t.min,i=t.max):e=i=t,e.x>=this.min.x&&i.x<=this.max.x&&e.y>=this.min.y&&i.y<=this.max.y},intersects:function(t){t=b(t);var e=this.min,i=this.max,n=t.min,o=t.max,t=o.x>=e.x&&n.x<=i.x,i=o.y>=e.y&&n.y<=i.y;return t&&i},overlaps:function(t){t=b(t);var e=this.min,i=this.max,n=t.min,o=t.max,t=o.x>e.x&&n.x<i.x,i=o.y>e.y&&n.y<i.y;return t&&i},isValid:function(){return!(!this.min||!this.max)}},T.prototype={extend:function(t){var e,i,n=this._southWest,o=this._northEast;if(t instanceof k)i=e=t;else{if(!(t instanceof T))return t?this.extend(M(t)||P(t)):this;if(e=t._southWest,i=t._northEast,!e||!i)return this}return n||o?(n.lat=Math.min(e.lat,n.lat),n.lng=Math.min(e.lng,n.lng),o.lat=Math.max(i.lat,o.lat),o.lng=Math.max(i.lng,o.lng)):(this._southWest=new k(e.lat,e.lng),this._northEast=new k(i.lat,i.lng)),this},pad:function(t){var e=this._southWest,i=this._northEast,n=Math.abs(e.lat-i.lat)*t,t=Math.abs(e.lng-i.lng)*t;return new T(new k(e.lat-n,e.lng-t),new k(i.lat+n,i.lng+t))},getCenter:function(){return new k((this._southWest.lat+this._northEast.lat)/2,(this._southWest.lng+this._northEast.lng)/2)},getSouthWest:function(){return this._southWest},getNorthEast:function(){return this._northEast},getNorthWest:function(){return new k(this.getNorth(),this.getWest())},getSouthEast:function(){return new k(this.getSouth(),this.getEast())},getWest:function(){return this._southWest.lng},getSouth:function(){return this._southWest.lat},getEast:function(){return this._northEast.lng},getNorth:function(){return this._northEast.lat},contains:function(t){t=("number"==typeof t[0]||t instanceof k||"lat"in t?M:P)(t);var e,i,n=this._southWest,o=this._northEast;return t instanceof T?(e=t.getSouthWest(),i=t.getNorthEast()):e=i=t,e.lat>=n.lat&&i.lat<=o.lat&&e.lng>=n.lng&&i.lng<=o.lng},intersects:function(t){t=P(t);var e=this._southWest,i=this._northEast,n=t.getSouthWest(),o=t.getNorthEast(),t=o.lat>=e.lat&&n.lat<=i.lat,i=o.lng>=e.lng&&n.lng<=i.lng;return t&&i},overlaps:function(t){t=P(t);var e=this._southWest,i=this._northEast,n=t.getSouthWest(),o=t.getNorthEast(),t=o.lat>e.lat&&n.lat<i.lat,i=o.lng>e.lng&&n.lng<i.lng;return t&&i},toBBoxString:function(){return[this.getWest(),this.getSouth(),this.getEast(),this.getNorth()].join(",")},equals:function(t,e){return!!t&&(t=P(t),this._southWest.equals(t.getSouthWest(),e)&&this._northEast.equals(t.getNorthEast(),e))},isValid:function(){return!(!this._southWest||!this._northEast)}};var ne={latLngToPoint:function(t,e){t=this.projection.project(t),e=this.scale(e);return this.transformation._transform(t,e)},pointToLatLng:function(t,e){e=this.scale(e),e=this.transformation.untransform(t,e);return this.projection.unproject(e)},project:function(t){return this.projection.project(t)},unproject:function(t){return this.projection.unproject(t)},scale:function(t){return 256*Math.pow(2,t)},zoom:function(t){return Math.log(t/256)/Math.LN2},getProjectedBounds:function(t){if(this.infinite)return null;var e=this.projection.bounds,t=this.scale(t);return new w(this.transformation.transform(e.min,t),this.transformation.transform(e.max,t))},infinite:!(k.prototype={equals:function(t,e){return!!t&&(t=M(t),Math.max(Math.abs(this.lat-t.lat),Math.abs(this.lng-t.lng))<=(void 0===e?1e-9:e))},toString:function(t){return"LatLng("+n(this.lat,t)+", "+n(this.lng,t)+")"},distanceTo:function(t){return oe.distance(this,M(t))},wrap:function(){return oe.wrapLatLng(this)},toBounds:function(t){var e=180*t/40075017,t=e/Math.cos(Math.PI/180*this.lat);return P([this.lat-e,this.lng-t],[this.lat+e,this.lng+t])},clone:function(){return new k(this.lat,this.lng,this.alt)}}),wrapLatLng:function(t){var e=this.wrapLng?i(t.lng,this.wrapLng,!0):t.lng;return new k(this.wrapLat?i(t.lat,this.wrapLat,!0):t.lat,e,t.alt)},wrapLatLngBounds:function(t){var e=t.getCenter(),i=this.wrapLatLng(e),n=e.lat-i.lat,e=e.lng-i.lng;if(0==n&&0==e)return t;i=t.getSouthWest(),t=t.getNorthEast();return new T(new k(i.lat-n,i.lng-e),new k(t.lat-n,t.lng-e))}},oe=h({},ne,{wrapLng:[-180,180],R:6371e3,distance:function(t,e){var i=Math.PI/180,n=t.lat*i,o=e.lat*i,s=Math.sin((e.lat-t.lat)*i/2),i=Math.sin((e.lng-t.lng)*i/2),i=s*s+Math.cos(n)*Math.cos(o)*i*i,i=2*Math.atan2(Math.sqrt(i),Math.sqrt(1-i));return this.R*i}}),se={R:6378137,MAX_LATITUDE:85.0511287798,project:function(t){var e=Math.PI/180,i=this.MAX_LATITUDE,i=Math.max(Math.min(i,t.lat),-i),i=Math.sin(i*e);return new y(this.R*t.lng*e,this.R*Math.log((1+i)/(1-i))/2)},unproject:function(t){var e=180/Math.PI;return new k((2*Math.atan(Math.exp(t.y/this.R))-Math.PI/2)*e,t.x*e/this.R)},bounds:new w([-(Ie=6378137*Math.PI),-Ie],[Ie,Ie])};C.prototype={transform:function(t,e){return this._transform(t.clone(),e)},_transform:function(t,e){return t.x=(e=e||1)*(this._a*t.x+this._b),t.y=e*(this._c*t.y+this._d),t},untransform:function(t,e){return new y((t.x/(e=e||1)-this._b)/this._a,(t.y/e-this._d)/this._c)}};var ae,re,he,le,ce=h({},oe,{code:"EPSG:3857",projection:se,transformation:E(Ne=.5/(Math.PI*se.R),.5,-Ne,.5)}),ue=h({},ce,{code:"EPSG:900913"}),pe=document.documentElement.style,de="ActiveXObject"in window,_e=de&&!document.addEventListener,me="msLaunchUri"in navigator&&!("documentMode"in document),fe=B("webkit"),ge=B("android"),ye=B("android 2")||B("android 3"),ve=parseInt(/WebKit\/([0-9]+)|$/.exec(navigator.userAgent)[1],10),xe=ge&&B("Google")&&ve<537&&!("AudioNode"in window),we=!!window.opera,be=B("chrome"),Le=B("gecko")&&!fe&&!we&&!de,Te=!be&&B("safari"),Pe=B("phantom"),ke="OTransition"in pe,Me=0===navigator.platform.indexOf("Win"),Ce=de&&"transition"in pe,Ee="WebKitCSSMatrix"in window&&"m11"in new window.WebKitCSSMatrix&&!ye,Se="MozPerspective"in pe,ze=!window.L_DISABLE_3D&&(Ce||Ee||Se)&&!ke&&!Pe,Be="undefined"!=typeof orientation||B("mobile"),Ie=Be&&fe,Ne=Be&&Ee,ve=!window.PointerEvent&&window.MSPointerEvent,Ae=!(!window.PointerEvent&&!ve),Ze=!window.L_NO_TOUCH&&(Ae||"ontouchstart"in window||window.DocumentTouch&&document instanceof window.DocumentTouch),Oe=Be&&we,pe=Be&&Le,De=1<(window.devicePixelRatio||window.screen.deviceXDPI/window.screen.logicalXDPI),Re=!!document.createElement("canvas").getContext,Ue=!(!document.createElementNS||!S("svg").createSVGRect),je=!Ue&&function(){try{var t=document.createElement("div");t.innerHTML='<v:shape adj="1"/>';var e=t.firstChild;return e.style.behavior="url(#default#VML)",e&&"object"==typeof e.adj}catch(t){return!1}}(),fe=(Object.freeze||Object)({ie:de,ielt9:_e,edge:me,webkit:fe,android:ge,android23:ye,androidStock:xe,opera:we,chrome:be,gecko:Le,safari:Te,phantom:Pe,opera12:ke,win:Me,ie3d:Ce,webkit3d:Ee,gecko3d:Se,any3d:ze,mobile:Be,mobileWebkit:Ie,mobileWebkit3d:Ne,msPointer:ve,pointer:Ae,touch:Ze,mobileOpera:Oe,mobileGecko:pe,retina:De,canvas:Re,svg:Ue,vml:je}),Fe=ve?"MSPointerDown":"pointerdown",He=ve?"MSPointerMove":"pointermove",We=ve?"MSPointerUp":"pointerup",Ge=ve?"MSPointerCancel":"pointercancel",qe=["INPUT","SELECT","OPTION"],Ve={},Ye=!1,$e=0,Ke=ve?"MSPointerDown":Ae?"pointerdown":"touchstart",Xe=ve?"MSPointerUp":Ae?"pointerup":"touchend",Je="_leaflet_",Qe=Q(["transform","webkitTransform","OTransform","MozTransform","msTransform"]),ti=Q(["webkitTransition","transition","OTransition","MozTransition","msTransition"]),ei="webkitTransition"===ti||"OTransition"===ti?ti+"End":"transitionend";le="onselectstart"in document?(he=function(){lt(window,"selectstart",ft)},function(){ct(window,"selectstart",ft)}):(re=Q(["userSelect","WebkitUserSelect","OUserSelect","MozUserSelect","msUserSelect"]),he=function(){var t;re&&(t=document.documentElement.style,ae=t[re],t[re]="none")},function(){re&&(document.documentElement.style[re]=ae,ae=void 0)});var ii,ni,oi,we=(Object.freeze||Object)({TRANSFORM:Qe,TRANSITION:ti,TRANSITION_END:ei,get:U,getStyle:j,create:F,remove:H,empty:W,toFront:G,toBack:q,hasClass:V,addClass:Y,removeClass:$,setClass:K,getClass:X,setOpacity:J,testProp:Q,setTransform:tt,setPosition:et,getPosition:it,disableTextSelection:he,enableTextSelection:le,disableImageDrag:nt,enableImageDrag:ot,preventOutline:st,restoreOutline:at,getSizedParentNode:rt,getScale:ht}),si="_leaflet_events",ai=Me&&be?2*window.devicePixelRatio:Le?window.devicePixelRatio:1,ri={},Pe=(Object.freeze||Object)({on:lt,off:ct,stopPropagation:dt,disableScrollPropagation:_t,disableClickPropagation:mt,preventDefault:ft,stop:gt,getMousePosition:yt,getWheelDelta:vt,fakeStop:xt,skipped:wt,isExternalTarget:bt,addListener:lt,removeListener:ct}),hi=ee.extend({run:function(t,e,i,n){this.stop(),this._el=t,this._inProgress=!0,this._duration=i||.25,this._easeOutPower=1/Math.max(n||.5,.2),this._startPos=it(t),this._offset=e.subtract(this._startPos),this._startTime=+new Date,this.fire("start"),this._animate()},stop:function(){this._inProgress&&(this._step(!0),this._complete())},_animate:function(){this._animId=x(this._animate,this),this._step()},_step:function(t){var e=+new Date-this._startTime,i=1e3*this._duration;e<i?this._runFrame(this._easeOut(e/i),t):(this._runFrame(1),this._complete())},_runFrame:function(t,e){t=this._startPos.add(this._offset.multiplyBy(t));e&&t._round(),et(this._el,t),this.fire("step")},_complete:function(){f(this._animId),this._inProgress=!1,this.fire("end")},_easeOut:function(t){return 1-Math.pow(1-t,this._easeOutPower)}}),li=ee.extend({options:{crs:ce,center:void 0,zoom:void 0,minZoom:void 0,maxZoom:void 0,layers:[],maxBounds:void 0,renderer:void 0,zoomAnimation:!0,zoomAnimationThreshold:4,fadeAnimation:!0,markerZoomAnimation:!0,transform3DLimit:8388608,zoomSnap:1,zoomDelta:1,trackResize:!0},initialize:function(t,e){e=s(this,e),this._handlers=[],this._layers={},this._zoomBoundLayers={},this._sizeChanged=!0,this._initContainer(t),this._initLayout(),this._onResize=p(this._onResize,this),this._initEvents(),e.maxBounds&&this.setMaxBounds(e.maxBounds),void 0!==e.zoom&&(this._zoom=this._limitZoom(e.zoom)),e.center&&void 0!==e.zoom&&this.setView(M(e.center),e.zoom,{reset:!0}),this.callInitHooks(),this._zoomAnimated=ti&&ze&&!Oe&&this.options.zoomAnimation,this._zoomAnimated&&(this._createAnimProxy(),lt(this._proxy,ei,this._catchTransitionEnd,this)),this._addLayers(this.options.layers)},setView:function(t,e,i){return e=void 0===e?this._zoom:this._limitZoom(e),t=this._limitCenter(M(t),e,this.options.maxBounds),i=i||{},this._stop(),this._loaded&&!i.reset&&!0!==i&&(void 0!==i.animate&&(i.zoom=h({animate:i.animate},i.zoom),i.pan=h({animate:i.animate,duration:i.duration},i.pan)),this._zoom!==e?this._tryAnimatedZoom&&this._tryAnimatedZoom(t,e,i.zoom):this._tryAnimatedPan(t,i.pan))?clearTimeout(this._sizeTimer):this._resetView(t,e),this},setZoom:function(t,e){return this._loaded?this.setView(this.getCenter(),t,{zoom:e}):(this._zoom=t,this)},zoomIn:function(t,e){return t=t||(ze?this.options.zoomDelta:1),this.setZoom(this._zoom+t,e)},zoomOut:function(t,e){return t=t||(ze?this.options.zoomDelta:1),this.setZoom(this._zoom-t,e)},setZoomAround:function(t,e,i){var n=this.getZoomScale(e),o=this.getSize().divideBy(2),n=(t instanceof y?t:this.latLngToContainerPoint(t)).subtract(o).multiplyBy(1-1/n),n=this.containerPointToLatLng(o.add(n));return this.setView(n,e,{zoom:i})},_getBoundsCenterZoom:function(t,e){e=e||{},t=t.getBounds?t.getBounds():P(t);var i=v(e.paddingTopLeft||e.padding||[0,0]),n=v(e.paddingBottomRight||e.padding||[0,0]),o=this.getBoundsZoom(t,!1,i.add(n));if((o="number"==typeof e.maxZoom?Math.min(e.maxZoom,o):o)===1/0)return{center:t.getCenter(),zoom:o};n=n.subtract(i).divideBy(2),i=this.project(t.getSouthWest(),o),t=this.project(t.getNorthEast(),o);return{center:this.unproject(i.add(t).divideBy(2).add(n),o),zoom:o}},fitBounds:function(t,e){if(!(t=P(t)).isValid())throw new Error("Bounds are not valid.");t=this._getBoundsCenterZoom(t,e);return this.setView(t.center,t.zoom,e)},fitWorld:function(t){return this.fitBounds([[-90,-180],[90,180]],t)},panTo:function(t,e){return this.setView(t,this._zoom,{pan:e})},panBy:function(t,e){return e=e||{},(t=v(t).round()).x||t.y?(!0===e.animate||this.getSize().contains(t)?(this._panAnim||(this._panAnim=new hi,this._panAnim.on({step:this._onPanTransitionStep,end:this._onPanTransitionEnd},this)),e.noMoveStart||this.fire("movestart"),!1!==e.animate?(Y(this._mapPane,"leaflet-pan-anim"),i=this._getMapPanePos().subtract(t).round(),this._panAnim.run(this._mapPane,i,e.duration||.25,e.easeLinearity)):(this._rawPanBy(t),this.fire("move").fire("moveend"))):this._resetView(this.unproject(this.project(this.getCenter()).add(t)),this.getZoom()),this):this.fire("moveend");var i},flyTo:function(n,o,t){function e(t){t=(p*p-u*u+(t?-1:1)*m*m*d*d)/(2*(t?p:u)*m*d),t=Math.sqrt(t*t+1)-t;return t<1e-9?-18:Math.log(t)}function i(t){return(Math.exp(t)-Math.exp(-t))/2}function s(t){return(Math.exp(t)+Math.exp(-t))/2}function a(t){return u*(s(f)*(i(t=f+_*t)/s(t))-i(f))/m}if(!1===(t=t||{}).animate||!ze)return this.setView(n,o,t);this._stop();var r=this.project(this.getCenter()),h=this.project(n),l=this.getSize(),c=this._zoom;n=M(n),o=void 0===o?c:o;var u=Math.max(l.x,l.y),p=u*this.getZoomScale(c,o),d=h.distanceTo(r)||1,_=1.42,m=_*_,f=e(0),g=Date.now(),y=(e(1)-f)/_,v=t.duration?1e3*t.duration:1e3*y*.8;return this._moveStart(!0,t.noMoveStart),function t(){var e=(Date.now()-g)/v,i=(1-Math.pow(1-e,1.5))*y;e<=1?(this._flyToFrame=x(t,this),this._move(this.unproject(r.add(h.subtract(r).multiplyBy(a(i)/d)),c),this.getScaleZoom(u/(u*(s(f)/s(f+_*i))),c),{flyTo:!0})):this._move(n,o)._moveEnd(!0)}.call(this),this},flyToBounds:function(t,e){t=this._getBoundsCenterZoom(t,e);return this.flyTo(t.center,t.zoom,e)},setMaxBounds:function(t){return(t=P(t)).isValid()?(this.options.maxBounds&&this.off("moveend",this._panInsideMaxBounds),this.options.maxBounds=t,this._loaded&&this._panInsideMaxBounds(),this.on("moveend",this._panInsideMaxBounds)):(this.options.maxBounds=null,this.off("moveend",this._panInsideMaxBounds))},setMinZoom:function(t){var e=this.options.minZoom;return this.options.minZoom=t,this._loaded&&e!==t&&(this.fire("zoomlevelschange"),this.getZoom()<this.options.minZoom)?this.setZoom(t):this},setMaxZoom:function(t){var e=this.options.maxZoom;return this.options.maxZoom=t,this._loaded&&e!==t&&(this.fire("zoomlevelschange"),this.getZoom()>this.options.maxZoom)?this.setZoom(t):this},panInsideBounds:function(t,e){this._enforcingBounds=!0;var i=this.getCenter(),t=this._limitCenter(i,this._zoom,P(t));return i.equals(t)||this.panTo(t,e),this._enforcingBounds=!1,this},panInside:function(t,e){var i=v((e=e||{}).paddingTopLeft||e.padding||[0,0]),n=v(e.paddingBottomRight||e.padding||[0,0]),o=this.getCenter(),s=this.project(o),a=this.project(t),r=this.getPixelBounds(),h=r.getSize().divideBy(2),o=b([r.min.add(i),r.max.subtract(n)]);return o.contains(a)||(this._enforcingBounds=!0,t=s.subtract(a),r=v(a.x+t.x,a.y+t.y),(a.x<o.min.x||a.x>o.max.x)&&(r.x=s.x-t.x,0<t.x?r.x+=h.x-i.x:r.x-=h.x-n.x),(a.y<o.min.y||a.y>o.max.y)&&(r.y=s.y-t.y,0<t.y?r.y+=h.y-i.y:r.y-=h.y-n.y),this.panTo(this.unproject(r),e),this._enforcingBounds=!1),this},invalidateSize:function(t){if(!this._loaded)return this;t=h({animate:!1,pan:!0},!0===t?{animate:!0}:t);var e=this.getSize();this._sizeChanged=!0,this._lastCenter=null;var i=this.getSize(),n=e.divideBy(2).round(),o=i.divideBy(2).round(),o=n.subtract(o);return o.x||o.y?(t.animate&&t.pan?this.panBy(o):(t.pan&&this._rawPanBy(o),this.fire("move"),t.debounceMoveend?(clearTimeout(this._sizeTimer),this._sizeTimer=setTimeout(p(this.fire,this,"moveend"),200)):this.fire("moveend")),this.fire("resize",{oldSize:e,newSize:i})):this},stop:function(){return this.setZoom(this._limitZoom(this._zoom)),this.options.zoomSnap||this.fire("viewreset"),this._stop()},locate:function(t){if(t=this._locateOptions=h({timeout:1e4,watch:!1},t),!("geolocation"in navigator))return this._handleGeolocationError({code:0,message:"Geolocation not supported."}),this;var e=p(this._handleGeolocationResponse,this),i=p(this._handleGeolocationError,this);return t.watch?this._locationWatchId=navigator.geolocation.watchPosition(e,i,t):navigator.geolocation.getCurrentPosition(e,i,t),this},stopLocate:function(){return navigator.geolocation&&navigator.geolocation.clearWatch&&navigator.geolocation.clearWatch(this._locationWatchId),this._locateOptions&&(this._locateOptions.setView=!1),this},_handleGeolocationError:function(t){var e=t.code,t=t.message||(1===e?"permission denied":2===e?"position unavailable":"timeout");this._locateOptions.setView&&!this._loaded&&this.fitWorld(),this.fire("locationerror",{code:e,message:"Geolocation error: "+t+"."})},_handleGeolocationResponse:function(t){var e,i=new k(t.coords.latitude,t.coords.longitude),n=i.toBounds(2*t.coords.accuracy),o=this._locateOptions;o.setView&&(e=this.getBoundsZoom(n),this.setView(i,o.maxZoom?Math.min(e,o.maxZoom):e));var s,a={latlng:i,bounds:n,timestamp:t.timestamp};for(s in t.coords)"number"==typeof t.coords[s]&&(a[s]=t.coords[s]);this.fire("locationfound",a)},addHandler:function(t,e){if(!e)return this;e=this[t]=new e(this);return this._handlers.push(e),this.options[t]&&e.enable(),this},remove:function(){if(this._initEvents(!0),this._containerId!==this._container._leaflet_id)throw new Error("Map container is being reused by another instance");try{delete this._container._leaflet_id,delete this._containerId}catch(t){this._container._leaflet_id=void 0,this._containerId=void 0}for(var t in void 0!==this._locationWatchId&&this.stopLocate(),this._stop(),H(this._mapPane),this._clearControlPos&&this._clearControlPos(),this._resizeRequest&&(f(this._resizeRequest),this._resizeRequest=null),this._clearHandlers(),this._loaded&&this.fire("unload"),this._layers)this._layers[t].remove();for(t in this._panes)H(this._panes[t]);return this._layers=[],this._panes=[],delete this._mapPane,delete this._renderer,this},createPane:function(t,e){e=F("div","leaflet-pane"+(t?" leaflet-"+t.replace("Pane","")+"-pane":""),e||this._mapPane);return t&&(this._panes[t]=e),e},getCenter:function(){return this._checkIfLoaded(),this._lastCenter&&!this._moved()?this._lastCenter:this.layerPointToLatLng(this._getCenterLayerPoint())},getZoom:function(){return this._zoom},getBounds:function(){var t=this.getPixelBounds();return new T(this.unproject(t.getBottomLeft()),this.unproject(t.getTopRight()))},getMinZoom:function(){return void 0===this.options.minZoom?this._layersMinZoom||0:this.options.minZoom},getMaxZoom:function(){return void 0===this.options.maxZoom?void 0===this._layersMaxZoom?1/0:this._layersMaxZoom:this.options.maxZoom},getBoundsZoom:function(t,e,i){t=P(t),i=v(i||[0,0]);var n=this.getZoom()||0,o=this.getMinZoom(),s=this.getMaxZoom(),a=t.getNorthWest(),r=t.getSouthEast(),t=this.getSize().subtract(i),i=b(this.project(r,n),this.project(a,n)).getSize(),r=ze?this.options.zoomSnap:1,a=t.x/i.x,i=t.y/i.y,i=e?Math.max(a,i):Math.min(a,i),n=this.getScaleZoom(i,n);return r&&(n=Math.round(n/(r/100))*(r/100),n=e?Math.ceil(n/r)*r:Math.floor(n/r)*r),Math.max(o,Math.min(s,n))},getSize:function(){return this._size&&!this._sizeChanged||(this._size=new y(this._container.clientWidth||0,this._container.clientHeight||0),this._sizeChanged=!1),this._size.clone()},getPixelBounds:function(t,e){e=this._getTopLeftPoint(t,e);return new w(e,e.add(this.getSize()))},getPixelOrigin:function(){return this._checkIfLoaded(),this._pixelOrigin},getPixelWorldBounds:function(t){return this.options.crs.getProjectedBounds(void 0===t?this.getZoom():t)},getPane:function(t){return"string"==typeof t?this._panes[t]:t},getPanes:function(){return this._panes},getContainer:function(){return this._container},getZoomScale:function(t,e){var i=this.options.crs;return e=void 0===e?this._zoom:e,i.scale(t)/i.scale(e)},getScaleZoom:function(t,e){var i=this.options.crs;e=void 0===e?this._zoom:e;e=i.zoom(t*i.scale(e));return isNaN(e)?1/0:e},project:function(t,e){return e=void 0===e?this._zoom:e,this.options.crs.latLngToPoint(M(t),e)},unproject:function(t,e){return e=void 0===e?this._zoom:e,this.options.crs.pointToLatLng(v(t),e)},layerPointToLatLng:function(t){t=v(t).add(this.getPixelOrigin());return this.unproject(t)},latLngToLayerPoint:function(t){return this.project(M(t))._round()._subtract(this.getPixelOrigin())},wrapLatLng:function(t){return this.options.crs.wrapLatLng(M(t))},wrapLatLngBounds:function(t){return this.options.crs.wrapLatLngBounds(P(t))},distance:function(t,e){return this.options.crs.distance(M(t),M(e))},containerPointToLayerPoint:function(t){return v(t).subtract(this._getMapPanePos())},layerPointToContainerPoint:function(t){return v(t).add(this._getMapPanePos())},containerPointToLatLng:function(t){t=this.containerPointToLayerPoint(v(t));return this.layerPointToLatLng(t)},latLngToContainerPoint:function(t){return this.layerPointToContainerPoint(this.latLngToLayerPoint(M(t)))},mouseEventToContainerPoint:function(t){return yt(t,this._container)},mouseEventToLayerPoint:function(t){return this.containerPointToLayerPoint(this.mouseEventToContainerPoint(t))},mouseEventToLatLng:function(t){return this.layerPointToLatLng(this.mouseEventToLayerPoint(t))},_initContainer:function(t){t=this._container=U(t);if(!t)throw new Error("Map container not found.");if(t._leaflet_id)throw new Error("Map container is already initialized.");lt(t,"scroll",this._onScroll,this),this._containerId=r(t)},_initLayout:function(){var t=this._container;this._fadeAnimated=this.options.fadeAnimation&&ze,Y(t,"leaflet-container"+(Ze?" leaflet-touch":"")+(De?" leaflet-retina":"")+(_e?" leaflet-oldie":"")+(Te?" leaflet-safari":"")+(this._fadeAnimated?" leaflet-fade-anim":""));var e=j(t,"position");"absolute"!==e&&"relative"!==e&&"fixed"!==e&&(t.style.position="relative"),this._initPanes(),this._initControlPos&&this._initControlPos()},_initPanes:function(){var t=this._panes={};this._paneRenderers={},this._mapPane=this.createPane("mapPane",this._container),et(this._mapPane,new y(0,0)),this.createPane("tilePane"),this.createPane("shadowPane"),this.createPane("overlayPane"),this.createPane("markerPane"),this.createPane("tooltipPane"),this.createPane("popupPane"),this.options.markerZoomAnimation||(Y(t.markerPane,"leaflet-zoom-hide"),Y(t.shadowPane,"leaflet-zoom-hide"))},_resetView:function(t,e){et(this._mapPane,new y(0,0));var i=!this._loaded;this._loaded=!0,e=this._limitZoom(e),this.fire("viewprereset");var n=this._zoom!==e;this._moveStart(n,!1)._move(t,e)._moveEnd(n),this.fire("viewreset"),i&&this.fire("load")},_moveStart:function(t,e){return t&&this.fire("zoomstart"),e||this.fire("movestart"),this},_move:function(t,e,i){void 0===e&&(e=this._zoom);var n=this._zoom!==e;return this._zoom=e,this._lastCenter=t,this._pixelOrigin=this._getNewPixelOrigin(t),(n||i&&i.pinch)&&this.fire("zoom",i),this.fire("move",i)},_moveEnd:function(t){return t&&this.fire("zoomend"),this.fire("moveend")},_stop:function(){return f(this._flyToFrame),this._panAnim&&this._panAnim.stop(),this},_rawPanBy:function(t){et(this._mapPane,this._getMapPanePos().subtract(t))},_getZoomSpan:function(){return this.getMaxZoom()-this.getMinZoom()},_panInsideMaxBounds:function(){this._enforcingBounds||this.panInsideBounds(this.options.maxBounds)},_checkIfLoaded:function(){if(!this._loaded)throw new Error("Set map center and zoom first.")},_initEvents:function(t){this._targets={};var e=t?ct:lt;e((this._targets[r(this._container)]=this)._container,"click dblclick mousedown mouseup mouseover mouseout mousemove contextmenu keypress",this._handleDOMEvent,this),this.options.trackResize&&e(window,"resize",this._onResize,this),ze&&this.options.transform3DLimit&&(t?this.off:this.on).call(this,"moveend",this._onMoveEnd)},_onResize:function(){f(this._resizeRequest),this._resizeRequest=x(function(){this.invalidateSize({debounceMoveend:!0})},this)},_onScroll:function(){this._container.scrollTop=0,this._container.scrollLeft=0},_onMoveEnd:function(){var t=this._getMapPanePos();Math.max(Math.abs(t.x),Math.abs(t.y))>=this.options.transform3DLimit&&this._resetView(this.getCenter(),this.getZoom())},_findEventTargets:function(t,e){for(var i,n=[],o="mouseout"===e||"mouseover"===e,s=t.target||t.srcElement,a=!1;s;){if((i=this._targets[r(s)])&&("click"===e||"preclick"===e)&&!t._simulated&&this._draggableMoved(i)){a=!0;break}if(i&&i.listens(e,!0)){if(o&&!bt(s,t))break;if(n.push(i),o)break}if(s===this._container)break;s=s.parentNode}return n=!(n.length||a||o)&&bt(s,t)?[this]:n},_handleDOMEvent:function(t){var e;this._loaded&&!wt(t)&&("mousedown"!==(e=t.type)&&"keypress"!==e||st(t.target||t.srcElement),this._fireDOMEvent(t,e))},_mouseEvents:["click","dblclick","mouseover","mouseout","contextmenu"],_fireDOMEvent:function(t,e,i){if("click"===t.type&&((o=h({},t)).type="preclick",this._fireDOMEvent(o,o.type,i)),!t._stopped&&(i=(i||[]).concat(this._findEventTargets(t,e))).length){var n=i[0];"contextmenu"===e&&n.listens(e,!0)&&ft(t);var o,s={originalEvent:t};"keypress"!==t.type&&(o=n.getLatLng&&(!n._radius||n._radius<=10),s.containerPoint=o?this.latLngToContainerPoint(n.getLatLng()):this.mouseEventToContainerPoint(t),s.layerPoint=this.containerPointToLayerPoint(s.containerPoint),s.latlng=o?n.getLatLng():this.layerPointToLatLng(s.layerPoint));for(var a=0;a<i.length;a++)if(i[a].fire(e,s,!0),s.originalEvent._stopped||!1===i[a].options.bubblingMouseEvents&&-1!==d(this._mouseEvents,e))return}},_draggableMoved:function(t){return(t=t.dragging&&t.dragging.enabled()?t:this).dragging&&t.dragging.moved()||this.boxZoom&&this.boxZoom.moved()},_clearHandlers:function(){for(var t=0,e=this._handlers.length;t<e;t++)this._handlers[t].disable()},whenReady:function(t,e){return this._loaded?t.call(e||this,{target:this}):this.on("load",t,e),this},_getMapPanePos:function(){return it(this._mapPane)||new y(0,0)},_moved:function(){var t=this._getMapPanePos();return t&&!t.equals([0,0])},_getTopLeftPoint:function(t,e){return(t&&void 0!==e?this._getNewPixelOrigin(t,e):this.getPixelOrigin()).subtract(this._getMapPanePos())},_getNewPixelOrigin:function(t,e){var i=this.getSize()._divideBy(2);return this.project(t,e)._subtract(i)._add(this._getMapPanePos())._round()},_latLngToNewLayerPoint:function(t,e,i){i=this._getNewPixelOrigin(i,e);return this.project(t,e)._subtract(i)},_latLngBoundsToNewLayerBounds:function(t,e,i){i=this._getNewPixelOrigin(i,e);return b([this.project(t.getSouthWest(),e)._subtract(i),this.project(t.getNorthWest(),e)._subtract(i),this.project(t.getSouthEast(),e)._subtract(i),this.project(t.getNorthEast(),e)._subtract(i)])},_getCenterLayerPoint:function(){return this.containerPointToLayerPoint(this.getSize()._divideBy(2))},_getCenterOffset:function(t){return this.latLngToLayerPoint(t).subtract(this._getCenterLayerPoint())},_limitCenter:function(t,e,i){if(!i)return t;var n=this.project(t,e),o=this.getSize().divideBy(2),o=new w(n.subtract(o),n.add(o)),i=this._getBoundsOffset(o,i,e);return i.round().equals([0,0])?t:this.unproject(n.add(i),e)},_limitOffset:function(t,e){if(!e)return t;var i=this.getPixelBounds(),i=new w(i.min.add(t),i.max.add(t));return t.add(this._getBoundsOffset(i,e))},_getBoundsOffset:function(t,e,i){e=b(this.project(e.getNorthEast(),i),this.project(e.getSouthWest(),i)),i=e.min.subtract(t.min),t=e.max.subtract(t.max);return new y(this._rebound(i.x,-t.x),this._rebound(i.y,-t.y))},_rebound:function(t,e){return 0<t+e?Math.round(t-e)/2:Math.max(0,Math.ceil(t))-Math.max(0,Math.floor(e))},_limitZoom:function(t){var e=this.getMinZoom(),i=this.getMaxZoom(),n=ze?this.options.zoomSnap:1;return n&&(t=Math.round(t/n)*n),Math.max(e,Math.min(i,t))},_onPanTransitionStep:function(){this.fire("move")},_onPanTransitionEnd:function(){$(this._mapPane,"leaflet-pan-anim"),this.fire("moveend")},_tryAnimatedPan:function(t,e){t=this._getCenterOffset(t)._trunc();return!(!0!==(e&&e.animate)&&!this.getSize().contains(t)||(this.panBy(t,e),0))},_createAnimProxy:function(){var t=this._proxy=F("div","leaflet-proxy leaflet-zoom-animated");this._panes.mapPane.appendChild(t),this.on("zoomanim",function(t){var e=Qe,i=this._proxy.style[e];tt(this._proxy,this.project(t.center,t.zoom),this.getZoomScale(t.zoom,1)),i===this._proxy.style[e]&&this._animatingZoom&&this._onZoomTransitionEnd()},this),this.on("load moveend",function(){var t=this.getCenter(),e=this.getZoom();tt(this._proxy,this.project(t,e),this.getZoomScale(e,1))},this),this._on("unload",this._destroyAnimProxy,this)},_destroyAnimProxy:function(){H(this._proxy),delete this._proxy},_catchTransitionEnd:function(t){this._animatingZoom&&0<=t.propertyName.indexOf("transform")&&this._onZoomTransitionEnd()},_nothingToAnimate:function(){return!this._container.getElementsByClassName("leaflet-zoom-animated").length},_tryAnimatedZoom:function(t,e,i){if(this._animatingZoom)return!0;if(i=i||{},!this._zoomAnimated||!1===i.animate||this._nothingToAnimate()||Math.abs(e-this._zoom)>this.options.zoomAnimationThreshold)return!1;var n=this.getZoomScale(e),n=this._getCenterOffset(t)._divideBy(1-1/n);return!(!0!==i.animate&&!this.getSize().contains(n)||(x(function(){this._moveStart(!0,!1)._animateZoom(t,e,!0)},this),0))},_animateZoom:function(t,e,i,n){this._mapPane&&(i&&(this._animatingZoom=!0,this._animateToCenter=t,this._animateToZoom=e,Y(this._mapPane,"leaflet-zoom-anim")),this.fire("zoomanim",{center:t,zoom:e,noUpdate:n}),setTimeout(p(this._onZoomTransitionEnd,this),250))},_onZoomTransitionEnd:function(){this._animatingZoom&&(this._mapPane&&$(this._mapPane,"leaflet-zoom-anim"),this._animatingZoom=!1,this._move(this._animateToCenter,this._animateToZoom),x(function(){this._moveEnd(!0)},this))}}),ci=g.extend({options:{position:"topright"},initialize:function(t){s(this,t)},getPosition:function(){return this.options.position},setPosition:function(t){var e=this._map;return e&&e.removeControl(this),this.options.position=t,e&&e.addControl(this),this},getContainer:function(){return this._container},addTo:function(t){this.remove(),this._map=t;var e=this._container=this.onAdd(t),i=this.getPosition(),t=t._controlCorners[i];return Y(e,"leaflet-control"),-1!==i.indexOf("bottom")?t.insertBefore(e,t.firstChild):t.appendChild(e),this},remove:function(){return this._map&&(H(this._container),this.onRemove&&this.onRemove(this._map),this._map=null),this},_refocusOnMap:function(t){this._map&&t&&0<t.screenX&&0<t.screenY&&this._map.getContainer().focus()}}),ke=function(t){return new ci(t)};li.include({addControl:function(t){return t.addTo(this),this},removeControl:function(t){return t.remove(),this},_initControlPos:function(){function t(t,e){i[t+e]=F("div",n+t+" "+n+e,o)}var i=this._controlCorners={},n="leaflet-",o=this._controlContainer=F("div",n+"control-container",this._container);t("top","left"),t("top","right"),t("bottom","left"),t("bottom","right")},_clearControlPos:function(){for(var t in this._controlCorners)H(this._controlCorners[t]);H(this._controlContainer),delete this._controlCorners,delete this._controlContainer}});var ui=ci.extend({options:{collapsed:!0,position:"topright",autoZIndex:!0,hideSingleBase:!1,sortLayers:!1,sortFunction:function(t,e,i,n){return i<n?-1:n<i?1:0}},initialize:function(t,e,i){for(var n in s(this,i),this._layerControlInputs=[],this._layers=[],this._lastZIndex=0,this._handlingClick=!1,t)this._addLayer(t[n],n);for(n in e)this._addLayer(e[n],n,!0)},onAdd:function(t){this._initLayout(),this._update(),(this._map=t).on("zoomend",this._checkDisabledLayers,this);for(var e=0;e<this._layers.length;e++)this._layers[e].layer.on("add remove",this._onLayerChange,this);return this._container},addTo:function(t){return ci.prototype.addTo.call(this,t),this._expandIfNotCollapsed()},onRemove:function(){this._map.off("zoomend",this._checkDisabledLayers,this);for(var t=0;t<this._layers.length;t++)this._layers[t].layer.off("add remove",this._onLayerChange,this)},addBaseLayer:function(t,e){return this._addLayer(t,e),this._map?this._update():this},addOverlay:function(t,e){return this._addLayer(t,e,!0),this._map?this._update():this},removeLayer:function(t){t.off("add remove",this._onLayerChange,this);t=this._getLayer(r(t));return t&&this._layers.splice(this._layers.indexOf(t),1),this._map?this._update():this},expand:function(){Y(this._container,"leaflet-control-layers-expanded"),this._section.style.height=null;var t=this._map.getSize().y-(this._container.offsetTop+50);return t<this._section.clientHeight?(Y(this._section,"leaflet-control-layers-scrollbar"),this._section.style.height=t+"px"):$(this._section,"leaflet-control-layers-scrollbar"),this._checkDisabledLayers(),this},collapse:function(){return $(this._container,"leaflet-control-layers-expanded"),this},_initLayout:function(){var t="leaflet-control-layers",e=this._container=F("div",t),i=this.options.collapsed;e.setAttribute("aria-haspopup",!0),mt(e),_t(e);var n=this._section=F("section",t+"-list");i&&(this._map.on("click",this.collapse,this),ge||lt(e,{mouseenter:this.expand,mouseleave:this.collapse},this));var o=this._layersLink=F("a",t+"-toggle",e);o.href="#",o.title="Layers",Ze?(lt(o,"click",gt),lt(o,"click",this.expand,this)):lt(o,"focus",this.expand,this),i||this.expand(),this._baseLayersList=F("div",t+"-base",n),this._separator=F("div",t+"-separator",n),this._overlaysList=F("div",t+"-overlays",n),e.appendChild(n)},_getLayer:function(t){for(var e=0;e<this._layers.length;e++)if(this._layers[e]&&r(this._layers[e].layer)===t)return this._layers[e]},_addLayer:function(t,e,i){this._map&&t.on("add remove",this._onLayerChange,this),this._layers.push({layer:t,name:e,overlay:i}),this.options.sortLayers&&this._layers.sort(p(function(t,e){return this.options.sortFunction(t.layer,e.layer,t.name,e.name)},this)),this.options.autoZIndex&&t.setZIndex&&(this._lastZIndex++,t.setZIndex(this._lastZIndex)),this._expandIfNotCollapsed()},_update:function(){if(!this._container)return this;W(this._baseLayersList),W(this._overlaysList),this._layerControlInputs=[];for(var t,e,i,n=0,o=0;o<this._layers.length;o++)i=this._layers[o],this._addItem(i),e=e||i.overlay,t=t||!i.overlay,n+=i.overlay?0:1;return this.options.hideSingleBase&&(this._baseLayersList.style.display=(t=t&&1<n)?"":"none"),this._separator.style.display=e&&t?"":"none",this},_onLayerChange:function(t){this._handlingClick||this._update();var e=this._getLayer(r(t.target)),t=e.overlay?"add"===t.type?"overlayadd":"overlayremove":"add"===t.type?"baselayerchange":null;t&&this._map.fire(t,e)},_createRadioElement:function(t,e){t='<input type="radio" class="leaflet-control-layers-selector" name="'+t+'"'+(e?' checked="checked"':"")+"/>",e=document.createElement("div");return e.innerHTML=t,e.firstChild},_addItem:function(t){var e,i=document.createElement("label"),n=this._map.hasLayer(t.layer);t.overlay?((e=document.createElement("input")).type="checkbox",e.className="leaflet-control-layers-selector",e.defaultChecked=n):e=this._createRadioElement("leaflet-base-layers",n),this._layerControlInputs.push(e),e.layerId=r(t.layer),lt(e,"click",this._onInputClick,this);var o=document.createElement("span");o.innerHTML=" "+t.name;n=document.createElement("div");return i.appendChild(n),n.appendChild(e),n.appendChild(o),(t.overlay?this._overlaysList:this._baseLayersList).appendChild(i),this._checkDisabledLayers(),i},_onInputClick:function(){var t,e,i=this._layerControlInputs,n=[],o=[];this._handlingClick=!0;for(var s=i.length-1;0<=s;s--)t=i[s],e=this._getLayer(t.layerId).layer,t.checked?n.push(e):t.checked||o.push(e);for(s=0;s<o.length;s++)this._map.hasLayer(o[s])&&this._map.removeLayer(o[s]);for(s=0;s<n.length;s++)this._map.hasLayer(n[s])||this._map.addLayer(n[s]);this._handlingClick=!1,this._refocusOnMap()},_checkDisabledLayers:function(){for(var t,e,i=this._layerControlInputs,n=this._map.getZoom(),o=i.length-1;0<=o;o--)t=i[o],e=this._getLayer(t.layerId).layer,t.disabled=void 0!==e.options.minZoom&&n<e.options.minZoom||void 0!==e.options.maxZoom&&n>e.options.maxZoom},_expandIfNotCollapsed:function(){return this._map&&!this.options.collapsed&&this.expand(),this},_expand:function(){return this.expand()},_collapse:function(){return this.collapse()}}),pi=ci.extend({options:{position:"topleft",zoomInText:"+",zoomInTitle:"Zoom in",zoomOutText:"&#x2212;",zoomOutTitle:"Zoom out"},onAdd:function(t){var e="leaflet-control-zoom",i=F("div",e+" leaflet-bar"),n=this.options;return this._zoomInButton=this._createButton(n.zoomInText,n.zoomInTitle,e+"-in",i,this._zoomIn),this._zoomOutButton=this._createButton(n.zoomOutText,n.zoomOutTitle,e+"-out",i,this._zoomOut),this._updateDisabled(),t.on("zoomend zoomlevelschange",this._updateDisabled,this),i},onRemove:function(t){t.off("zoomend zoomlevelschange",this._updateDisabled,this)},disable:function(){return this._disabled=!0,this._updateDisabled(),this},enable:function(){return this._disabled=!1,this._updateDisabled(),this},_zoomIn:function(t){!this._disabled&&this._map._zoom<this._map.getMaxZoom()&&this._map.zoomIn(this._map.options.zoomDelta*(t.shiftKey?3:1))},_zoomOut:function(t){!this._disabled&&this._map._zoom>this._map.getMinZoom()&&this._map.zoomOut(this._map.options.zoomDelta*(t.shiftKey?3:1))},_createButton:function(t,e,i,n,o){n=F("a",i,n);return n.innerHTML=t,n.href="#",n.title=e,n.setAttribute("role","button"),n.setAttribute("aria-label",e),mt(n),lt(n,"click",gt),lt(n,"click",o,this),lt(n,"click",this._refocusOnMap,this),n},_updateDisabled:function(){var t=this._map,e="leaflet-disabled";$(this._zoomInButton,e),$(this._zoomOutButton,e),!this._disabled&&t._zoom!==t.getMinZoom()||Y(this._zoomOutButton,e),!this._disabled&&t._zoom!==t.getMaxZoom()||Y(this._zoomInButton,e)}});li.mergeOptions({zoomControl:!0}),li.addInitHook(function(){this.options.zoomControl&&(this.zoomControl=new pi,this.addControl(this.zoomControl))});var di=ci.extend({options:{position:"bottomleft",maxWidth:100,metric:!0,imperial:!0},onAdd:function(t){var e=F("div","leaflet-control-scale"),i=this.options;return this._addScales(i,"leaflet-control-scale-line",e),t.on(i.updateWhenIdle?"moveend":"move",this._update,this),t.whenReady(this._update,this),e},onRemove:function(t){t.off(this.options.updateWhenIdle?"moveend":"move",this._update,this)},_addScales:function(t,e,i){t.metric&&(this._mScale=F("div",e,i)),t.imperial&&(this._iScale=F("div",e,i))},_update:function(){var t=this._map,e=t.getSize().y/2,e=t.distance(t.containerPointToLatLng([0,e]),t.containerPointToLatLng([this.options.maxWidth,e]));this._updateScales(e)},_updateScales:function(t){this.options.metric&&t&&this._updateMetric(t),this.options.imperial&&t&&this._updateImperial(t)},_updateMetric:function(t){var e=this._getRoundNum(t);this._updateScale(this._mScale,e<1e3?e+" m":e/1e3+" km",e/t)},_updateImperial:function(t){var e,i=3.2808399*t;5280<i?(t=this._getRoundNum(e=i/5280),this._updateScale(this._iScale,t+" mi",t/e)):(e=this._getRoundNum(i),this._updateScale(this._iScale,e+" ft",e/i))},_updateScale:function(t,e,i){t.style.width=Math.round(this.options.maxWidth*i)+"px",t.innerHTML=e},_getRoundNum:function(t){var e=Math.pow(10,(Math.floor(t)+"").length-1),t=t/e;return e*(t=10<=t?10:5<=t?5:3<=t?3:2<=t?2:1)}}),_i=ci.extend({options:{position:"bottomright",prefix:'<a href="http://leafletjs.com" title="A JS library for interactive maps">Leaflet</a>'},initialize:function(t){s(this,t),this._attributions={}},onAdd:function(t){for(var e in(t.attributionControl=this)._container=F("div","leaflet-control-attribution"),mt(this._container),t._layers)t._layers[e].getAttribution&&this.addAttribution(t._layers[e].getAttribution());return this._update(),this._container},setPrefix:function(t){return this.options.prefix=t,this._update(),this},addAttribution:function(t){return t&&(this._attributions[t]||(this._attributions[t]=0),this._attributions[t]++,this._update()),this},removeAttribution:function(t){return t&&this._attributions[t]&&(this._attributions[t]--,this._update()),this},_update:function(){if(this._map){var t,e=[];for(t in this._attributions)this._attributions[t]&&e.push(t);var i=[];this.options.prefix&&i.push(this.options.prefix),e.length&&i.push(e.join(", ")),this._container.innerHTML=i.join(" | ")}}});li.mergeOptions({attributionControl:!0}),li.addInitHook(function(){this.options.attributionControl&&(new _i).addTo(this)}),ci.Layers=ui,ci.Zoom=pi,ci.Scale=di,ci.Attribution=_i,ke.layers=function(t,e,i){return new ui(t,e,i)},ke.zoom=function(t){return new pi(t)},ke.scale=function(t){return new di(t)},ke.attribution=function(t){return new _i(t)};Ee=g.extend({initialize:function(t){this._map=t},enable:function(){return this._enabled||(this._enabled=!0,this.addHooks()),this},disable:function(){return this._enabled&&(this._enabled=!1,this.removeHooks()),this},enabled:function(){return!!this._enabled}});Ee.addTo=function(t,e){return t.addHandler(e,this),this};var mi,Se={Events:te},fi=Ze?"touchstart mousedown":"mousedown",gi={mousedown:"mouseup",touchstart:"touchend",pointerdown:"touchend",MSPointerDown:"touchend"},yi={mousedown:"mousemove",touchstart:"touchmove",pointerdown:"touchmove",MSPointerDown:"touchmove"},vi=ee.extend({options:{clickTolerance:3},initialize:function(t,e,i,n){s(this,n),this._element=t,this._dragStartTarget=e||t,this._preventOutline=i},enable:function(){this._enabled||(lt(this._dragStartTarget,fi,this._onDown,this),this._enabled=!0)},disable:function(){this._enabled&&(vi._dragging===this&&this.finishDrag(),ct(this._dragStartTarget,fi,this._onDown,this),this._enabled=!1,this._moved=!1)},_onDown:function(t){var e,i;t._simulated||!this._enabled||(this._moved=!1,V(this._element,"leaflet-zoom-anim")||vi._dragging||t.shiftKey||1!==t.which&&1!==t.button&&!t.touches||((vi._dragging=this)._preventOutline&&st(this._element),nt(),he(),this._moving))||(this.fire("down"),e=t.touches?t.touches[0]:t,i=rt(this._element),this._startPoint=new y(e.clientX,e.clientY),this._parentScale=ht(i),lt(document,yi[t.type],this._onMove,this),lt(document,gi[t.type],this._onUp,this))},_onMove:function(t){var e;!t._simulated&&this._enabled&&(t.touches&&1<t.touches.length?this._moved=!0:((e=new y((e=t.touches&&1===t.touches.length?t.touches[0]:t).clientX,e.clientY)._subtract(this._startPoint)).x||e.y)&&(Math.abs(e.x)+Math.abs(e.y)<this.options.clickTolerance||(e.x/=this._parentScale.x,e.y/=this._parentScale.y,ft(t),this._moved||(this.fire("dragstart"),this._moved=!0,this._startPos=it(this._element).subtract(e),Y(document.body,"leaflet-dragging"),this._lastTarget=t.target||t.srcElement,window.SVGElementInstance&&this._lastTarget instanceof SVGElementInstance&&(this._lastTarget=this._lastTarget.correspondingUseElement),Y(this._lastTarget,"leaflet-drag-target")),this._newPos=this._startPos.add(e),this._moving=!0,f(this._animRequest),this._lastEvent=t,this._animRequest=x(this._updatePosition,this,!0))))},_updatePosition:function(){var t={originalEvent:this._lastEvent};this.fire("predrag",t),et(this._element,this._newPos),this.fire("drag",t)},_onUp:function(t){!t._simulated&&this._enabled&&this.finishDrag()},finishDrag:function(){for(var t in $(document.body,"leaflet-dragging"),this._lastTarget&&($(this._lastTarget,"leaflet-drag-target"),this._lastTarget=null),yi)ct(document,yi[t],this._onMove,this),ct(document,gi[t],this._onUp,this);ot(),le(),this._moved&&this._moving&&(f(this._animRequest),this.fire("dragend",{distance:this._newPos.distanceTo(this._startPos)})),this._moving=!1,vi._dragging=!1}}),Ie=(Object.freeze||Object)({simplify:Lt,pointToSegmentDistance:Tt,closestPointOnSegment:function(t,e,i){return Ct(t,e,i)},clipSegment:Pt,_getEdgeIntersection:kt,_getBitCode:Mt,_sqClosestPointOnSegment:Ct,isFlat:Et,_flat:St}),Ne=(Object.freeze||Object)({clipPolygon:zt}),pe={project:function(t){return new y(t.lng,t.lat)},unproject:function(t){return new k(t.y,t.x)},bounds:new w([-180,-90],[180,90])},ve={R:6378137,R_MINOR:6356752.314245179,bounds:new w([-20037508.34279,-15496570.73972],[20037508.34279,18764656.23138]),project:function(t){var e=Math.PI/180,i=this.R,n=t.lat*e,o=this.R_MINOR/i,s=Math.sqrt(1-o*o),o=s*Math.sin(n),s=Math.tan(Math.PI/4-n/2)/Math.pow((1-o)/(1+o),s/2),n=-i*Math.log(Math.max(s,1e-10));return new y(t.lng*e*i,n)},unproject:function(t){for(var e,i=180/Math.PI,n=this.R,o=this.R_MINOR/n,s=Math.sqrt(1-o*o),a=Math.exp(-t.y/n),r=Math.PI/2-2*Math.atan(a),h=0,l=.1;h<15&&1e-7<Math.abs(l);h++)e=s*Math.sin(r),e=Math.pow((1-e)/(1+e),s/2),r+=l=Math.PI/2-2*Math.atan(a*e)-r;return new k(r*i,t.x*i/n)}},Me=(Object.freeze||Object)({LonLat:pe,Mercator:ve,SphericalMercator:se}),te=h({},oe,{code:"EPSG:3395",projection:ve,transformation:E(Le=.5/(Math.PI*ve.R),.5,-Le,.5)}),xi=h({},oe,{code:"EPSG:4326",projection:pe,transformation:E(1/180,1,-1/180,.5)}),se=h({},ne,{projection:pe,transformation:E(1,0,-1,0),scale:function(t){return Math.pow(2,t)},zoom:function(t){return Math.log(t)/Math.LN2},distance:function(t,e){var i=e.lng-t.lng,t=e.lat-t.lat;return Math.sqrt(i*i+t*t)},infinite:!0});ne.Earth=oe,ne.EPSG3395=te,ne.EPSG3857=ce,ne.EPSG900913=ue,ne.EPSG4326=xi,ne.Simple=se;var wi=ee.extend({options:{pane:"overlayPane",attribution:null,bubblingMouseEvents:!0},addTo:function(t){return t.addLayer(this),this},remove:function(){return this.removeFrom(this._map||this._mapToAdd)},removeFrom:function(t){return t&&t.removeLayer(this),this},getPane:function(t){return this._map.getPane(t?this.options[t]||t:this.options.pane)},addInteractiveTarget:function(t){return this._map._targets[r(t)]=this},removeInteractiveTarget:function(t){return delete this._map._targets[r(t)],this},getAttribution:function(){return this.options.attribution},_layerAdd:function(t){var e,i=t.target;i.hasLayer(this)&&(this._map=i,this._zoomAnimated=i._zoomAnimated,this.getEvents&&(e=this.getEvents(),i.on(e,this),this.once("remove",function(){i.off(e,this)},this)),this.onAdd(i),this.getAttribution&&i.attributionControl&&i.attributionControl.addAttribution(this.getAttribution()),this.fire("add"),i.fire("layeradd",{layer:this}))}});li.include({addLayer:function(t){if(!t._layerAdd)throw new Error("The provided object is not a Layer.");var e=r(t);return this._layers[e]||((this._layers[e]=t)._mapToAdd=this,t.beforeAdd&&t.beforeAdd(this),this.whenReady(t._layerAdd,t)),this},removeLayer:function(t){var e=r(t);return this._layers[e]&&(this._loaded&&t.onRemove(this),t.getAttribution&&this.attributionControl&&this.attributionControl.removeAttribution(t.getAttribution()),delete this._layers[e],this._loaded&&(this.fire("layerremove",{layer:t}),t.fire("remove")),t._map=t._mapToAdd=null),this},hasLayer:function(t){return!!t&&r(t)in this._layers},eachLayer:function(t,e){for(var i in this._layers)t.call(e,this._layers[i]);return this},_addLayers:function(t){for(var e=0,i=(t=t?Vt(t)?t:[t]:[]).length;e<i;e++)this.addLayer(t[e])},_addZoomLimit:function(t){!isNaN(t.options.maxZoom)&&isNaN(t.options.minZoom)||(this._zoomBoundLayers[r(t)]=t,this._updateZoomLevels())},_removeZoomLimit:function(t){t=r(t);this._zoomBoundLayers[t]&&(delete this._zoomBoundLayers[t],this._updateZoomLevels())},_updateZoomLevels:function(){var t,e=1/0,i=-1/0,n=this._getZoomSpan();for(t in this._zoomBoundLayers)var o=this._zoomBoundLayers[t].options,e=void 0===o.minZoom?e:Math.min(e,o.minZoom),i=void 0===o.maxZoom?i:Math.max(i,o.maxZoom);this._layersMaxZoom=i===-1/0?void 0:i,this._layersMinZoom=e===1/0?void 0:e,n!==this._getZoomSpan()&&this.fire("zoomlevelschange"),void 0===this.options.maxZoom&&this._layersMaxZoom&&this.getZoom()>this._layersMaxZoom&&this.setZoom(this._layersMaxZoom),void 0===this.options.minZoom&&this._layersMinZoom&&this.getZoom()<this._layersMinZoom&&this.setZoom(this._layersMinZoom)}});var bi=wi.extend({initialize:function(t,e){var i,n;if(s(this,e),this._layers={},t)for(i=0,n=t.length;i<n;i++)this.addLayer(t[i])},addLayer:function(t){var e=this.getLayerId(t);return this._layers[e]=t,this._map&&this._map.addLayer(t),this},removeLayer:function(t){t=t in this._layers?t:this.getLayerId(t);return this._map&&this._layers[t]&&this._map.removeLayer(this._layers[t]),delete this._layers[t],this},hasLayer:function(t){return!!t&&(t in this._layers||this.getLayerId(t)in this._layers)},clearLayers:function(){return this.eachLayer(this.removeLayer,this)},invoke:function(t){var e,i,n=Array.prototype.slice.call(arguments,1);for(e in this._layers)(i=this._layers[e])[t]&&i[t].apply(i,n);return this},onAdd:function(t){this.eachLayer(t.addLayer,t)},onRemove:function(t){this.eachLayer(t.removeLayer,t)},eachLayer:function(t,e){for(var i in this._layers)t.call(e,this._layers[i]);return this},getLayer:function(t){return this._layers[t]},getLayers:function(){var t=[];return this.eachLayer(t.push,t),t},setZIndex:function(t){return this.invoke("setZIndex",t)},getLayerId:r}),Li=bi.extend({addLayer:function(t){return this.hasLayer(t)?this:(t.addEventParent(this),bi.prototype.addLayer.call(this,t),this.fire("layeradd",{layer:t}))},removeLayer:function(t){return this.hasLayer(t)?((t=t in this._layers?this._layers[t]:t).removeEventParent(this),bi.prototype.removeLayer.call(this,t),this.fire("layerremove",{layer:t})):this},setStyle:function(t){return this.invoke("setStyle",t)},bringToFront:function(){return this.invoke("bringToFront")},bringToBack:function(){return this.invoke("bringToBack")},getBounds:function(){var t,e=new T;for(t in this._layers){var i=this._layers[t];e.extend(i.getBounds?i.getBounds():i.getLatLng())}return e}}),Ti=g.extend({options:{popupAnchor:[0,0],tooltipAnchor:[0,0]},initialize:function(t){s(this,t)},createIcon:function(t){return this._createIcon("icon",t)},createShadow:function(t){return this._createIcon("shadow",t)},_createIcon:function(t,e){var i=this._getIconUrl(t);if(!i){if("icon"===t)throw new Error("iconUrl not set in Icon options (see the docs).");return null}e=this._createImg(i,e&&"IMG"===e.tagName?e:null);return this._setIconStyles(e,t),e},_setIconStyles:function(t,e){var i=this.options,n=i[e+"Size"],o=v(n="number"==typeof n?[n,n]:n),n=v("shadow"===e&&i.shadowAnchor||i.iconAnchor||o&&o.divideBy(2,!0));t.className="leaflet-marker-"+e+" "+(i.className||""),n&&(t.style.marginLeft=-n.x+"px",t.style.marginTop=-n.y+"px"),o&&(t.style.width=o.x+"px",t.style.height=o.y+"px")},_createImg:function(t,e){return(e=e||document.createElement("img")).src=t,e},_getIconUrl:function(t){return De&&this.options[t+"RetinaUrl"]||this.options[t+"Url"]}}),Pi=Ti.extend({options:{iconUrl:"marker-icon.png",iconRetinaUrl:"marker-icon-2x.png",shadowUrl:"marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],tooltipAnchor:[16,-28],shadowSize:[41,41]},_getIconUrl:function(t){return Pi.imagePath||(Pi.imagePath=this._detectIconPath()),(this.options.imagePath||Pi.imagePath)+Ti.prototype._getIconUrl.call(this,t)},_detectIconPath:function(){var t=F("div","leaflet-default-icon-path",document.body),e=j(t,"background-image")||j(t,"backgroundImage");return document.body.removeChild(t),null===e||0!==e.indexOf("url")?"":e.replace(/^url\(["']?/,"").replace(/marker-icon\.png["']?\)$/,"")}}),ki=Ee.extend({initialize:function(t){this._marker=t},addHooks:function(){var t=this._marker._icon;this._draggable||(this._draggable=new vi(t,t,!0)),this._draggable.on({dragstart:this._onDragStart,predrag:this._onPreDrag,drag:this._onDrag,dragend:this._onDragEnd},this).enable(),Y(t,"leaflet-marker-draggable")},removeHooks:function(){this._draggable.off({dragstart:this._onDragStart,predrag:this._onPreDrag,drag:this._onDrag,dragend:this._onDragEnd},this).disable(),this._marker._icon&&$(this._marker._icon,"leaflet-marker-draggable")},moved:function(){return this._draggable&&this._draggable._moved},_adjustPan:function(t){var e=this._marker,i=e._map,n=this._marker.options.autoPanSpeed,o=this._marker.options.autoPanPadding,s=it(e._icon),a=i.getPixelBounds(),r=i.getPixelOrigin(),o=b(a.min._subtract(r).add(o),a.max._subtract(r).subtract(o));o.contains(s)||(n=v((Math.max(o.max.x,s.x)-o.max.x)/(a.max.x-o.max.x)-(Math.min(o.min.x,s.x)-o.min.x)/(a.min.x-o.min.x),(Math.max(o.max.y,s.y)-o.max.y)/(a.max.y-o.max.y)-(Math.min(o.min.y,s.y)-o.min.y)/(a.min.y-o.min.y)).multiplyBy(n),i.panBy(n,{animate:!1}),this._draggable._newPos._add(n),this._draggable._startPos._add(n),et(e._icon,this._draggable._newPos),this._onDrag(t),this._panRequest=x(this._adjustPan.bind(this,t)))},_onDragStart:function(){this._oldLatLng=this._marker.getLatLng(),this._marker.closePopup().fire("movestart").fire("dragstart")},_onPreDrag:function(t){this._marker.options.autoPan&&(f(this._panRequest),this._panRequest=x(this._adjustPan.bind(this,t)))},_onDrag:function(t){var e=this._marker,i=e._shadow,n=it(e._icon),o=e._map.layerPointToLatLng(n);i&&et(i,n),e._latlng=o,t.latlng=o,t.oldLatLng=this._oldLatLng,e.fire("move",t).fire("drag",t)},_onDragEnd:function(t){f(this._panRequest),delete this._oldLatLng,this._marker.fire("moveend").fire("dragend",t)}}),Mi=wi.extend({options:{icon:new Pi,interactive:!0,keyboard:!0,title:"",alt:"",zIndexOffset:0,opacity:1,riseOnHover:!1,riseOffset:250,pane:"markerPane",bubblingMouseEvents:!1,draggable:!1,autoPan:!1,autoPanPadding:[50,50],autoPanSpeed:10},initialize:function(t,e){s(this,e),this._latlng=M(t)},onAdd:function(t){this._zoomAnimated=this._zoomAnimated&&t.options.markerZoomAnimation,this._zoomAnimated&&t.on("zoomanim",this._animateZoom,this),this._initIcon(),this.update()},onRemove:function(t){this.dragging&&this.dragging.enabled()&&(this.options.draggable=!0,this.dragging.removeHooks()),delete this.dragging,this._zoomAnimated&&t.off("zoomanim",this._animateZoom,this),this._removeIcon(),this._removeShadow()},getEvents:function(){return{zoom:this.update,viewreset:this.update}},getLatLng:function(){return this._latlng},setLatLng:function(t){var e=this._latlng;return this._latlng=M(t),this.update(),this.fire("move",{oldLatLng:e,latlng:this._latlng})},setZIndexOffset:function(t){return this.options.zIndexOffset=t,this.update()},setIcon:function(t){return this.options.icon=t,this._map&&(this._initIcon(),this.update()),this._popup&&this.bindPopup(this._popup,this._popup.options),this},getElement:function(){return this._icon},update:function(){var t;return this._icon&&this._map&&(t=this._map.latLngToLayerPoint(this._latlng).round(),this._setPos(t)),this},_initIcon:function(){var t=this.options,e="leaflet-zoom-"+(this._zoomAnimated?"animated":"hide"),i=t.icon.createIcon(this._icon),n=!1;i!==this._icon&&(this._icon&&this._removeIcon(),n=!0,t.title&&(i.title=t.title),"IMG"===i.tagName&&(i.alt=t.alt||"")),Y(i,e),t.keyboard&&(i.tabIndex="0"),this._icon=i,t.riseOnHover&&this.on({mouseover:this._bringToFront,mouseout:this._resetZIndex});var o=t.icon.createShadow(this._shadow),i=!1;o!==this._shadow&&(this._removeShadow(),i=!0),o&&(Y(o,e),o.alt=""),this._shadow=o,t.opacity<1&&this._updateOpacity(),n&&this.getPane().appendChild(this._icon),this._initInteraction(),o&&i&&this.getPane("shadowPane").appendChild(this._shadow)},_removeIcon:function(){this.options.riseOnHover&&this.off({mouseover:this._bringToFront,mouseout:this._resetZIndex}),H(this._icon),this.removeInteractiveTarget(this._icon),this._icon=null},_removeShadow:function(){this._shadow&&H(this._shadow),this._shadow=null},_setPos:function(t){et(this._icon,t),this._shadow&&et(this._shadow,t),this._zIndex=t.y+this.options.zIndexOffset,this._resetZIndex()},_updateZIndex:function(t){this._icon.style.zIndex=this._zIndex+t},_animateZoom:function(t){t=this._map._latLngToNewLayerPoint(this._latlng,t.zoom,t.center).round();this._setPos(t)},_initInteraction:function(){var t;this.options.interactive&&(Y(this._icon,"leaflet-interactive"),this.addInteractiveTarget(this._icon),ki)&&(t=this.options.draggable,this.dragging&&(t=this.dragging.enabled(),this.dragging.disable()),this.dragging=new ki(this),t&&this.dragging.enable())},setOpacity:function(t){return this.options.opacity=t,this._map&&this._updateOpacity(),this},_updateOpacity:function(){var t=this.options.opacity;J(this._icon,t),this._shadow&&J(this._shadow,t)},_bringToFront:function(){this._updateZIndex(this.options.riseOffset)},_resetZIndex:function(){this._updateZIndex(0)},_getPopupAnchor:function(){return this.options.icon.options.popupAnchor},_getTooltipAnchor:function(){return this.options.icon.options.tooltipAnchor}}),Ci=wi.extend({options:{stroke:!0,color:"#3388ff",weight:3,opacity:1,lineCap:"round",lineJoin:"round",dashArray:null,dashOffset:null,fill:!1,fillColor:null,fillOpacity:.2,fillRule:"evenodd",interactive:!0,bubblingMouseEvents:!0},beforeAdd:function(t){this._renderer=t.getRenderer(this)},onAdd:function(){this._renderer._initPath(this),this._reset(),this._renderer._addPath(this)},onRemove:function(){this._renderer._removePath(this)},redraw:function(){return this._map&&this._renderer._updatePath(this),this},setStyle:function(t){return s(this,t),this._renderer&&this._renderer._updateStyle(this),this},bringToFront:function(){return this._renderer&&this._renderer._bringToFront(this),this},bringToBack:function(){return this._renderer&&this._renderer._bringToBack(this),this},getElement:function(){return this._path},_reset:function(){this._project(),this._update()},_clickTolerance:function(){return(this.options.stroke?this.options.weight/2:0)+this._renderer.options.tolerance}}),Ei=Ci.extend({options:{fill:!0,radius:10},initialize:function(t,e){s(this,e),this._latlng=M(t),this._radius=this.options.radius},setLatLng:function(t){return this._latlng=M(t),this.redraw(),this.fire("move",{latlng:this._latlng})},getLatLng:function(){return this._latlng},setRadius:function(t){return this.options.radius=this._radius=t,this.redraw()},getRadius:function(){return this._radius},setStyle:function(t){var e=t&&t.radius||this._radius;return Ci.prototype.setStyle.call(this,t),this.setRadius(e),this},_project:function(){this._point=this._map.latLngToLayerPoint(this._latlng),this._updateBounds()},_updateBounds:function(){var t=this._radius,e=this._radiusY||t,i=this._clickTolerance(),i=[t+i,e+i];this._pxBounds=new w(this._point.subtract(i),this._point.add(i))},_update:function(){this._map&&this._updatePath()},_updatePath:function(){this._renderer._updateCircle(this)},_empty:function(){return this._radius&&!this._renderer._bounds.intersects(this._pxBounds)},_containsPoint:function(t){return t.distanceTo(this._point)<=this._radius+this._clickTolerance()}}),Si=Ei.extend({initialize:function(t,e,i){if(s(this,e="number"==typeof e?h({},i,{radius:e}):e),this._latlng=M(t),isNaN(this.options.radius))throw new Error("Circle radius cannot be NaN");this._mRadius=this.options.radius},setRadius:function(t){return this._mRadius=t,this.redraw()},getRadius:function(){return this._mRadius},getBounds:function(){var t=[this._radius,this._radiusY||this._radius];return new T(this._map.layerPointToLatLng(this._point.subtract(t)),this._map.layerPointToLatLng(this._point.add(t)))},setStyle:Ci.prototype.setStyle,_project:function(){var t,e,i,n,o,s=this._latlng.lng,a=this._latlng.lat,r=this._map,h=r.options.crs;h.distance===oe.distance?(o=Math.PI/180,t=this._mRadius/oe.R/o,e=r.project([a+t,s]),n=r.project([a-t,s]),i=e.add(n).divideBy(2),n=r.unproject(i).lat,o=Math.acos((Math.cos(t*o)-Math.sin(a*o)*Math.sin(n*o))/(Math.cos(a*o)*Math.cos(n*o)))/o,!isNaN(o)&&0!==o||(o=t/Math.cos(Math.PI/180*a)),this._point=i.subtract(r.getPixelOrigin()),this._radius=isNaN(o)?0:i.x-r.project([n,s-o]).x,this._radiusY=i.y-e.y):(h=h.unproject(h.project(this._latlng).subtract([this._mRadius,0])),this._point=r.latLngToLayerPoint(this._latlng),this._radius=this._point.x-r.latLngToLayerPoint(h).x),this._updateBounds()}}),zi=Ci.extend({options:{smoothFactor:1,noClip:!1},initialize:function(t,e){s(this,e),this._setLatLngs(t)},getLatLngs:function(){return this._latlngs},setLatLngs:function(t){return this._setLatLngs(t),this.redraw()},isEmpty:function(){return!this._latlngs.length},closestLayerPoint:function(t){for(var e,i,n=1/0,o=null,s=Ct,a=0,r=this._parts.length;a<r;a++)for(var h=this._parts[a],l=1,c=h.length;l<c;l++){var u=s(t,e=h[l-1],i=h[l],!0);u<n&&(n=u,o=s(t,e,i))}return o&&(o.distance=Math.sqrt(n)),o},getCenter:function(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");var t,e,i,n,o,s,a=this._rings[0],r=a.length;if(!r)return null;for(e=t=0;t<r-1;t++)e+=a[t].distanceTo(a[t+1])/2;if(0===e)return this._map.layerPointToLatLng(a[0]);for(i=t=0;t<r-1;t++)if(n=a[t],o=a[t+1],(i+=s=n.distanceTo(o))>e)return this._map.layerPointToLatLng([o.x-(s=(i-e)/s)*(o.x-n.x),o.y-s*(o.y-n.y)])},getBounds:function(){return this._bounds},addLatLng:function(t,e){return e=e||this._defaultShape(),t=M(t),e.push(t),this._bounds.extend(t),this.redraw()},_setLatLngs:function(t){this._bounds=new T,this._latlngs=this._convertLatLngs(t)},_defaultShape:function(){return Et(this._latlngs)?this._latlngs:this._latlngs[0]},_convertLatLngs:function(t){for(var e=[],i=Et(t),n=0,o=t.length;n<o;n++)i?(e[n]=M(t[n]),this._bounds.extend(e[n])):e[n]=this._convertLatLngs(t[n]);return e},_project:function(){var t=new w;this._rings=[],this._projectLatlngs(this._latlngs,this._rings,t);var e=this._clickTolerance(),e=new y(e,e);this._bounds.isValid()&&t.isValid()&&(t.min._subtract(e),t.max._add(e),this._pxBounds=t)},_projectLatlngs:function(t,e,i){var n,o,s=t[0]instanceof k,a=t.length;if(s){for(o=[],n=0;n<a;n++)o[n]=this._map.latLngToLayerPoint(t[n]),i.extend(o[n]);e.push(o)}else for(n=0;n<a;n++)this._projectLatlngs(t[n],e,i)},_clipPoints:function(){var t=this._renderer._bounds;if(this._parts=[],this._pxBounds&&this._pxBounds.intersects(t))if(this.options.noClip)this._parts=this._rings;else for(var e,i,n,o,s=this._parts,a=0,r=0,h=this._rings.length;a<h;a++)for(e=0,i=(o=this._rings[a]).length;e<i-1;e++)(n=Pt(o[e],o[e+1],t,e,!0))&&(s[r]=s[r]||[],s[r].push(n[0]),n[1]===o[e+1]&&e!==i-2||(s[r].push(n[1]),r++))},_simplifyPoints:function(){for(var t=this._parts,e=this.options.smoothFactor,i=0,n=t.length;i<n;i++)t[i]=Lt(t[i],e)},_update:function(){this._map&&(this._clipPoints(),this._simplifyPoints(),this._updatePath())},_updatePath:function(){this._renderer._updatePoly(this)},_containsPoint:function(t,e){var i,n,o,s,a,r,h=this._clickTolerance();if(!this._pxBounds||!this._pxBounds.contains(t))return!1;for(i=0,s=this._parts.length;i<s;i++)for(n=0,o=(a=(r=this._parts[i]).length)-1;n<a;o=n++)if((e||0!==n)&&Tt(t,r[o],r[n])<=h)return!0;return!1}});zi._flat=St;var Bi=zi.extend({options:{fill:!0},isEmpty:function(){return!this._latlngs.length||!this._latlngs[0].length},getCenter:function(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");var t,e,i,n,o,s,a,r,h,l=this._rings[0],c=l.length;if(!c)return null;for(t=s=a=r=0,e=c-1;t<c;e=t++)i=l[t],n=l[e],o=i.y*n.x-n.y*i.x,a+=(i.x+n.x)*o,r+=(i.y+n.y)*o,s+=3*o;return h=0===s?l[0]:[a/s,r/s],this._map.layerPointToLatLng(h)},_convertLatLngs:function(t){var e=zi.prototype._convertLatLngs.call(this,t),t=e.length;return 2<=t&&e[0]instanceof k&&e[0].equals(e[t-1])&&e.pop(),e},_setLatLngs:function(t){zi.prototype._setLatLngs.call(this,t),Et(this._latlngs)&&(this._latlngs=[this._latlngs])},_defaultShape:function(){return(Et(this._latlngs[0])?this._latlngs:this._latlngs[0])[0]},_clipPoints:function(){var t=this._renderer._bounds,e=this.options.weight,e=new y(e,e),t=new w(t.min.subtract(e),t.max.add(e));if(this._parts=[],this._pxBounds&&this._pxBounds.intersects(t))if(this.options.noClip)this._parts=this._rings;else for(var i,n=0,o=this._rings.length;n<o;n++)(i=zt(this._rings[n],t,!0)).length&&this._parts.push(i)},_updatePath:function(){this._renderer._updatePoly(this,!0)},_containsPoint:function(t){var e,i,n,o,s,a,r,h,l=!1;if(!this._pxBounds||!this._pxBounds.contains(t))return!1;for(o=0,r=this._parts.length;o<r;o++)for(s=0,a=(h=(e=this._parts[o]).length)-1;s<h;a=s++)i=e[s],n=e[a],i.y>t.y!=n.y>t.y&&t.x<(n.x-i.x)*(t.y-i.y)/(n.y-i.y)+i.x&&(l=!l);return l||zi.prototype._containsPoint.call(this,t,!0)}}),Ii=Li.extend({initialize:function(t,e){s(this,e),this._layers={},t&&this.addData(t)},addData:function(t){var e,i,n,o=Vt(t)?t:t.features;if(o){for(e=0,i=o.length;e<i;e++)((n=o[e]).geometries||n.geometry||n.features||n.coordinates)&&this.addData(n);return this}var s=this.options;if(s.filter&&!s.filter(t))return this;var a=Bt(t,s);return a?(a.feature=Dt(t),a.defaultOptions=a.options,this.resetStyle(a),s.onEachFeature&&s.onEachFeature(t,a),this.addLayer(a)):this},resetStyle:function(t){return t.options=h({},t.defaultOptions),this._setLayerStyle(t,this.options.style),this},setStyle:function(e){return this.eachLayer(function(t){this._setLayerStyle(t,e)},this)},_setLayerStyle:function(t,e){"function"==typeof e&&(e=e(t.feature)),t.setStyle&&t.setStyle(e)}}),ve={toGeoJSON:function(t){return Ot(this,{type:"Point",coordinates:At(this.getLatLng(),t)})}};Mi.include(ve),Si.include(ve),Ei.include(ve),zi.include({toGeoJSON:function(t){var e=!Et(this._latlngs);return Ot(this,{type:(e?"Multi":"")+"LineString",coordinates:Zt(this._latlngs,e?1:0,!1,t)})}}),Bi.include({toGeoJSON:function(t){var e=!Et(this._latlngs),i=e&&!Et(this._latlngs[0]),t=Zt(this._latlngs,i?2:e?1:0,!0,t);return Ot(this,{type:(i?"Multi":"")+"Polygon",coordinates:t=!e?[t]:t})}}),bi.include({toMultiPoint:function(e){var i=[];return this.eachLayer(function(t){i.push(t.toGeoJSON(e).geometry.coordinates)}),Ot(this,{type:"MultiPoint",coordinates:i})},toGeoJSON:function(e){var t=this.feature&&this.feature.geometry&&this.feature.geometry.type;if("MultiPoint"===t)return this.toMultiPoint(e);var i="GeometryCollection"===t,n=[];return this.eachLayer(function(t){t.toGeoJSON&&(t=t.toGeoJSON(e),i?n.push(t.geometry):"FeatureCollection"===(t=Dt(t)).type?n.push.apply(n,t.features):n.push(t))}),i?Ot(this,{geometries:n,type:"GeometryCollection"}):{type:"FeatureCollection",features:n}}});var Le=Rt,Ni=wi.extend({options:{opacity:1,alt:"",interactive:!1,crossOrigin:!1,errorOverlayUrl:"",zIndex:1,className:""},initialize:function(t,e,i){this._url=t,this._bounds=P(e),s(this,i)},onAdd:function(){this._image||(this._initImage(),this.options.opacity<1&&this._updateOpacity()),this.options.interactive&&(Y(this._image,"leaflet-interactive"),this.addInteractiveTarget(this._image)),this.getPane().appendChild(this._image),this._reset()},onRemove:function(){H(this._image),this.options.interactive&&this.removeInteractiveTarget(this._image)},setOpacity:function(t){return this.options.opacity=t,this._image&&this._updateOpacity(),this},setStyle:function(t){return t.opacity&&this.setOpacity(t.opacity),this},bringToFront:function(){return this._map&&G(this._image),this},bringToBack:function(){return this._map&&q(this._image),this},setUrl:function(t){return this._url=t,this._image&&(this._image.src=t),this},setBounds:function(t){return this._bounds=P(t),this._map&&this._reset(),this},getEvents:function(){var t={zoom:this._reset,viewreset:this._reset};return this._zoomAnimated&&(t.zoomanim=this._animateZoom),t},setZIndex:function(t){return this.options.zIndex=t,this._updateZIndex(),this},getBounds:function(){return this._bounds},getElement:function(){return this._image},_initImage:function(){var t="IMG"===this._url.tagName,e=this._image=t?this._url:F("img");Y(e,"leaflet-image-layer"),this._zoomAnimated&&Y(e,"leaflet-zoom-animated"),this.options.className&&Y(e,this.options.className),e.onselectstart=l,e.onmousemove=l,e.onload=p(this.fire,this,"load"),e.onerror=p(this._overlayOnError,this,"error"),!this.options.crossOrigin&&""!==this.options.crossOrigin||(e.crossOrigin=!0===this.options.crossOrigin?"":this.options.crossOrigin),this.options.zIndex&&this._updateZIndex(),t?this._url=e.src:(e.src=this._url,e.alt=this.options.alt)},_animateZoom:function(t){var e=this._map.getZoomScale(t.zoom),t=this._map._latLngBoundsToNewLayerBounds(this._bounds,t.zoom,t.center).min;tt(this._image,t,e)},_reset:function(){var t=this._image,e=new w(this._map.latLngToLayerPoint(this._bounds.getNorthWest()),this._map.latLngToLayerPoint(this._bounds.getSouthEast())),i=e.getSize();et(t,e.min),t.style.width=i.x+"px",t.style.height=i.y+"px"},_updateOpacity:function(){J(this._image,this.options.opacity)},_updateZIndex:function(){this._image&&void 0!==this.options.zIndex&&null!==this.options.zIndex&&(this._image.style.zIndex=this.options.zIndex)},_overlayOnError:function(){this.fire("error");var t=this.options.errorOverlayUrl;t&&this._url!==t&&(this._url=t,this._image.src=t)}}),Ai=Ni.extend({options:{autoplay:!0,loop:!0},_initImage:function(){var t="VIDEO"===this._url.tagName,e=this._image=t?this._url:F("video");if(Y(e,"leaflet-image-layer"),this._zoomAnimated&&Y(e,"leaflet-zoom-animated"),e.onselectstart=l,e.onmousemove=l,e.onloadeddata=p(this.fire,this,"load"),t){for(var i=e.getElementsByTagName("source"),n=[],o=0;o<i.length;o++)n.push(i[o].src);this._url=0<i.length?n:[e.src]}else{Vt(this._url)||(this._url=[this._url]),e.autoplay=!!this.options.autoplay,e.loop=!!this.options.loop;for(var s=0;s<this._url.length;s++){var a=F("source");a.src=this._url[s],e.appendChild(a)}}}}),Zi=wi.extend({options:{offset:[0,7],className:"",pane:"popupPane"},initialize:function(t,e){s(this,t),this._source=e},onAdd:function(t){this._zoomAnimated=t._zoomAnimated,this._container||this._initLayout(),t._fadeAnimated&&J(this._container,0),clearTimeout(this._removeTimeout),this.getPane().appendChild(this._container),this.update(),t._fadeAnimated&&J(this._container,1),this.bringToFront()},onRemove:function(t){t._fadeAnimated?(J(this._container,0),this._removeTimeout=setTimeout(p(H,void 0,this._container),200)):H(this._container)},getLatLng:function(){return this._latlng},setLatLng:function(t){return this._latlng=M(t),this._map&&(this._updatePosition(),this._adjustPan()),this},getContent:function(){return this._content},setContent:function(t){return this._content=t,this.update(),this},getElement:function(){return this._container},update:function(){this._map&&(this._container.style.visibility="hidden",this._updateContent(),this._updateLayout(),this._updatePosition(),this._container.style.visibility="",this._adjustPan())},getEvents:function(){var t={zoom:this._updatePosition,viewreset:this._updatePosition};return this._zoomAnimated&&(t.zoomanim=this._animateZoom),t},isOpen:function(){return!!this._map&&this._map.hasLayer(this)},bringToFront:function(){return this._map&&G(this._container),this},bringToBack:function(){return this._map&&q(this._container),this},_updateContent:function(){if(this._content){var t=this._contentNode,e="function"==typeof this._content?this._content(this._source||this):this._content;if("string"==typeof e)t.innerHTML=e;else{for(;t.hasChildNodes();)t.removeChild(t.firstChild);t.appendChild(e)}this.fire("contentupdate")}},_updatePosition:function(){var t,e,i;this._map&&(t=this._map.latLngToLayerPoint(this._latlng),i=v(this.options.offset),e=this._getAnchor(),this._zoomAnimated?et(this._container,t.add(e)):i=i.add(t).add(e),e=this._containerBottom=-i.y,i=this._containerLeft=-Math.round(this._containerWidth/2)+i.x,this._container.style.bottom=e+"px",this._container.style.left=i+"px")},_getAnchor:function(){return[0,0]}}),Oi=Zi.extend({options:{maxWidth:300,minWidth:50,maxHeight:null,autoPan:!0,autoPanPaddingTopLeft:null,autoPanPaddingBottomRight:null,autoPanPadding:[5,5],keepInView:!1,closeButton:!0,autoClose:!0,closeOnEscapeKey:!0,className:""},openOn:function(t){return t.openPopup(this),this},onAdd:function(t){Zi.prototype.onAdd.call(this,t),t.fire("popupopen",{popup:this}),this._source&&(this._source.fire("popupopen",{popup:this},!0),this._source instanceof Ci||this._source.on("preclick",dt))},onRemove:function(t){Zi.prototype.onRemove.call(this,t),t.fire("popupclose",{popup:this}),this._source&&(this._source.fire("popupclose",{popup:this},!0),this._source instanceof Ci||this._source.off("preclick",dt))},getEvents:function(){var t=Zi.prototype.getEvents.call(this);return(void 0!==this.options.closeOnClick?this.options.closeOnClick:this._map.options.closePopupOnClick)&&(t.preclick=this._close),this.options.keepInView&&(t.moveend=this._adjustPan),t},_close:function(){this._map&&this._map.closePopup(this)},_initLayout:function(){var t="leaflet-popup",e=this._container=F("div",t+" "+(this.options.className||"")+" leaflet-zoom-animated"),i=this._wrapper=F("div",t+"-content-wrapper",e);this._contentNode=F("div",t+"-content",i),mt(i),_t(this._contentNode),lt(i,"contextmenu",dt),this._tipContainer=F("div",t+"-tip-container",e),this._tip=F("div",t+"-tip",this._tipContainer),this.options.closeButton&&((e=this._closeButton=F("a",t+"-close-button",e)).href="#close",e.innerHTML="&#215;",lt(e,"click",this._onCloseButtonClick,this))},_updateLayout:function(){var t=this._contentNode,e=t.style;e.width="",e.whiteSpace="nowrap";var i=t.offsetWidth,i=Math.min(i,this.options.maxWidth);i=Math.max(i,this.options.minWidth),e.width=i+1+"px",e.whiteSpace="",e.height="";var n=t.offsetHeight,i=this.options.maxHeight;i&&i<n?(e.height=i+"px",Y(t,"leaflet-popup-scrolled")):$(t,"leaflet-popup-scrolled"),this._containerWidth=this._container.offsetWidth},_animateZoom:function(t){var e=this._map._latLngToNewLayerPoint(this._latlng,t.zoom,t.center),t=this._getAnchor();et(this._container,e.add(t))},_adjustPan:function(){var t,e,i,n,o,s,a,r;this.options.autoPan&&(this._map._panAnim&&this._map._panAnim.stop(),t=this._map,o=parseInt(j(this._container,"marginBottom"),10)||0,e=this._container.offsetHeight+o,r=this._containerWidth,(s=new y(this._containerLeft,-e-this._containerBottom))._add(it(this._container)),i=t.layerPointToContainerPoint(s),a=v(this.options.autoPanPadding),n=v(this.options.autoPanPaddingTopLeft||a),o=v(this.options.autoPanPaddingBottomRight||a),s=t.getSize(),a=0,i.x+r+o.x>s.x&&(a=i.x+r-s.x+o.x),i.x-a-n.x<(r=0)&&(a=i.x-n.x),i.y+e+o.y>s.y&&(r=i.y+e-s.y+o.y),i.y-r-n.y<0&&(r=i.y-n.y),(a||r)&&t.fire("autopanstart").panBy([a,r]))},_onCloseButtonClick:function(t){this._close(),gt(t)},_getAnchor:function(){return v(this._source&&this._source._getPopupAnchor?this._source._getPopupAnchor():[0,0])}});li.mergeOptions({closePopupOnClick:!0}),li.include({openPopup:function(t,e,i){return t instanceof Oi||(t=new Oi(i).setContent(t)),e&&t.setLatLng(e),this.hasLayer(t)?this:(this._popup&&this._popup.options.autoClose&&this.closePopup(),this._popup=t,this.addLayer(t))},closePopup:function(t){return t&&t!==this._popup||(t=this._popup,this._popup=null),t&&this.removeLayer(t),this}}),wi.include({bindPopup:function(t,e){return t instanceof Oi?(s(t,e),(this._popup=t)._source=this):(this._popup&&!e||(this._popup=new Oi(e,this)),this._popup.setContent(t)),this._popupHandlersAdded||(this.on({click:this._openPopup,keypress:this._onKeyPress,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!0),this},unbindPopup:function(){return this._popup&&(this.off({click:this._openPopup,keypress:this._onKeyPress,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!1,this._popup=null),this},openPopup:function(t,e){if(t instanceof wi||(e=t,t=this),t instanceof Li)for(var i in this._layers){t=this._layers[i];break}return e=e||(t.getCenter?t.getCenter():t.getLatLng()),this._popup&&this._map&&(this._popup._source=t,this._popup.update(),this._map.openPopup(this._popup,e)),this},closePopup:function(){return this._popup&&this._popup._close(),this},togglePopup:function(t){return this._popup&&(this._popup._map?this.closePopup():this.openPopup(t)),this},isPopupOpen:function(){return!!this._popup&&this._popup.isOpen()},setPopupContent:function(t){return this._popup&&this._popup.setContent(t),this},getPopup:function(){return this._popup},_openPopup:function(t){var e=t.layer||t.target;this._popup&&this._map&&(gt(t),e instanceof Ci?this.openPopup(t.layer||t.target,t.latlng):this._map.hasLayer(this._popup)&&this._popup._source===e?this.closePopup():this.openPopup(e,t.latlng))},_movePopup:function(t){this._popup.setLatLng(t.latlng)},_onKeyPress:function(t){13===t.originalEvent.keyCode&&this._openPopup(t)}});var Di=Zi.extend({options:{pane:"tooltipPane",offset:[0,0],direction:"auto",permanent:!1,sticky:!1,interactive:!1,opacity:.9},onAdd:function(t){Zi.prototype.onAdd.call(this,t),this.setOpacity(this.options.opacity),t.fire("tooltipopen",{tooltip:this}),this._source&&this._source.fire("tooltipopen",{tooltip:this},!0)},onRemove:function(t){Zi.prototype.onRemove.call(this,t),t.fire("tooltipclose",{tooltip:this}),this._source&&this._source.fire("tooltipclose",{tooltip:this},!0)},getEvents:function(){var t=Zi.prototype.getEvents.call(this);return Ze&&!this.options.permanent&&(t.preclick=this._close),t},_close:function(){this._map&&this._map.closeTooltip(this)},_initLayout:function(){var t="leaflet-tooltip "+(this.options.className||"")+" leaflet-zoom-"+(this._zoomAnimated?"animated":"hide");this._contentNode=this._container=F("div",t)},_updateLayout:function(){},_adjustPan:function(){},_setPosition:function(t){var e=this._map,i=this._container,n=e.latLngToContainerPoint(e.getCenter()),o=e.layerPointToContainerPoint(t),s=this.options.direction,a=i.offsetWidth,r=i.offsetHeight,h=v(this.options.offset),e=this._getAnchor();t="top"===s?t.add(v(-a/2+h.x,-r+h.y+e.y,!0)):"bottom"===s?t.subtract(v(a/2-h.x,-h.y,!0)):"center"===s?t.subtract(v(a/2+h.x,r/2-e.y+h.y,!0)):"right"===s||"auto"===s&&o.x<n.x?(s="right",t.add(v(h.x+e.x,e.y-r/2+h.y,!0))):(s="left",t.subtract(v(a+e.x-h.x,r/2-e.y-h.y,!0))),$(i,"leaflet-tooltip-right"),$(i,"leaflet-tooltip-left"),$(i,"leaflet-tooltip-top"),$(i,"leaflet-tooltip-bottom"),Y(i,"leaflet-tooltip-"+s),et(i,t)},_updatePosition:function(){var t=this._map.latLngToLayerPoint(this._latlng);this._setPosition(t)},setOpacity:function(t){this.options.opacity=t,this._container&&J(this._container,t)},_animateZoom:function(t){t=this._map._latLngToNewLayerPoint(this._latlng,t.zoom,t.center);this._setPosition(t)},_getAnchor:function(){return v(this._source&&this._source._getTooltipAnchor&&!this.options.sticky?this._source._getTooltipAnchor():[0,0])}});li.include({openTooltip:function(t,e,i){return t instanceof Di||(t=new Di(i).setContent(t)),e&&t.setLatLng(e),this.hasLayer(t)?this:this.addLayer(t)},closeTooltip:function(t){return t&&this.removeLayer(t),this}}),wi.include({bindTooltip:function(t,e){return t instanceof Di?(s(t,e),(this._tooltip=t)._source=this):(this._tooltip&&!e||(this._tooltip=new Di(e,this)),this._tooltip.setContent(t)),this._initTooltipInteractions(),this._tooltip.options.permanent&&this._map&&this._map.hasLayer(this)&&this.openTooltip(),this},unbindTooltip:function(){return this._tooltip&&(this._initTooltipInteractions(!0),this.closeTooltip(),this._tooltip=null),this},_initTooltipInteractions:function(t){var e,i;!t&&this._tooltipHandlersAdded||(e=t?"off":"on",i={remove:this.closeTooltip,move:this._moveTooltip},this._tooltip.options.permanent?i.add=this._openTooltip:(i.mouseover=this._openTooltip,i.mouseout=this.closeTooltip,this._tooltip.options.sticky&&(i.mousemove=this._moveTooltip),Ze&&(i.click=this._openTooltip)),this[e](i),this._tooltipHandlersAdded=!t)},openTooltip:function(t,e){if(t instanceof wi||(e=t,t=this),t instanceof Li)for(var i in this._layers){t=this._layers[i];break}return e=e||(t.getCenter?t.getCenter():t.getLatLng()),this._tooltip&&this._map&&(this._tooltip._source=t,this._tooltip.update(),this._map.openTooltip(this._tooltip,e),this._tooltip.options.interactive&&this._tooltip._container&&(Y(this._tooltip._container,"leaflet-clickable"),this.addInteractiveTarget(this._tooltip._container))),this},closeTooltip:function(){return this._tooltip&&(this._tooltip._close(),this._tooltip.options.interactive&&this._tooltip._container&&($(this._tooltip._container,"leaflet-clickable"),this.removeInteractiveTarget(this._tooltip._container))),this},toggleTooltip:function(t){return this._tooltip&&(this._tooltip._map?this.closeTooltip():this.openTooltip(t)),this},isTooltipOpen:function(){return this._tooltip.isOpen()},setTooltipContent:function(t){return this._tooltip&&this._tooltip.setContent(t),this},getTooltip:function(){return this._tooltip},_openTooltip:function(t){var e=t.layer||t.target;this._tooltip&&this._map&&this.openTooltip(e,this._tooltip.options.sticky?t.latlng:void 0)},_moveTooltip:function(t){var e=t.latlng;this._tooltip.options.sticky&&t.originalEvent&&(t=this._map.mouseEventToContainerPoint(t.originalEvent),t=this._map.containerPointToLayerPoint(t),e=this._map.layerPointToLatLng(t)),this._tooltip.setLatLng(e)}});var Ri=Ti.extend({options:{iconSize:[12,12],html:!1,bgPos:null,className:"leaflet-div-icon"},createIcon:function(t){var e=t&&"DIV"===t.tagName?t:document.createElement("div"),t=this.options;return e.innerHTML=!1!==t.html?t.html:"",t.bgPos&&(t=v(t.bgPos),e.style.backgroundPosition=-t.x+"px "+-t.y+"px"),this._setIconStyles(e,"icon"),e},createShadow:function(){return null}});Ti.Default=Pi;var Ui=wi.extend({options:{tileSize:256,opacity:1,updateWhenIdle:Be,updateWhenZooming:!0,updateInterval:200,zIndex:1,bounds:null,minZoom:0,maxZoom:void 0,maxNativeZoom:void 0,minNativeZoom:void 0,noWrap:!1,pane:"tilePane",className:"",keepBuffer:2},initialize:function(t){s(this,t)},onAdd:function(){this._initContainer(),this._levels={},this._tiles={},this._resetView(),this._update()},beforeAdd:function(t){t._addZoomLimit(this)},onRemove:function(t){this._removeAllTiles(),H(this._container),t._removeZoomLimit(this),this._container=null,this._tileZoom=void 0},bringToFront:function(){return this._map&&(G(this._container),this._setAutoZIndex(Math.max)),this},bringToBack:function(){return this._map&&(q(this._container),this._setAutoZIndex(Math.min)),this},getContainer:function(){return this._container},setOpacity:function(t){return this.options.opacity=t,this._updateOpacity(),this},setZIndex:function(t){return this.options.zIndex=t,this._updateZIndex(),this},isLoading:function(){return this._loading},redraw:function(){return this._map&&(this._removeAllTiles(),this._update()),this},getEvents:function(){var t={viewprereset:this._invalidateAll,viewreset:this._resetView,zoom:this._resetView,moveend:this._onMoveEnd};return this.options.updateWhenIdle||(this._onMove||(this._onMove=e(this._onMoveEnd,this.options.updateInterval,this)),t.move=this._onMove),this._zoomAnimated&&(t.zoomanim=this._animateZoom),t},createTile:function(){return document.createElement("div")},getTileSize:function(){var t=this.options.tileSize;return t instanceof y?t:new y(t,t)},_updateZIndex:function(){this._container&&void 0!==this.options.zIndex&&null!==this.options.zIndex&&(this._container.style.zIndex=this.options.zIndex)},_setAutoZIndex:function(t){for(var e,i=this.getPane().children,n=-t(-1/0,1/0),o=0,s=i.length;o<s;o++)e=i[o].style.zIndex,i[o]!==this._container&&e&&(n=t(n,+e));isFinite(n)&&(this.options.zIndex=n+t(-1,1),this._updateZIndex())},_updateOpacity:function(){if(this._map&&!_e){J(this._container,this.options.opacity);var t,e=+new Date,i=!1,n=!1;for(t in this._tiles){var o,s=this._tiles[t];s.current&&s.loaded&&(o=Math.min(1,(e-s.loaded)/200),J(s.el,o),o<1?i=!0:(s.active?n=!0:this._onOpaqueTile(s),s.active=!0))}n&&!this._noPrune&&this._pruneTiles(),i&&(f(this._fadeFrame),this._fadeFrame=x(this._updateOpacity,this))}},_onOpaqueTile:l,_initContainer:function(){this._container||(this._container=F("div","leaflet-layer "+(this.options.className||"")),this._updateZIndex(),this.options.opacity<1&&this._updateOpacity(),this.getPane().appendChild(this._container))},_updateLevels:function(){var t=this._tileZoom,e=this.options.maxZoom;if(void 0!==t){for(var i in this._levels)this._levels[i].el.children.length||i===t?(this._levels[i].el.style.zIndex=e-Math.abs(t-i),this._onUpdateLevel(i)):(H(this._levels[i].el),this._removeTilesAtZoom(i),this._onRemoveLevel(i),delete this._levels[i]);var n=this._levels[t],o=this._map;return n||((n=this._levels[t]={}).el=F("div","leaflet-tile-container leaflet-zoom-animated",this._container),n.el.style.zIndex=e,n.origin=o.project(o.unproject(o.getPixelOrigin()),t).round(),n.zoom=t,this._setZoomTransform(n,o.getCenter(),o.getZoom()),n.el.offsetWidth,this._onCreateLevel(n)),this._level=n}},_onUpdateLevel:l,_onRemoveLevel:l,_onCreateLevel:l,_pruneTiles:function(){if(this._map){var t,e,i,n=this._map.getZoom();if(n>this.options.maxZoom||n<this.options.minZoom)this._removeAllTiles();else{for(t in this._tiles)(e=this._tiles[t]).retain=e.current;for(t in this._tiles)(e=this._tiles[t]).current&&!e.active&&(i=e.coords,this._retainParent(i.x,i.y,i.z,i.z-5)||this._retainChildren(i.x,i.y,i.z,i.z+2));for(t in this._tiles)this._tiles[t].retain||this._removeTile(t)}}},_removeTilesAtZoom:function(t){for(var e in this._tiles)this._tiles[e].coords.z===t&&this._removeTile(e)},_removeAllTiles:function(){for(var t in this._tiles)this._removeTile(t)},_invalidateAll:function(){for(var t in this._levels)H(this._levels[t].el),this._onRemoveLevel(t),delete this._levels[t];this._removeAllTiles(),this._tileZoom=void 0},_retainParent:function(t,e,i,n){var o=Math.floor(t/2),t=Math.floor(e/2),e=i-1,i=new y(+o,+t);i.z=+e;i=this._tileCoordsToKey(i),i=this._tiles[i];return i&&i.active?i.retain=!0:(i&&i.loaded&&(i.retain=!0),n<e&&this._retainParent(o,t,e,n))},_retainChildren:function(t,e,i,n){for(var o=2*t;o<2*t+2;o++)for(var s=2*e;s<2*e+2;s++){var a=new y(o,s);a.z=i+1;a=this._tileCoordsToKey(a),a=this._tiles[a];a&&a.active?a.retain=!0:(a&&a.loaded&&(a.retain=!0),i+1<n&&this._retainChildren(o,s,i+1,n))}},_resetView:function(t){t=t&&(t.pinch||t.flyTo);this._setView(this._map.getCenter(),this._map.getZoom(),t,t)},_animateZoom:function(t){this._setView(t.center,t.zoom,!0,t.noUpdate)},_clampZoom:function(t){var e=this.options;return void 0!==e.minNativeZoom&&t<e.minNativeZoom?e.minNativeZoom:void 0!==e.maxNativeZoom&&e.maxNativeZoom<t?e.maxNativeZoom:t},_setView:function(t,e,i,n){var o=this._clampZoom(Math.round(e));(void 0!==this.options.maxZoom&&o>this.options.maxZoom||void 0!==this.options.minZoom&&o<this.options.minZoom)&&(o=void 0);var s=this.options.updateWhenZooming&&o!==this._tileZoom;n&&!s||(this._tileZoom=o,this._abortLoading&&this._abortLoading(),this._updateLevels(),this._resetGrid(),void 0!==o&&this._update(t),i||this._pruneTiles(),this._noPrune=!!i),this._setZoomTransforms(t,e)},_setZoomTransforms:function(t,e){for(var i in this._levels)this._setZoomTransform(this._levels[i],t,e)},_setZoomTransform:function(t,e,i){var n=this._map.getZoomScale(i,t.zoom),i=t.origin.multiplyBy(n).subtract(this._map._getNewPixelOrigin(e,i)).round();ze?tt(t.el,i,n):et(t.el,i)},_resetGrid:function(){var t=this._map,e=t.options.crs,i=this._tileSize=this.getTileSize(),n=this._tileZoom,o=this._map.getPixelWorldBounds(this._tileZoom);o&&(this._globalTileRange=this._pxBoundsToTileRange(o)),this._wrapX=e.wrapLng&&!this.options.noWrap&&[Math.floor(t.project([0,e.wrapLng[0]],n).x/i.x),Math.ceil(t.project([0,e.wrapLng[1]],n).x/i.y)],this._wrapY=e.wrapLat&&!this.options.noWrap&&[Math.floor(t.project([e.wrapLat[0],0],n).y/i.x),Math.ceil(t.project([e.wrapLat[1],0],n).y/i.y)]},_onMoveEnd:function(){this._map&&!this._map._animatingZoom&&this._update()},_getTiledPixelBounds:function(t){var e=this._map,i=e._animatingZoom?Math.max(e._animateToZoom,e.getZoom()):e.getZoom(),i=e.getZoomScale(i,this._tileZoom),t=e.project(t,this._tileZoom).floor(),i=e.getSize().divideBy(2*i);return new w(t.subtract(i),t.add(i))},_update:function(t){var e=this._map;if(e){var i=this._clampZoom(e.getZoom());if(void 0===t&&(t=e.getCenter()),void 0!==this._tileZoom){var n,e=this._getTiledPixelBounds(t),o=this._pxBoundsToTileRange(e),s=o.getCenter(),a=[],e=this.options.keepBuffer,r=new w(o.getBottomLeft().subtract([e,-e]),o.getTopRight().add([e,-e]));if(!(isFinite(o.min.x)&&isFinite(o.min.y)&&isFinite(o.max.x)&&isFinite(o.max.y)))throw new Error("Attempted to load an infinite number of tiles");for(n in this._tiles){var h=this._tiles[n].coords;h.z===this._tileZoom&&r.contains(new y(h.x,h.y))||(this._tiles[n].current=!1)}if(1<Math.abs(i-this._tileZoom))this._setView(t,i);else{for(var l=o.min.y;l<=o.max.y;l++)for(var c=o.min.x;c<=o.max.x;c++){var u,p=new y(c,l);p.z=this._tileZoom,this._isValidTile(p)&&((u=this._tiles[this._tileCoordsToKey(p)])?u.current=!0:a.push(p))}if(a.sort(function(t,e){return t.distanceTo(s)-e.distanceTo(s)}),0!==a.length){this._loading||(this._loading=!0,this.fire("loading"));for(var d=document.createDocumentFragment(),c=0;c<a.length;c++)this._addTile(a[c],d);this._level.el.appendChild(d)}}}}},_isValidTile:function(t){var e=this._map.options.crs;if(!e.infinite){var i=this._globalTileRange;if(!e.wrapLng&&(t.x<i.min.x||t.x>i.max.x)||!e.wrapLat&&(t.y<i.min.y||t.y>i.max.y))return!1}if(!this.options.bounds)return!0;t=this._tileCoordsToBounds(t);return P(this.options.bounds).overlaps(t)},_keyToBounds:function(t){return this._tileCoordsToBounds(this._keyToTileCoords(t))},_tileCoordsToNwSe:function(t){var e=this._map,i=this.getTileSize(),n=t.scaleBy(i),i=n.add(i);return[e.unproject(n,t.z),e.unproject(i,t.z)]},_tileCoordsToBounds:function(t){t=this._tileCoordsToNwSe(t),t=new T(t[0],t[1]);return t=!this.options.noWrap?this._map.wrapLatLngBounds(t):t},_tileCoordsToKey:function(t){return t.x+":"+t.y+":"+t.z},_keyToTileCoords:function(t){var e=t.split(":"),t=new y(+e[0],+e[1]);return t.z=+e[2],t},_removeTile:function(t){var e=this._tiles[t];e&&(H(e.el),delete this._tiles[t],this.fire("tileunload",{tile:e.el,coords:this._keyToTileCoords(t)}))},_initTile:function(t){Y(t,"leaflet-tile");var e=this.getTileSize();t.style.width=e.x+"px",t.style.height=e.y+"px",t.onselectstart=l,t.onmousemove=l,_e&&this.options.opacity<1&&J(t,this.options.opacity),ge&&!ye&&(t.style.WebkitBackfaceVisibility="hidden")},_addTile:function(t,e){var i=this._getTilePos(t),n=this._tileCoordsToKey(t),o=this.createTile(this._wrapCoords(t),p(this._tileReady,this,t));this._initTile(o),this.createTile.length<2&&x(p(this._tileReady,this,t,null,o)),et(o,i),this._tiles[n]={el:o,coords:t,current:!0},e.appendChild(o),this.fire("tileloadstart",{tile:o,coords:t})},_tileReady:function(t,e,i){e&&this.fire("tileerror",{error:e,tile:i,coords:t});var n=this._tileCoordsToKey(t);(i=this._tiles[n])&&(i.loaded=+new Date,this._map._fadeAnimated?(J(i.el,0),f(this._fadeFrame),this._fadeFrame=x(this._updateOpacity,this)):(i.active=!0,this._pruneTiles()),e||(Y(i.el,"leaflet-tile-loaded"),this.fire("tileload",{tile:i.el,coords:t})),this._noTilesToLoad()&&(this._loading=!1,this.fire("load"),_e||!this._map._fadeAnimated?x(this._pruneTiles,this):setTimeout(p(this._pruneTiles,this),250)))},_getTilePos:function(t){return t.scaleBy(this.getTileSize()).subtract(this._level.origin)},_wrapCoords:function(t){var e=new y(this._wrapX?i(t.x,this._wrapX):t.x,this._wrapY?i(t.y,this._wrapY):t.y);return e.z=t.z,e},_pxBoundsToTileRange:function(t){var e=this.getTileSize();return new w(t.min.unscaleBy(e).floor(),t.max.unscaleBy(e).ceil().subtract([1,1]))},_noTilesToLoad:function(){for(var t in this._tiles)if(!this._tiles[t].loaded)return!1;return!0}}),ji=Ui.extend({options:{minZoom:0,maxZoom:18,subdomains:"abc",errorTileUrl:"",zoomOffset:0,tms:!1,zoomReverse:!1,detectRetina:!1,crossOrigin:!1},initialize:function(t,e){this._url=t,(e=s(this,e)).detectRetina&&De&&0<e.maxZoom&&(e.tileSize=Math.floor(e.tileSize/2),e.zoomReverse?(e.zoomOffset--,e.minZoom++):(e.zoomOffset++,e.maxZoom--),e.minZoom=Math.max(0,e.minZoom)),"string"==typeof e.subdomains&&(e.subdomains=e.subdomains.split("")),ge||this.on("tileunload",this._onTileRemove)},setUrl:function(t,e){return this._url===t&&void 0===e&&(e=!0),this._url=t,e||this.redraw(),this},createTile:function(t,e){var i=document.createElement("img");return lt(i,"load",p(this._tileOnLoad,this,e,i)),lt(i,"error",p(this._tileOnError,this,e,i)),!this.options.crossOrigin&&""!==this.options.crossOrigin||(i.crossOrigin=!0===this.options.crossOrigin?"":this.options.crossOrigin),i.alt="",i.setAttribute("role","presentation"),i.src=this.getTileUrl(t),i},getTileUrl:function(t){var e={r:De?"@2x":"",s:this._getSubdomain(t),x:t.x,y:t.y,z:this._getZoomForUrl()};return this._map&&!this._map.options.crs.infinite&&(t=this._globalTileRange.max.y-t.y,this.options.tms&&(e.y=t),e["-y"]=t),u(this._url,h(e,this.options))},_tileOnLoad:function(t,e){_e?setTimeout(p(t,this,null,e),0):t(null,e)},_tileOnError:function(t,e,i){var n=this.options.errorTileUrl;n&&e.getAttribute("src")!==n&&(e.src=n),t(i,e)},_onTileRemove:function(t){t.tile.onload=null},_getZoomForUrl:function(){var t=this._tileZoom,e=this.options.maxZoom;return(t=this.options.zoomReverse?e-t:t)+this.options.zoomOffset},_getSubdomain:function(t){t=Math.abs(t.x+t.y)%this.options.subdomains.length;return this.options.subdomains[t]},_abortLoading:function(){var t,e;for(t in this._tiles)this._tiles[t].coords.z!==this._tileZoom&&((e=this._tiles[t].el).onload=l,e.onerror=l,e.complete||(e.src=Yt,H(e),delete this._tiles[t]))},_removeTile:function(t){var e=this._tiles[t];if(e)return xe||e.el.setAttribute("src",Yt),Ui.prototype._removeTile.call(this,t)},_tileReady:function(t,e,i){if(this._map&&(!i||i.getAttribute("src")!==Yt))return Ui.prototype._tileReady.call(this,t,e,i)}}),Fi=ji.extend({defaultWmsParams:{service:"WMS",request:"GetMap",layers:"",styles:"",format:"image/jpeg",transparent:!1,version:"1.1.1"},options:{crs:null,uppercase:!1},initialize:function(t,e){this._url=t;var i,n=h({},this.defaultWmsParams);for(i in e)i in this.options||(n[i]=e[i]);var o=(e=s(this,e)).detectRetina&&De?2:1,t=this.getTileSize();n.width=t.x*o,n.height=t.y*o,this.wmsParams=n},onAdd:function(t){this._crs=this.options.crs||t.options.crs,this._wmsVersion=parseFloat(this.wmsParams.version);var e=1.3<=this._wmsVersion?"crs":"srs";this.wmsParams[e]=this._crs.code,ji.prototype.onAdd.call(this,t)},getTileUrl:function(t){var e=this._tileCoordsToNwSe(t),i=this._crs,i=b(i.project(e[0]),i.project(e[1])),e=i.min,i=i.max,i=(1.3<=this._wmsVersion&&this._crs===xi?[e.y,e.x,i.y,i.x]:[e.x,e.y,i.x,i.y]).join(","),t=ji.prototype.getTileUrl.call(this,t);return t+a(this.wmsParams,t,this.options.uppercase)+(this.options.uppercase?"&BBOX=":"&bbox=")+i},setParams:function(t,e){return h(this.wmsParams,t),e||this.redraw(),this}});ji.WMS=Fi,Ut.wms=function(t,e){return new Fi(t,e)};var Hi=wi.extend({options:{padding:.1,tolerance:0},initialize:function(t){s(this,t),r(this),this._layers=this._layers||{}},onAdd:function(){this._container||(this._initContainer(),this._zoomAnimated&&Y(this._container,"leaflet-zoom-animated")),this.getPane().appendChild(this._container),this._update(),this.on("update",this._updatePaths,this)},onRemove:function(){this.off("update",this._updatePaths,this),this._destroyContainer()},getEvents:function(){var t={viewreset:this._reset,zoom:this._onZoom,moveend:this._update,zoomend:this._onZoomEnd};return this._zoomAnimated&&(t.zoomanim=this._onAnimZoom),t},_onAnimZoom:function(t){this._updateTransform(t.center,t.zoom)},_onZoom:function(){this._updateTransform(this._map.getCenter(),this._map.getZoom())},_updateTransform:function(t,e){var i=this._map.getZoomScale(e,this._zoom),n=it(this._container),o=this._map.getSize().multiplyBy(.5+this.options.padding),s=this._map.project(this._center,e),s=this._map.project(t,e).subtract(s),s=o.multiplyBy(-i).add(n).add(o).subtract(s);ze?tt(this._container,s,i):et(this._container,s)},_reset:function(){for(var t in this._update(),this._updateTransform(this._center,this._zoom),this._layers)this._layers[t]._reset()},_onZoomEnd:function(){for(var t in this._layers)this._layers[t]._project()},_updatePaths:function(){for(var t in this._layers)this._layers[t]._update()},_update:function(){var t=this.options.padding,e=this._map.getSize(),i=this._map.containerPointToLayerPoint(e.multiplyBy(-t)).round();this._bounds=new w(i,i.add(e.multiplyBy(1+2*t)).round()),this._center=this._map.getCenter(),this._zoom=this._map.getZoom()}}),Wi=Hi.extend({getEvents:function(){var t=Hi.prototype.getEvents.call(this);return t.viewprereset=this._onViewPreReset,t},_onViewPreReset:function(){this._postponeUpdatePaths=!0},onAdd:function(){Hi.prototype.onAdd.call(this),this._draw()},_initContainer:function(){var t=this._container=document.createElement("canvas");lt(t,"mousemove",e(this._onMouseMove,32,this),this),lt(t,"click dblclick mousedown mouseup contextmenu",this._onClick,this),lt(t,"mouseout",this._handleMouseOut,this),this._ctx=t.getContext("2d")},_destroyContainer:function(){f(this._redrawRequest),delete this._ctx,H(this._container),ct(this._container),delete this._container},_updatePaths:function(){if(!this._postponeUpdatePaths){for(var t in this._redrawBounds=null,this._layers)this._layers[t]._update();this._redraw()}},_update:function(){var t,e,i,n;this._map._animatingZoom&&this._bounds||(Hi.prototype._update.call(this),t=this._bounds,e=this._container,i=t.getSize(),n=De?2:1,et(e,t.min),e.width=n*i.x,e.height=n*i.y,e.style.width=i.x+"px",e.style.height=i.y+"px",De&&this._ctx.scale(2,2),this._ctx.translate(-t.min.x,-t.min.y),this.fire("update"))},_reset:function(){Hi.prototype._reset.call(this),this._postponeUpdatePaths&&(this._postponeUpdatePaths=!1,this._updatePaths())},_initPath:function(t){this._updateDashArray(t);t=(this._layers[r(t)]=t)._order={layer:t,prev:this._drawLast,next:null};this._drawLast&&(this._drawLast.next=t),this._drawLast=t,this._drawFirst=this._drawFirst||this._drawLast},_addPath:function(t){this._requestRedraw(t)},_removePath:function(t){var e=t._order,i=e.next,e=e.prev;i?i.prev=e:this._drawLast=e,e?e.next=i:this._drawFirst=i,delete t._order,delete this._layers[r(t)],this._requestRedraw(t)},_updatePath:function(t){this._extendRedrawBounds(t),t._project(),t._update(),this._requestRedraw(t)},_updateStyle:function(t){this._updateDashArray(t),this._requestRedraw(t)},_updateDashArray:function(t){if("string"==typeof t.options.dashArray){for(var e,i=t.options.dashArray.split(/[, ]+/),n=[],o=0;o<i.length;o++){if(e=Number(i[o]),isNaN(e))return;n.push(e)}t.options._dashArray=n}else t.options._dashArray=t.options.dashArray},_requestRedraw:function(t){this._map&&(this._extendRedrawBounds(t),this._redrawRequest=this._redrawRequest||x(this._redraw,this))},_extendRedrawBounds:function(t){var e;t._pxBounds&&(e=(t.options.weight||0)+1,this._redrawBounds=this._redrawBounds||new w,this._redrawBounds.extend(t._pxBounds.min.subtract([e,e])),this._redrawBounds.extend(t._pxBounds.max.add([e,e])))},_redraw:function(){this._redrawRequest=null,this._redrawBounds&&(this._redrawBounds.min._floor(),this._redrawBounds.max._ceil()),this._clear(),this._draw(),this._redrawBounds=null},_clear:function(){var t,e=this._redrawBounds;e?(t=e.getSize(),this._ctx.clearRect(e.min.x,e.min.y,t.x,t.y)):this._ctx.clearRect(0,0,this._container.width,this._container.height)},_draw:function(){var t,e,i=this._redrawBounds;this._ctx.save(),i&&(e=i.getSize(),this._ctx.beginPath(),this._ctx.rect(i.min.x,i.min.y,e.x,e.y),this._ctx.clip()),this._drawing=!0;for(var n=this._drawFirst;n;n=n.next)t=n.layer,(!i||t._pxBounds&&t._pxBounds.intersects(i))&&t._updatePath();this._drawing=!1,this._ctx.restore()},_updatePoly:function(t,e){if(this._drawing){var i,n,o,s,a=t._parts,r=a.length,h=this._ctx;if(r){for(h.beginPath(),i=0;i<r;i++){for(n=0,o=a[i].length;n<o;n++)s=a[i][n],h[n?"lineTo":"moveTo"](s.x,s.y);e&&h.closePath()}this._fillStroke(h,t)}}},_updateCircle:function(t){var e,i,n,o;this._drawing&&!t._empty()&&(e=t._point,i=this._ctx,n=Math.max(Math.round(t._radius),1),1!=(o=(Math.max(Math.round(t._radiusY),1)||n)/n)&&(i.save(),i.scale(1,o)),i.beginPath(),i.arc(e.x,e.y/o,n,0,2*Math.PI,!1),1!=o&&i.restore(),this._fillStroke(i,t))},_fillStroke:function(t,e){var i=e.options;i.fill&&(t.globalAlpha=i.fillOpacity,t.fillStyle=i.fillColor||i.color,t.fill(i.fillRule||"evenodd")),i.stroke&&0!==i.weight&&(t.setLineDash&&t.setLineDash(e.options&&e.options._dashArray||[]),t.globalAlpha=i.opacity,t.lineWidth=i.weight,t.strokeStyle=i.color,t.lineCap=i.lineCap,t.lineJoin=i.lineJoin,t.stroke())},_onClick:function(t){for(var e,i,n=this._map.mouseEventToLayerPoint(t),o=this._drawFirst;o;o=o.next)(e=o.layer).options.interactive&&e._containsPoint(n)&&!this._map._draggableMoved(e)&&(i=e);i&&(xt(t),this._fireEvent([i],t))},_onMouseMove:function(t){var e;!this._map||this._map.dragging.moving()||this._map._animatingZoom||(e=this._map.mouseEventToLayerPoint(t),this._handleMouseHover(t,e))},_handleMouseOut:function(t){var e=this._hoveredLayer;e&&($(this._container,"leaflet-interactive"),this._fireEvent([e],t,"mouseout"),this._hoveredLayer=null)},_handleMouseHover:function(t,e){for(var i,n,o=this._drawFirst;o;o=o.next)(i=o.layer).options.interactive&&i._containsPoint(e)&&(n=i);n!==this._hoveredLayer&&(this._handleMouseOut(t),n&&(Y(this._container,"leaflet-interactive"),this._fireEvent([n],t,"mouseover"),this._hoveredLayer=n)),this._hoveredLayer&&this._fireEvent([this._hoveredLayer],t)},_fireEvent:function(t,e,i){this._map._fireDOMEvent(e,i||e.type,t)},_bringToFront:function(t){var e,i,n=t._order;n&&(e=n.next,i=n.prev,e&&((e.prev=i)?i.next=e:e&&(this._drawFirst=e),n.prev=this._drawLast,(this._drawLast.next=n).next=null,this._drawLast=n,this._requestRedraw(t)))},_bringToBack:function(t){var e,i,n=t._order;n&&(e=n.next,(i=n.prev)&&((i.next=e)?e.prev=i:i&&(this._drawLast=i),n.prev=null,n.next=this._drawFirst,this._drawFirst.prev=n,this._drawFirst=n,this._requestRedraw(t)))}}),Gi=function(){try{return document.namespaces.add("lvml","urn:schemas-microsoft-com:vml"),function(t){return document.createElement("<lvml:"+t+' class="lvml">')}}catch(t){return function(t){return document.createElement("<"+t+' xmlns="urn:schemas-microsoft.com:vml" class="lvml">')}}}(),pe={_initContainer:function(){this._container=F("div","leaflet-vml-container")},_update:function(){this._map._animatingZoom||(Hi.prototype._update.call(this),this.fire("update"))},_initPath:function(t){var e=t._container=Gi("shape");Y(e,"leaflet-vml-shape "+(this.options.className||"")),e.coordsize="1 1",t._path=Gi("path"),e.appendChild(t._path),this._updateStyle(t),this._layers[r(t)]=t},_addPath:function(t){var e=t._container;this._container.appendChild(e),t.options.interactive&&t.addInteractiveTarget(e)},_removePath:function(t){var e=t._container;H(e),t.removeInteractiveTarget(e),delete this._layers[r(t)]},_updateStyle:function(t){var e=t._stroke,i=t._fill,n=t.options,o=t._container;o.stroked=!!n.stroke,o.filled=!!n.fill,n.stroke?(e=e||(t._stroke=Gi("stroke")),o.appendChild(e),e.weight=n.weight+"px",e.color=n.color,e.opacity=n.opacity,n.dashArray?e.dashStyle=Vt(n.dashArray)?n.dashArray.join(" "):n.dashArray.replace(/( *, *)/g," "):e.dashStyle="",e.endcap=n.lineCap.replace("butt","flat"),e.joinstyle=n.lineJoin):e&&(o.removeChild(e),t._stroke=null),n.fill?(i=i||(t._fill=Gi("fill")),o.appendChild(i),i.color=n.fillColor||n.color,i.opacity=n.fillOpacity):i&&(o.removeChild(i),t._fill=null)},_updateCircle:function(t){var e=t._point.round(),i=Math.round(t._radius),n=Math.round(t._radiusY||i);this._setPath(t,t._empty()?"M0 0":"AL "+e.x+","+e.y+" "+i+","+n+" 0,23592600")},_setPath:function(t,e){t._path.v=e},_bringToFront:function(t){G(t._container)},_bringToBack:function(t){q(t._container)}},qi=je?Gi:S,Vi=Hi.extend({getEvents:function(){var t=Hi.prototype.getEvents.call(this);return t.zoomstart=this._onZoomStart,t},_initContainer:function(){this._container=qi("svg"),this._container.setAttribute("pointer-events","none"),this._rootGroup=qi("g"),this._container.appendChild(this._rootGroup)},_destroyContainer:function(){H(this._container),ct(this._container),delete this._container,delete this._rootGroup,delete this._svgSize},_onZoomStart:function(){this._update()},_update:function(){var t,e,i;this._map._animatingZoom&&this._bounds||(Hi.prototype._update.call(this),e=(t=this._bounds).getSize(),i=this._container,this._svgSize&&this._svgSize.equals(e)||(this._svgSize=e,i.setAttribute("width",e.x),i.setAttribute("height",e.y)),et(i,t.min),i.setAttribute("viewBox",[t.min.x,t.min.y,e.x,e.y].join(" ")),this.fire("update"))},_initPath:function(t){var e=t._path=qi("path");t.options.className&&Y(e,t.options.className),t.options.interactive&&Y(e,"leaflet-interactive"),this._updateStyle(t),this._layers[r(t)]=t},_addPath:function(t){this._rootGroup||this._initContainer(),this._rootGroup.appendChild(t._path),t.addInteractiveTarget(t._path)},_removePath:function(t){H(t._path),t.removeInteractiveTarget(t._path),delete this._layers[r(t)]},_updatePath:function(t){t._project(),t._update()},_updateStyle:function(t){var e=t._path,t=t.options;e&&(t.stroke?(e.setAttribute("stroke",t.color),e.setAttribute("stroke-opacity",t.opacity),e.setAttribute("stroke-width",t.weight),e.setAttribute("stroke-linecap",t.lineCap),e.setAttribute("stroke-linejoin",t.lineJoin),t.dashArray?e.setAttribute("stroke-dasharray",t.dashArray):e.removeAttribute("stroke-dasharray"),t.dashOffset?e.setAttribute("stroke-dashoffset",t.dashOffset):e.removeAttribute("stroke-dashoffset")):e.setAttribute("stroke","none"),t.fill?(e.setAttribute("fill",t.fillColor||t.color),e.setAttribute("fill-opacity",t.fillOpacity),e.setAttribute("fill-rule",t.fillRule||"evenodd")):e.setAttribute("fill","none"))},_updatePoly:function(t,e){this._setPath(t,z(t._parts,e))},_updateCircle:function(t){var e=t._point,i=Math.max(Math.round(t._radius),1),n="a"+i+","+(Math.max(Math.round(t._radiusY),1)||i)+" 0 1,0 ",i=t._empty()?"M0 0":"M"+(e.x-i)+","+e.y+n+2*i+",0 "+n+2*-i+",0 ";this._setPath(t,i)},_setPath:function(t,e){t._path.setAttribute("d",e)},_bringToFront:function(t){G(t._path)},_bringToBack:function(t){q(t._path)}});je&&Vi.include(pe),li.include({getRenderer:function(t){t=(t=t.options.renderer||this._getPaneRenderer(t.options.pane)||this.options.renderer||this._renderer)||(this._renderer=this._createRenderer());return this.hasLayer(t)||this.addLayer(t),t},_getPaneRenderer:function(t){if("overlayPane"===t||void 0===t)return!1;var e=this._paneRenderers[t];return void 0===e&&(e=this._createRenderer({pane:t}),this._paneRenderers[t]=e),e},_createRenderer:function(t){return this.options.preferCanvas&&jt(t)||Ft(t)}});var Yi=Bi.extend({initialize:function(t,e){Bi.prototype.initialize.call(this,this._boundsToLatLngs(t),e)},setBounds:function(t){return this.setLatLngs(this._boundsToLatLngs(t))},_boundsToLatLngs:function(t){return[(t=P(t)).getSouthWest(),t.getNorthWest(),t.getNorthEast(),t.getSouthEast()]}});Vi.create=qi,Vi.pointsToPath=z,Ii.geometryToLayer=Bt,Ii.coordsToLatLng=It,Ii.coordsToLatLngs=Nt,Ii.latLngToCoords=At,Ii.latLngsToCoords=Zt,Ii.getFeature=Ot,Ii.asFeature=Dt,li.mergeOptions({boxZoom:!0});te=Ee.extend({initialize:function(t){this._map=t,this._container=t._container,this._pane=t._panes.overlayPane,this._resetStateTimeout=0,t.on("unload",this._destroy,this)},addHooks:function(){lt(this._container,"mousedown",this._onMouseDown,this)},removeHooks:function(){ct(this._container,"mousedown",this._onMouseDown,this)},moved:function(){return this._moved},_destroy:function(){H(this._pane),delete this._pane},_resetState:function(){this._resetStateTimeout=0,this._moved=!1},_clearDeferredResetState:function(){0!==this._resetStateTimeout&&(clearTimeout(this._resetStateTimeout),this._resetStateTimeout=0)},_onMouseDown:function(t){if(!t.shiftKey||1!==t.which&&1!==t.button)return!1;this._clearDeferredResetState(),this._resetState(),he(),nt(),this._startPoint=this._map.mouseEventToContainerPoint(t),lt(document,{contextmenu:gt,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseMove:function(t){this._moved||(this._moved=!0,this._box=F("div","leaflet-zoom-box",this._container),Y(this._container,"leaflet-crosshair"),this._map.fire("boxzoomstart")),this._point=this._map.mouseEventToContainerPoint(t);var e=new w(this._point,this._startPoint),t=e.getSize();et(this._box,e.min),this._box.style.width=t.x+"px",this._box.style.height=t.y+"px"},_finish:function(){this._moved&&(H(this._box),$(this._container,"leaflet-crosshair")),le(),ot(),ct(document,{contextmenu:gt,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseUp:function(t){1!==t.which&&1!==t.button||(this._finish(),!this._moved)||(this._clearDeferredResetState(),this._resetStateTimeout=setTimeout(p(this._resetState,this),0),t=new T(this._map.containerPointToLatLng(this._startPoint),this._map.containerPointToLatLng(this._point)),this._map.fitBounds(t).fire("boxzoomend",{boxZoomBounds:t}))},_onKeyDown:function(t){27===t.keyCode&&this._finish()}});li.addInitHook("addHandler","boxZoom",te),li.mergeOptions({doubleClickZoom:!0});ce=Ee.extend({addHooks:function(){this._map.on("dblclick",this._onDoubleClick,this)},removeHooks:function(){this._map.off("dblclick",this._onDoubleClick,this)},_onDoubleClick:function(t){var e=this._map,i=e.getZoom(),n=e.options.zoomDelta,n=t.originalEvent.shiftKey?i-n:i+n;"center"===e.options.doubleClickZoom?e.setZoom(n):e.setZoomAround(t.containerPoint,n)}});li.addInitHook("addHandler","doubleClickZoom",ce),li.mergeOptions({dragging:!0,inertia:!ye,inertiaDeceleration:3400,inertiaMaxSpeed:1/0,easeLinearity:.2,worldCopyJump:!1,maxBoundsViscosity:0});ue=Ee.extend({addHooks:function(){var t;this._draggable||(t=this._map,this._draggable=new vi(t._mapPane,t._container),this._draggable.on({dragstart:this._onDragStart,drag:this._onDrag,dragend:this._onDragEnd},this),this._draggable.on("predrag",this._onPreDragLimit,this),t.options.worldCopyJump&&(this._draggable.on("predrag",this._onPreDragWrap,this),t.on("zoomend",this._onZoomEnd,this),t.whenReady(this._onZoomEnd,this))),Y(this._map._container,"leaflet-grab leaflet-touch-drag"),this._draggable.enable(),this._positions=[],this._times=[]},removeHooks:function(){$(this._map._container,"leaflet-grab"),$(this._map._container,"leaflet-touch-drag"),this._draggable.disable()},moved:function(){return this._draggable&&this._draggable._moved},moving:function(){return this._draggable&&this._draggable._moving},_onDragStart:function(){var t,e=this._map;e._stop(),this._map.options.maxBounds&&this._map.options.maxBoundsViscosity?(t=P(this._map.options.maxBounds),this._offsetLimit=b(this._map.latLngToContainerPoint(t.getNorthWest()).multiplyBy(-1),this._map.latLngToContainerPoint(t.getSouthEast()).multiplyBy(-1).add(this._map.getSize())),this._viscosity=Math.min(1,Math.max(0,this._map.options.maxBoundsViscosity))):this._offsetLimit=null,e.fire("movestart").fire("dragstart"),e.options.inertia&&(this._positions=[],this._times=[])},_onDrag:function(t){var e,i;this._map.options.inertia&&(e=this._lastTime=+new Date,i=this._lastPos=this._draggable._absPos||this._draggable._newPos,this._positions.push(i),this._times.push(e),this._prunePositions(e)),this._map.fire("move",t).fire("drag",t)},_prunePositions:function(t){for(;1<this._positions.length&&50<t-this._times[0];)this._positions.shift(),this._times.shift()},_onZoomEnd:function(){var t=this._map.getSize().divideBy(2),e=this._map.latLngToLayerPoint([0,0]);this._initialWorldOffset=e.subtract(t).x,this._worldWidth=this._map.getPixelWorldBounds().getSize().x},_viscousLimit:function(t,e){return t-(t-e)*this._viscosity},_onPreDragLimit:function(){var t,e;this._viscosity&&this._offsetLimit&&(t=this._draggable._newPos.subtract(this._draggable._startPos),e=this._offsetLimit,t.x<e.min.x&&(t.x=this._viscousLimit(t.x,e.min.x)),t.y<e.min.y&&(t.y=this._viscousLimit(t.y,e.min.y)),t.x>e.max.x&&(t.x=this._viscousLimit(t.x,e.max.x)),t.y>e.max.y&&(t.y=this._viscousLimit(t.y,e.max.y)),this._draggable._newPos=this._draggable._startPos.add(t))},_onPreDragWrap:function(){var t=this._worldWidth,e=Math.round(t/2),i=this._initialWorldOffset,n=this._draggable._newPos.x,o=(n-e+i)%t+e-i,e=(n+e+i)%t-e-i,e=Math.abs(o+i)<Math.abs(e+i)?o:e;this._draggable._absPos=this._draggable._newPos.clone(),this._draggable._newPos.x=e},_onDragEnd:function(t){var e,i,n,o,s=this._map,a=s.options,r=!a.inertia||this._times.length<2;s.fire("dragend",t),r?s.fire("moveend"):(this._prunePositions(+new Date),i=this._lastPos.subtract(this._positions[0]),t=(this._lastTime-this._times[0])/1e3,e=a.easeLinearity,i=(r=i.multiplyBy(e/t)).distanceTo([0,0]),t=Math.min(a.inertiaMaxSpeed,i),i=r.multiplyBy(t/i),n=t/(a.inertiaDeceleration*e),(o=i.multiplyBy(-n/2).round()).x||o.y?(o=s._limitOffset(o,s.options.maxBounds),x(function(){s.panBy(o,{duration:n,easeLinearity:e,noMoveStart:!0,animate:!0})})):s.fire("moveend"))}});li.addInitHook("addHandler","dragging",ue),li.mergeOptions({keyboard:!0,keyboardPanDelta:80});se=Ee.extend({keyCodes:{left:[37],right:[39],down:[40],up:[38],zoomIn:[187,107,61,171],zoomOut:[189,109,54,173]},initialize:function(t){this._map=t,this._setPanDelta(t.options.keyboardPanDelta),this._setZoomDelta(t.options.zoomDelta)},addHooks:function(){var t=this._map._container;t.tabIndex<=0&&(t.tabIndex="0"),lt(t,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.on({focus:this._addHooks,blur:this._removeHooks},this)},removeHooks:function(){this._removeHooks(),ct(this._map._container,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.off({focus:this._addHooks,blur:this._removeHooks},this)},_onMouseDown:function(){var t,e,i;this._focused||(t=document.body,i=document.documentElement,e=t.scrollTop||i.scrollTop,i=t.scrollLeft||i.scrollLeft,this._map._container.focus(),window.scrollTo(i,e))},_onFocus:function(){this._focused=!0,this._map.fire("focus")},_onBlur:function(){this._focused=!1,this._map.fire("blur")},_setPanDelta:function(t){for(var e=this._panKeys={},i=this.keyCodes,n=0,o=i.left.length;n<o;n++)e[i.left[n]]=[-1*t,0];for(n=0,o=i.right.length;n<o;n++)e[i.right[n]]=[t,0];for(n=0,o=i.down.length;n<o;n++)e[i.down[n]]=[0,t];for(n=0,o=i.up.length;n<o;n++)e[i.up[n]]=[0,-1*t]},_setZoomDelta:function(t){for(var e=this._zoomKeys={},i=this.keyCodes,n=0,o=i.zoomIn.length;n<o;n++)e[i.zoomIn[n]]=t;for(n=0,o=i.zoomOut.length;n<o;n++)e[i.zoomOut[n]]=-t},_addHooks:function(){lt(document,"keydown",this._onKeyDown,this)},_removeHooks:function(){ct(document,"keydown",this._onKeyDown,this)},_onKeyDown:function(t){if(!(t.altKey||t.ctrlKey||t.metaKey)){var e,i=t.keyCode,n=this._map;if(i in this._panKeys)n._panAnim&&n._panAnim._inProgress||(e=this._panKeys[i],t.shiftKey&&(e=v(e).multiplyBy(3)),n.panBy(e),n.options.maxBounds&&n.panInsideBounds(n.options.maxBounds));else if(i in this._zoomKeys)n.setZoom(n.getZoom()+(t.shiftKey?3:1)*this._zoomKeys[i]);else{if(27!==i||!n._popup||!n._popup.options.closeOnEscapeKey)return;n.closePopup()}gt(t)}}});li.addInitHook("addHandler","keyboard",se),li.mergeOptions({scrollWheelZoom:!0,wheelDebounceTime:40,wheelPxPerZoomLevel:60});ve=Ee.extend({addHooks:function(){lt(this._map._container,"mousewheel",this._onWheelScroll,this),this._delta=0},removeHooks:function(){ct(this._map._container,"mousewheel",this._onWheelScroll,this)},_onWheelScroll:function(t){var e=vt(t),i=this._map.options.wheelDebounceTime;this._delta+=e,this._lastMousePos=this._map.mouseEventToContainerPoint(t),this._startTime||(this._startTime=+new Date);i=Math.max(i-(+new Date-this._startTime),0);clearTimeout(this._timer),this._timer=setTimeout(p(this._performZoom,this),i),gt(t)},_performZoom:function(){var t=this._map,e=t.getZoom(),i=this._map.options.zoomSnap||0;t._stop();var n=this._delta/(4*this._map.options.wheelPxPerZoomLevel),n=4*Math.log(2/(1+Math.exp(-Math.abs(n))))/Math.LN2,n=i?Math.ceil(n/i)*i:n,n=t._limitZoom(e+(0<this._delta?n:-n))-e;this._delta=0,this._startTime=null,n&&("center"===t.options.scrollWheelZoom?t.setZoom(e+n):t.setZoomAround(this._lastMousePos,e+n))}});li.addInitHook("addHandler","scrollWheelZoom",ve),li.mergeOptions({tap:!0,tapTolerance:15});Be=Ee.extend({addHooks:function(){lt(this._map._container,"touchstart",this._onDown,this)},removeHooks:function(){ct(this._map._container,"touchstart",this._onDown,this)},_onDown:function(t){if(t.touches){if(ft(t),this._fireClick=!0,1<t.touches.length)return this._fireClick=!1,void clearTimeout(this._holdTimeout);var e=t.touches[0],t=e.target;this._startPos=this._newPos=new y(e.clientX,e.clientY),t.tagName&&"a"===t.tagName.toLowerCase()&&Y(t,"leaflet-active"),this._holdTimeout=setTimeout(p(function(){this._isTapValid()&&(this._fireClick=!1,this._onUp(),this._simulateEvent("contextmenu",e))},this),1e3),this._simulateEvent("mousedown",e),lt(document,{touchmove:this._onMove,touchend:this._onUp},this)}},_onUp:function(t){var e;clearTimeout(this._holdTimeout),ct(document,{touchmove:this._onMove,touchend:this._onUp},this),this._fireClick&&t&&t.changedTouches&&((t=(e=t.changedTouches[0]).target)&&t.tagName&&"a"===t.tagName.toLowerCase()&&$(t,"leaflet-active"),this._simulateEvent("mouseup",e),this._isTapValid()&&this._simulateEvent("click",e))},_isTapValid:function(){return this._newPos.distanceTo(this._startPos)<=this._map.options.tapTolerance},_onMove:function(t){t=t.touches[0];this._newPos=new y(t.clientX,t.clientY),this._simulateEvent("mousemove",t)},_simulateEvent:function(t,e){var i=document.createEvent("MouseEvents");i._simulated=!0,e.target._simulatedClick=!0,i.initMouseEvent(t,!0,!0,window,1,e.screenX,e.screenY,e.clientX,e.clientY,!1,!1,!1,!1,0,null),e.target.dispatchEvent(i)}});Ze&&!Ae&&li.addInitHook("addHandler","tap",Be),li.mergeOptions({touchZoom:Ze&&!ye,bounceAtZoomLimits:!0});pe=Ee.extend({addHooks:function(){Y(this._map._container,"leaflet-touch-zoom"),lt(this._map._container,"touchstart",this._onTouchStart,this)},removeHooks:function(){$(this._map._container,"leaflet-touch-zoom"),ct(this._map._container,"touchstart",this._onTouchStart,this)},_onTouchStart:function(t){var e,i,n=this._map;!t.touches||2!==t.touches.length||n._animatingZoom||this._zooming||(e=n.mouseEventToContainerPoint(t.touches[0]),i=n.mouseEventToContainerPoint(t.touches[1]),this._centerPoint=n.getSize()._divideBy(2),this._startLatLng=n.containerPointToLatLng(this._centerPoint),"center"!==n.options.touchZoom&&(this._pinchStartLatLng=n.containerPointToLatLng(e.add(i)._divideBy(2))),this._startDist=e.distanceTo(i),this._startZoom=n.getZoom(),this._moved=!1,this._zooming=!0,n._stop(),lt(document,"touchmove",this._onTouchMove,this),lt(document,"touchend",this._onTouchEnd,this),ft(t))},_onTouchMove:function(t){if(t.touches&&2===t.touches.length&&this._zooming){var e=this._map,i=e.mouseEventToContainerPoint(t.touches[0]),n=e.mouseEventToContainerPoint(t.touches[1]),o=i.distanceTo(n)/this._startDist;if(this._zoom=e.getScaleZoom(o,this._startZoom),!e.options.bounceAtZoomLimits&&(this._zoom<e.getMinZoom()&&o<1||this._zoom>e.getMaxZoom()&&1<o)&&(this._zoom=e._limitZoom(this._zoom)),"center"===e.options.touchZoom){if(this._center=this._startLatLng,1==o)return}else{n=i._add(n)._divideBy(2)._subtract(this._centerPoint);if(1==o&&0===n.x&&0===n.y)return;this._center=e.unproject(e.project(this._pinchStartLatLng,this._zoom).subtract(n),this._zoom)}this._moved||(e._moveStart(!0,!1),this._moved=!0),f(this._animRequest);e=p(e._move,e,this._center,this._zoom,{pinch:!0,round:!1});this._animRequest=x(e,this,!0),ft(t)}},_onTouchEnd:function(){this._moved&&this._zooming?(this._zooming=!1,f(this._animRequest),ct(document,"touchmove",this._onTouchMove),ct(document,"touchend",this._onTouchEnd),this._map.options.zoomAnimation?this._map._animateZoom(this._center,this._map._limitZoom(this._zoom),!0,this._map.options.zoomSnap):this._map._resetView(this._center,this._map._limitZoom(this._zoom))):this._zooming=!1}});li.addInitHook("addHandler","touchZoom",pe),li.BoxZoom=te,li.DoubleClickZoom=ce,li.Drag=ue,li.Keyboard=se,li.ScrollWheelZoom=ve,li.Tap=Be,li.TouchZoom=pe,Object.freeze=Ht,t.version="1.4.0+HEAD.3337f36",t.Control=ci,t.control=ke,t.Browser=fe,t.Evented=ee,t.Mixin=Se,t.Util=Jt,t.Class=g,t.Handler=Ee,t.extend=h,t.bind=p,t.stamp=r,t.setOptions=s,t.DomEvent=Pe,t.DomUtil=we,t.PosAnimation=hi,t.Draggable=vi,t.LineUtil=Ie,t.PolyUtil=Ne,t.Point=y,t.point=v,t.Bounds=w,t.bounds=b,t.Transformation=C,t.transformation=E,t.Projection=Me,t.LatLng=k,t.latLng=M,t.LatLngBounds=T,t.latLngBounds=P,t.CRS=ne,t.GeoJSON=Ii,t.geoJSON=Rt,t.geoJson=Le,t.Layer=wi,t.LayerGroup=bi,t.layerGroup=function(t,e){return new bi(t,e)},t.FeatureGroup=Li,t.featureGroup=function(t){return new Li(t)},t.ImageOverlay=Ni,t.imageOverlay=function(t,e,i){return new Ni(t,e,i)},t.VideoOverlay=Ai,t.videoOverlay=function(t,e,i){return new Ai(t,e,i)},t.DivOverlay=Zi,t.Popup=Oi,t.popup=function(t,e){return new Oi(t,e)},t.Tooltip=Di,t.tooltip=function(t,e){return new Di(t,e)},t.Icon=Ti,t.icon=function(t){return new Ti(t)},t.DivIcon=Ri,t.divIcon=function(t){return new Ri(t)},t.Marker=Mi,t.marker=function(t,e){return new Mi(t,e)},t.TileLayer=ji,t.tileLayer=Ut,t.GridLayer=Ui,t.gridLayer=function(t){return new Ui(t)},t.SVG=Vi,t.svg=Ft,t.Renderer=Hi,t.Canvas=Wi,t.canvas=jt,t.Path=Ci,t.CircleMarker=Ei,t.circleMarker=function(t,e){return new Ei(t,e)},t.Circle=Si,t.circle=function(t,e,i){return new Si(t,e,i)},t.Polyline=zi,t.polyline=function(t,e){return new zi(t,e)},t.Polygon=Bi,t.polygon=function(t,e){return new Bi(t,e)},t.Rectangle=Yi,t.rectangle=function(t,e){return new Yi(t,e)},t.Map=li,t.map=function(t,e){return new li(t,e)};var $i=window.L;t.noConflict=function(){return window.L=$i,this},window.L=t}),function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(require("leaflet")):"function"==typeof define&&define.amd?define(["leaflet"],e):e(t.L)}(this,function(h){"use strict";h=h&&h.hasOwnProperty("default")?h.default:h;function p(t,e){var i=t.value;return t.isInPixels?i/e:i}var a=function(t,e){return(180*Math.atan2(e.y-t.y,e.x-t.x)/Math.PI+90+360)%360};function i(t){if("string"==typeof t&&-1!==t.indexOf("%"))return{value:parseFloat(t)/100,isInPixels:!1};t=t?parseFloat(t):0;return{value:t,isInPixels:0<t}}var t,e,n,r=function(t,e){return t.x===e.x&&t.y===e.y};function d(t){return t.reduce(function(t,e,i,n){var o,s;return 0<i&&!r(e,n[i-1])&&(o=n[i-1],s=0<t.length?t[t.length-1].distB:0,n=o,i=e.x-n.x,n=e.y-n.y,n=Math.sqrt(i*i+n*n),t.push({a:o,b:e,distA:s,distB:s+n,heading:a(o,e)})),t},[])}function o(t,e){var o=d(t),s=o.length;if(0===s)return[];for(var i=o[s-1].distB,n=p(e.offset,i),t=p(e.endOffset,i),a=i*p(e.repeat,i),r=0<t?i*t:0,h=[],l=0<n?i*n:0;h.push(l),l+=a,0<a&&l<i-r;);var c=0,u=o[0];return h.map(function(t){for(;t>u.distB&&c<s-1;)u=o[++c];var e,i,n=(t-u.distA)/(u.distB-u.distA);return{pt:(e=u.a,i=u.b,n=n,i.x===e.x?{x:e.x,y:e.y+(i.y-e.y)*n}:{x:e.x+n*(i.x-e.x),y:e.y+n*(i.y-e.y)}),heading:u.heading}})}t=L.Marker.prototype._initIcon,e=L.Marker.prototype._setPos,n="msTransform"===L.DomUtil.TRANSFORM,L.Marker.addInitHook(function(){var t=(t=this.options.icon&&this.options.icon.options&&this.options.icon.options.iconAnchor)&&t[0]+"px "+t[1]+"px";this.options.rotationOrigin=this.options.rotationOrigin||t||"center bottom",this.options.rotationAngle=this.options.rotationAngle||0,this.on("drag",function(t){t.target._applyRotation()})}),L.Marker.include({_initIcon:function(){t.call(this)},_setPos:function(t){e.call(this,t),this._applyRotation()},_applyRotation:function(){this.options.rotationAngle&&(this._icon.style[L.DomUtil.TRANSFORM+"Origin"]=this.options.rotationOrigin,n?this._icon.style[L.DomUtil.TRANSFORM]="rotate("+this.options.rotationAngle+"deg)":this._icon.style[L.DomUtil.TRANSFORM]+=" rotateZ("+this.options.rotationAngle+"deg)")},setRotationAngle:function(t){return this.options.rotationAngle=t,this.update(),this},setRotationOrigin:function(t){return this.options.rotationOrigin=t,this.update(),this}}),h.Symbol=h.Symbol||{},h.Symbol.Dash=h.Class.extend({options:{pixelSize:10,pathOptions:{}},initialize:function(t){h.Util.setOptions(this,t),this.options.pathOptions.clickable=!1},buildSymbol:function(t,e,i,n,o){var s=this.options,a=Math.PI/180;if(s.pixelSize<=1)return h.polyline([t.latLng,t.latLng],s.pathOptions);var r=i.project(t.latLng),a=-(t.heading-90)*a,a=h.point(r.x+s.pixelSize*Math.cos(a+Math.PI)/2,r.y+s.pixelSize*Math.sin(a)/2),r=r.add(r.subtract(a));return h.polyline([i.unproject(a),i.unproject(r)],s.pathOptions)}}),h.Symbol.dash=function(t){return new h.Symbol.Dash(t)},h.Symbol.ArrowHead=h.Class.extend({options:{polygon:!0,pixelSize:10,headAngle:60,pathOptions:{stroke:!1,weight:2}},initialize:function(t){h.Util.setOptions(this,t),this.options.pathOptions.clickable=!1},buildSymbol:function(t,e,i,n,o){return this.options.polygon?h.polygon(this._buildArrowPath(t,i),this.options.pathOptions):h.polyline(this._buildArrowPath(t,i),this.options.pathOptions)},_buildArrowPath:function(t,e){var i=Math.PI/180,n=e.project(t.latLng),o=-(t.heading-90)*i,s=this.options.headAngle/2*i,i=o+s,s=o-s,i=h.point(n.x-this.options.pixelSize*Math.cos(i),n.y+this.options.pixelSize*Math.sin(i)),s=h.point(n.x-this.options.pixelSize*Math.cos(s),n.y+this.options.pixelSize*Math.sin(s));return[e.unproject(i),t.latLng,e.unproject(s)]}}),h.Symbol.arrowHead=function(t){return new h.Symbol.ArrowHead(t)},h.Symbol.Marker=h.Class.extend({options:{markerOptions:{},rotate:!1},initialize:function(t){h.Util.setOptions(this,t),this.options.markerOptions.clickable=!1,this.options.markerOptions.draggable=!1},buildSymbol:function(t,e,i,n,o){return this.options.rotate&&(this.options.markerOptions.rotationAngle=t.heading+(this.options.angleCorrection||0)),h.marker(t.latLng,this.options.markerOptions)}}),h.Symbol.marker=function(t){return new h.Symbol.Marker(t)};function s(t){return Array.isArray(t)&&((t=t[0])instanceof h.LatLng||Array.isArray(t)&&2===t.length&&"number"==typeof t[0])}h.PolylineDecorator=h.FeatureGroup.extend({options:{patterns:[]},initialize:function(t,e){h.FeatureGroup.prototype.initialize.call(this),h.Util.setOptions(this,e),this._map=null,this._paths=this._initPaths(t),this._bounds=this._initBounds(),this._patterns=this._initPatterns(this.options.patterns)},_initPaths:function(t,i){var n=this;return s(t)?[i?t.concat([t[0]]):t]:t instanceof h.Polyline?this._initPaths(t.getLatLngs(),t instanceof h.Polygon):Array.isArray(t)?t.reduce(function(t,e){return t.concat(n._initPaths(e,i))},[]):[]},_initPatterns:function(t){return t.map(this._parsePatternDef)},setPatterns:function(t){this.options.patterns=t,this._patterns=this._initPatterns(this.options.patterns),this.redraw()},setPaths:function(t){this._paths=this._initPaths(t),this._bounds=this._initBounds(),this.redraw()},_parsePatternDef:function(t,e){return{symbolFactory:t.symbol,offset:i(t.offset),endOffset:i(t.endOffset),repeat:i(t.repeat)}},onAdd:function(t){this._map=t,this._draw(),this._map.on("moveend",this.redraw,this)},onRemove:function(t){this._map.off("moveend",this.redraw,this),this._map=null,h.FeatureGroup.prototype.onRemove.call(this,t)},_initBounds:function(){var t=this._paths.reduce(function(t,e){return t.concat(e)},[]);return h.latLngBounds(t)},getBounds:function(){return this._bounds},_buildSymbols:function(i,n,o){var s=this;return o.map(function(t,e){return n.buildSymbol(t,i,s._map,e,o.length)})},_getDirectionPoints:function(t,e){var i=this;return t.length<2?[]:o(t.map(function(t){return i._map.project(t)}),e).map(function(t){return{latLng:i._map.unproject(h.point(t.pt)),heading:t.heading}})},redraw:function(){this._map&&(this.clearLayers(),this._draw())},_getPatternLayers:function(i){var n=this,o=this._map.getBounds().pad(.1);return this._paths.map(function(t){var e=n._getDirectionPoints(t,i).filter(function(t){return o.contains(t.latLng)});return h.featureGroup(n._buildSymbols(t,i.symbolFactory,e))})},_draw:function(){var e=this;this._patterns.map(function(t){return e._getPatternLayers(t)}).forEach(function(t){e.addLayer(h.featureGroup(t))})}}),h.polylineDecorator=function(t,e){return new h.PolylineDecorator(t,e)}});var map,url,gpx,map_boat_position,load_articles,site_id,navigation_initialized,active_trackings,sblang,L=L||require("leaflet"),_MAX_POINT_INTERVAL_MS=15e3,_SECOND_IN_MILLIS=1e3,_MINUTE_IN_MILLIS=60*_SECOND_IN_MILLIS,_HOUR_IN_MILLIS=60*_MINUTE_IN_MILLIS,_DAY_IN_MILLIS=24*_HOUR_IN_MILLIS,_GPX_STYLE_NS="http://www.topografix.com/GPX/gpx_style/0/2",avg_speed_imp=0,_DEFAULT_MARKER_OPTS={startIconUrl:"pin-icon-start.png",endIconUrl:"pin-icon-end.png",shadowUrl:"",wptIcons:[],wptIconsType:[],wptIconUrls:{"":"pin-icon-wpt.png"},wptIconTypeUrls:{"":"pin-icon-wpt.png"},pointMatchers:[],iconSize:[33,45],shadowSize:[50,50],iconAnchor:[16,45],shadowAnchor:[16,47],clickable:!1},_DEFAULT_POLYLINE_OPTS={color:"black",draggable:!1},_DEFAULT_GPX_OPTS={parseElements:["track","route","waypoint"],joinTrackSegments:!1};function toDegreesMinutesAndSeconds(t){var e=Math.abs(t),i=Math.floor(e),t=60*(e-i),e=Math.floor(t);return i+" "+e+"' "+Math.floor(60*(t-e))+'"'}function isDark(t){const e=t.replace("#","");return(299*parseInt(e.substring(0,2),16)+587*parseInt(e.substring(2,4),16)+114*parseInt(e.substring(4,6),16))/1e3<155}function formatDate(t){var e=navigator.language||navigator.userLanguage;return new Date(t).toLocaleDateString(e,{day:"numeric",month:"long",year:"numeric"})}function waypointPopupContent(t){var e='<div class="tooltip-top">';return e+='<span class="source"><i class="fa fa-location-arrow"></i>&nbsp;'+sblang.position_report,void 0!==t.source&&null!==t.source&&""!==t.source&&(e+="via "+t.source+"<br>"),void 0!==t.country_code&&2===t.country_code.length&&(e+='<span class="country"><img src="https://www.skipperblogs.com/assets/img/country-flags/24x24/'+t.country_code+'.png" title="'+(void 0!==t.country_name?t.country_name:"")+'"></span>'),e+='</div><div class="tooltip-body">',"undefined"!=typeof time&&null!==time&&(e+=time.ddmmyyyyhhmm()+"<br>"),void 0!==t.course&&0<t.course.length&&(e+=sblang.course+" "+t.course+"<br>"),void 0!==t.speed&&0<t.speed.length&&(e+=sblang.speed+" "+t.speed+"kts<br>"),void 0===t.weathercode&&void 0===t.temperature&&void 0===t.windspeed&&void 0===t.winddirection||(e+='<span class="weather">'),void 0!==t.weathercode&&(void 0!==t.period&&"night"===t.period?e+='<img width="90" height="70" src="https://www.skipperblogs.com/assets/img/weather-icons/codes/'+t.weathercode+'_night.svg">':e+='<img width="90" height="70" src="https://www.skipperblogs.com/assets/img/weather-icons/codes/'+t.weathercode+'.svg">'),void 0!==t.pressure&&(e+='<i><img width="30" src="https://www.skipperblogs.com/assets/img/weather-icons/fill/final/barometer.svg"> '+t.pressure+" hPa</i>"),void 0!==t.temperature&&(e+='<i><img width="30" src="https://www.skipperblogs.com/assets/img/weather-icons/fill/final/thermometer-celsius.svg"> '+t.temperature+"C</i>"),void 0!==t.windspeed&&(e+='<i><img width="30" src="https://www.skipperblogs.com/assets/img/weather-icons/fill/final/windsock.svg"> '+t.windspeed+" "+sblang.speed_unit+" "+t.winddirection+"</i>"),void 0===t.weathercode&&void 0===t.temperature&&void 0===t.windspeed&&void 0===t.winddirection||(e+="</span>"),void 0!==t.text&&(e+="<p>"+t.text+"</p>"),e+="</div>"}function deg_to_dms(t,e){return"lat"!==e?toDegreesMinutesAndSeconds(t)+" "+(0<=t?"E":"W"):toDegreesMinutesAndSeconds(t)+" "+(0<=t?"N":"S")}function displayMapWarning(t,e){t='<div class="tracking-warning">'+sblang.tracking_offline_warning.replace("%name%",t)+'<i id="tracking-warning-close" class="fa fa-times"></i></div>';$(document).find("#map-wrapper").append(t),document.getElementById("tracking-warning-close").onclick=function(){this.parentNode.style.display="none"}}async function checkTrackingHealth(){if(!(void 0===active_trackings&&active_trackings.length<1||"undefined"==typeof tracking_check_url)){let s=new XMLHttpRequest;s.open("GET",tracking_check_url),s.onload=function(){if(200<=this.status&&this.status<300){var t=JSON.parse(s.response);if(!(void 0===t.data||t.data.length<1))for(var[e,i]of Object.entries(active_trackings))for(var[n,o]of Object.entries(t.data))o.id==e&&1!==o.status&&displayMapWarning(i,o)}},s.onerror=function(){},s.send()}}function mapLoader(t){var e=$("<div>").addClass("map-loader").html('<svg version="1.1" id="map-spinner" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 100 100" enable-background="new 0 0 0 0" xml:space="preserve"> <path fill="#fff" d="M73,50c0-12.7-10.3-23-23-23S27,37.3,27,50 M30.9,50c0-10.5,8.5-19.1,19.1-19.1S69.1,39.5,69.1,50"></path></svg>');(window.items_loading||window.track_loading)&&0===$(document).find(".map-loader").length&&e.insertBefore($("#map,#windy")),(t<0||window.items_loading&&window.items_loaded&&window.track_loading&&window.track_loaded||window.items_loading&&window.items_loaded&&!window.track_loading&&!window.track_loaded||!window.items_loading&&!window.items_loaded&&window.track_loading&&window.track_loaded)&&$(".map-loader").remove(),setTimeout(function(){mapLoader(t-50)},50)}function initMainMap(t){var e=parseInt(t.attr("data-zoom")),i=parseInt(t.attr("data-provider-max-zoom")),n=t.attr("data-center-on"),o=t.attr("data-lat"),s=t.attr("data-lng");return map=L.map("map",{worldCopyJump:!1,scrollWheelZoom:"undefined"!=typeof map_scroll_zoom_enabled,center:void 0!==o&&void 0!==s?[o,s]:[17,-61],zoom:0<e&&e<24?e:7,dragging:!(L.Browser.mobile&&"undefined"==typeof map_mobile_scroll),tap:!(L.Browser.mobile&&"undefined"==typeof map_mobile_scroll),ext:t.attr("data-map-ext"),subdomains:t.attr("data-map-subdomains"),maxZoom:0<i&&i<24?i:24,minZoom:3}),L.tileLayer(t.attr("data-provider-url"),{maxZoom:parseInt(t.attr("data-provider-max-zoom"))}).addTo(map),drawButtons(map,t.attr("data-controls-position")),loadTracks(map,"boat"===n||"track"===n?n:"boat"),loadMapItems(map),checkTrackingHealth(),map}function initWindyMap(i){var n,t=parseInt(i.attr("data-zoom")),e=parseInt(i.attr("data-provider-max-zoom")),o=i.attr("data-center-on"),s=i.attr("data-lat"),a=i.attr("data-lng");const r={worldCopyJump:!1,key:i.attr("data-key"),center:""!==s&&""!==a?[s,a]:[17,-61],verbose:void 0!==windyDebug&&windyDebug,scrollWheelZoom:!1,zoom:0<t&&t<24?t:7,dragging:!(L.Browser.mobile&&"undefined"==typeof map_mobile_scroll),tap:!(L.Browser.mobile&&"undefined"==typeof map_mobile_scroll),ext:i.attr("data-map-ext"),subdomains:i.attr("data-map-subdomains"),maxZoom:0<e&&e<24?e:24,minZoom:3};return $.getScript("https://api.windy.com/assets/map-forecast/libBoot.js",function(t){windyInit(r,e=>{n=e.map;var t;L.control.zoom({zoomInText:"1",zoomOutText:"0"}).addTo(e.map),drawButtons(e.map,i.attr("data-controls-position")),loadTracks(e.map,"boat"===o||"track"===o?o:"boat"),loadMapItems(n),checkTrackingHealth(),e.map.on("click",function(t){e.picker.open({lat:t.latlng.lat,lon:t.latlng.lng})}),$(document).find("#map-infos").hasClass("lower-left")&&(t=$(document).find("#map-infos").width()+30,$("#windy").find("#bottom").css({"margin-left":t})),$(document).find("#map-infos").hasClass("lower-right")&&(t=$(document).find("#map-infos").width()+30,$("#windy").find("#bottom").css({"margin-right":t})),$("#windy .leaflet-control-zoom .leaflet-control-zoom-in").text("+"),$("#windy .leaflet-control-zoom .leaflet-control-zoom-out").text("-")})}),n}function DaysInMonth(t){var e=new Date(t.getFullYear(),t.getMonth(),1);return(new Date(t.getFullYear(),t.getMonth()+1,1)-e)/864e5}function formatDateTZ(t,e=!0){var i="en";try{i=sblang.locale}catch(t){i="en"}const n=new Intl.DateTimeFormat(i,{month:"short"});var o=n.format(t),s=t.getFullYear().toString(),a=(t.getMonth()+1).toString(),r=t.getDate().toString(),h=t.getHours().toString(),i=t.getMinutes().toString(),t=(t.getSeconds().toString(),t.getTimezoneOffset()/-60);return 0<t&&(t="+"+t),e?(r[1]?r:"0"+r[0])+"."+(a[1]?a:"0"+a[0])+"."+s+" @"+(h[1]?h:"0"+h[0])+"h"+(i[1]?i:"0"+i[0])+" UTC"+t:(r[1]?r:"0"+r[0])+" "+o+" "+s}function formatDateToMinutesAgo(t){var e=new Date-t,i=Math.floor(e/31536e6),n=Math.floor(e/2592e6),o=Math.floor(e/864e5),s=Math.floor(e%864e5/36e5),a=Math.round(e%864e5%36e5/6e4),e="";return 10<o||1<n||1<i?e=formatDateTZ(t,!1):(1===o?e+=o+" "+sblang.day+", ":1<o&&(e+=o+" "+sblang.days+", "),1===s?e+=s+" "+sblang.hour:1<s&&(e+=s+" "+sblang.hours),o<1&&(e+=", "+a+" min."),"en"===document.documentElement.lang&&(e+=" ago")),e}function formatDateToString(t){var e=new Date;(i=e.getDate()-t.getDate())<0&&(e.setMonth(e.getMonth()-1),i+=DaysInMonth(e)),(n=e.getMonth()-t.getMonth())<0&&(e.setFullYear(e.getFullYear()-1),n+=12);var i=Math.ceil(i),e=e.getFullYear()-t.getFullYear(),t="",e=parseInt(e),n=parseInt(n);return i=parseInt(i),1<e?t+=e+" "+sblang.years:1===e&&(t+=e+" "+sblang.year),0<e&&0<n&&(t+=", "),1<n?t+=n+" "+sblang.months:1===n&&(t+=n+" "+sblang.month),0<n&&0<i&&(t+=" "+sblang.and+" "),1<i?t+=i+" "+sblang.days:1===i&&(t+=i+" "+sblang.day),t}function formatDate(t){var e=navigator.language||navigator.userLanguage,i={day:"numeric",month:"long",year:"numeric"};return new Date(t).toLocaleDateString(e,i)}function cloneOptions(t){var e,i={};for(e in t){var n=t[e];n&&n.clone?i[e]=n.clone():n instanceof L.Layer?i[e]=cloneLayer(n):i[e]=n}return i}function cloneInnerLayers(t){var e=[];return t.eachLayer(function(t){e.push(cloneLayer(t))}),e}function drawButtons(t,e){var i="lower-left"===e?"bottomleft":"lower-right"===e?"bottomright":"upper-left"===e?"topleft":"upper-right"===e?"topright":"topleft",n=L.Control.extend({options:{position:i},onAdd:function(t){var e=L.DomUtil.create("div","leaflet-custom-btn leaflet-control-zoom leaflet-bar leaflet-recenter leaflet-control "),i=L.DomUtil.create("a","leaflet-control-custom",e);L.DomUtil.create("i","fa fa-crosshairs",i);return e.title="Center map on boat",e.classList.add("center-boat"),e.onclick=function(){void 0!==map_boat_position&&t.flyTo(map_boat_position)},e}}),e=L.Control.extend({options:{position:i},onAdd:function(t){var e=L.DomUtil.create("div","leaflet-custom-btn leaflet-control-zoom leaflet-bar leaflet-terminator leaflet-control"),i=(L.DomUtil.create("a","leaflet-control-custom",e),L.terminator());return e.title="Show day and night regions",e.classList.add("day-night-toggle"),e.onclick=function(){t.hasLayer(i)?(t.removeLayer(i),e.classList.remove("active")):(t.addLayer(i),e.classList.add("active"))},e}}),i=L.Control.Ruler=L.Control.extend({options:{position:i,circleMarker:{color:"red",radius:2},lineStyle:{color:"red",dashArray:"1,6"},lengthUnit:{display:"NM",decimal:2,factor:.5399568035,label:"Distance "},angleUnit:{display:"&deg;",decimal:2,factor:null,label:"Bearing   "}},onAdd:function(t){this._map=t,this._container=L.DomUtil.create("div","leaflet-bar");L.DomUtil.create("a","leaflet-custom-btn leaflet-control-custom",this._container);return this._container.title="Mesure distances",this._container.classList.add("ruler"),this._container.classList.add("leaflet-ruler"),L.DomEvent.disableClickPropagation(this._container),L.DomEvent.on(this._container,"click",this._toggleMeasure,this),this._choice=!1,this._defaultCursor=this._map._container.style.cursor,this._allLayers=L.layerGroup(),this._container},onRemove:function(){L.DomEvent.off(this._container,"click",this._toggleMeasure,this)},_toggleMeasure:function(){this._choice=!this._choice,this._clickedLatLong=null,this._clickedPoints=[],this._totalLength=0,this._choice?(this._map.doubleClickZoom.disable(),L.DomEvent.on(this._map._container,"keydown",this._escape,this),L.DomEvent.on(this._map._container,"dblclick",this._closePath,this),this._container.classList.add("leaflet-ruler-clicked"),this._clickCount=0,this._tempLine=L.featureGroup().addTo(this._allLayers),this._tempPoint=L.featureGroup().addTo(this._allLayers),this._pointLayer=L.featureGroup().addTo(this._allLayers),this._polylineLayer=L.featureGroup().addTo(this._allLayers),this._allLayers.addTo(this._map),this._map._container.style.cursor="crosshair",this._map.on("click",this._clicked,this),this._map.on("mousemove",this._moving,this)):(this._map.doubleClickZoom.enable(),L.DomEvent.off(this._map._container,"keydown",this._escape,this),L.DomEvent.off(this._map._container,"dblclick",this._closePath,this),this._container.classList.remove("leaflet-ruler-clicked"),this._map.removeLayer(this._allLayers),this._allLayers=L.layerGroup(),this._map._container.style.cursor=this._defaultCursor,this._map.off("click",this._clicked,this),this._map.off("mousemove",this._moving,this))},_clicked:function(t){this._clickedLatLong=t.latlng,this._clickedPoints.push(this._clickedLatLong),L.circleMarker(this._clickedLatLong,this.options.circleMarker).addTo(this._pointLayer),0<this._clickCount&&!t.latlng.equals(this._clickedPoints[this._clickedPoints.length-2])&&(this._movingLatLong&&L.polyline([this._clickedPoints[this._clickCount-1],this._movingLatLong],this.options.lineStyle).addTo(this._polylineLayer),this._totalLength+=this._result.Distance,t=1<this._clickCount?"<b>"+this.options.angleUnit.label+"</b>&nbsp;"+this._result.Bearing.toFixed(this.options.angleUnit.decimal)+"&nbsp;"+this.options.angleUnit.display+"<br><b>"+this.options.lengthUnit.label+"</b>&nbsp;"+this._totalLength.toFixed(this.options.lengthUnit.decimal)+"&nbsp;"+this.options.lengthUnit.display:"<b>"+this.options.angleUnit.label+"</b>&nbsp;"+this._result.Bearing.toFixed(this.options.angleUnit.decimal)+"&nbsp;"+this.options.angleUnit.display+"<br><b>"+this.options.lengthUnit.label+"</b>&nbsp;"+this._result.Distance.toFixed(this.options.lengthUnit.decimal)+"&nbsp;"+this.options.lengthUnit.display,L.circleMarker(this._clickedLatLong,this.options.circleMarker).bindTooltip(t,{permanent:!0,className:"result-tooltip"}).addTo(this._pointLayer).openTooltip()),this._clickCount++},_moving:function(t){this._clickedLatLong&&(L.DomEvent.off(this._container,"click",this._toggleMeasure,this),this._movingLatLong=t.latlng,this._tempLine&&(this._map.removeLayer(this._tempLine),this._map.removeLayer(this._tempPoint)),this._addedLength=0,this._tempLine=L.featureGroup(),this._tempPoint=L.featureGroup(),this._tempLine.addTo(this._map),this._tempPoint.addTo(this._map),this._calculateBearingAndDistance(),this._addedLength=this._result.Distance+this._totalLength,L.polyline([this._clickedLatLong,this._movingLatLong],this.options.lineStyle).addTo(this._tempLine),t=1<this._clickCount?"<b>"+this.options.angleUnit.label+"</b>&nbsp;"+this._result.Bearing.toFixed(this.options.angleUnit.decimal)+"&nbsp;"+this.options.angleUnit.display+"<br><b>"+this.options.lengthUnit.label+"</b>&nbsp;"+this._addedLength.toFixed(this.options.lengthUnit.decimal)+"&nbsp;"+this.options.lengthUnit.display+'<br><div class="plus-length">(+'+this._result.Distance.toFixed(this.options.lengthUnit.decimal)+")</div>":"<b>"+this.options.angleUnit.label+"</b>&nbsp;"+this._result.Bearing.toFixed(this.options.angleUnit.decimal)+"&nbsp;"+this.options.angleUnit.display+"<br><b>"+this.options.lengthUnit.label+"</b>&nbsp;"+this._result.Distance.toFixed(this.options.lengthUnit.decimal)+"&nbsp;"+this.options.lengthUnit.display,L.circleMarker(this._movingLatLong,this.options.circleMarker).bindTooltip(t,{sticky:!0,offset:L.point(0,-40),className:"moving-tooltip"}).addTo(this._tempPoint).openTooltip())},_escape:function(t){27===t.keyCode&&(0<this._clickCount?this._closePath():(this._choice=!0,this._toggleMeasure()))},_calculateBearingAndDistance:function(){var t=this._clickedLatLong.lat,e=this._clickedLatLong.lng,i=this._movingLatLong.lat,n=this._movingLatLong.lng,o=Math.PI/180,s=Math.sin((n-e)*o)*Math.cos(i*o),a=Math.cos(t*o)*Math.sin(i*o)-Math.sin(t*o)*Math.cos(i*o)*Math.cos((n-e)*o),r=Math.atan2(s,a)*((this.options.angleUnit.factor?this.options.angleUnit.factor/2:180)/Math.PI);r+=r<0?this.options.angleUnit.factor||360:0;s=this.options.lengthUnit.factor?6371*this.options.lengthUnit.factor:6371,a=(i-t)*o,e=(n-e)*o,e=Math.sin(a/2)*Math.sin(a/2)+Math.cos(t*o)*Math.cos(i*o)*Math.sin(e/2)*Math.sin(e/2),e=2*Math.atan2(Math.sqrt(e),Math.sqrt(1-e));this._result={Bearing:r,Distance:s*e}},_closePath:function(){this._map.removeLayer(this._tempLine),this._map.removeLayer(this._tempPoint),this._clickCount<=1&&this._map.removeLayer(this._pointLayer),this._choice=!1,L.DomEvent.on(this._container,"click",this._toggleMeasure,this),this._toggleMeasure()}});t.addControl(new n),t.addControl(new i),t.addControl(new e)}function exist(t){return null!=t&&""!==t}function generateItemsMarkers(t,e){var i=void 0!==t.image&&null!==t.image&&""!==t.image,n=i?t.image:"https://www.skipperblogs.com/assets/img/map-icons/map-empty-marker-img.svg",o=L.divIcon({html:'<img class="marker-img" src="https://www.skipperblogs.com/media/cache/th_150x150'+n+'">',iconSize:[40,40],iconAnchor:[20,20],popupAnchor:[0,-20],className:"marker-type-"+t.type}),s=parseFloat(t.lng),a=s+360,r=s-360,n=new L.Marker([t.lat,s],{clickable:!0,title:t.title,icon:o,type:"waypoint",extensions:null}),s=new L.Marker([t.lat,a],{clickable:!0,title:t.title,icon:o,type:"waypoint",extensions:null}),a=new L.Marker([t.lat,r],{clickable:!0,title:t.title,icon:o,type:"waypoint",extensions:null}),r='<div class="tooltip-top link" data-url="'+t.url+'" ';i&&(r+='style="background-image:url(/media/cache/content_th_320/'+t.image+')"'),r+='><span class="pull-right type">'+sblang[t.type]+'<i class="fa fa-pencil-alt"></i></span>',r+='<strong class="title">'+t.title;o="";exist(t.country)&&(o='<img class="country" src="https://www.skipperblogs.com/assets/img/country-flags/24x24/'+t.country+'.png" />'),exist(t.date)?r+='<br><small class="date">'+o+formatDate(t.date.date)+"</small>":exist(t.country)&&(r+='<br><small class="date">'+o+"</small>"),r+="</strong>",r+='</div><div class="tooltip-body">',exist(t.excerpt)&&(r+='<p style="margin-bottom: 0">'+t.excerpt+"</p>"),exist(t.url)&&(r+='<a data-id="'+t.id+'" style="float: right" href="'+t.url+'">'+("gallery"===t.type?sblang.see_gallery:sblang.read_more)+"</a><br><br>"),r+="</div>";r=L.responsivePopup({closeButton:!1,offset:new L.Point(-20,20),className:"popup_item_located popup_"+(i?"":"no-img")}).setContent(r);n.addTo(e).bindPopup(r).on("mouseover",function(t){this.openPopup()}),s.addTo(e).bindPopup(r).on("mouseover",function(t){this.openPopup()}),a.addTo(e).bindPopup(r).on("mouseover",function(t){this.openPopup()})}function loadMapItems(e){void 0!==navigation_initialized&&!1===navigation_initialized||!0===window.items_loading||!0===window.items_loaded||void 0!==load_articles&&!load_articles||(window.items_loading=!0,$.ajax({url:"/map/items"+(void 0!==site_id?"/"+site_id:""),success:function(t){t.forEach(function(t){generateItemsMarkers(t,e)}),window.items_loaded=!0}}))}function loadTracks(o,s){window.track_loading=!0;var t=1e5*Math.random();gpx=new L.GPX(url.map_data+"?"+t,{async:!0,map:o,load_articles:void 0===load_articles||load_articles,display_tracking_vertex:!0,preferCanvas:!0,marker_options:{startIconUrl:"https://www.skipperblogs.com/assets/img/map-icons/start.png"}}).on("addline",function(t){void 0!==t.track_type&&"tracking"===t.track_type&&L.polylineDecorator(t.line,{patterns:[{offset:25,repeat:150,symbol:L.Symbol.arrowHead({pixelSize:10,pathOptions:{fillOpacity:1,weight:0,fillColor:t.line.options.color}})}]}).addTo(o)}).on("addpoint",function(t){}).on("loaded",function(t){$(".info-last-pos span").html(t.target.get_last_pos()),$(".info-last-update span").html(formatDateToMinutesAgo(t.target.get_last_updateOBJ())),$(".info-total-distance span").html(parseInt(t.target.get_distance_imp()));var e=t.target.get_avg_speed_imp(),i=t.target.get_avg_pace_per_day(),n=t.target.get_max_speed();$(".info-avg-speed span").html("0.0"===e?"<small><i>"+sblang.map_no_enough_data+"</i></small>":e+" "+sblang.speed_unit),$(".info-pace-day span").html(0===i?"<small><i>"+sblang.map_no_enough_data+"</i></small>":i+" "+sblang.miles),$(".info-max-speed span").html(0===n?"<small><i>"+sblang.map_no_enough_data+"</i></small>":n+" "+sblang.speed_unit),void 0!==t.target.get_boat_marker()&&(map_boat_position=t.target.get_boat_marker().getLatLng(),n=t.target.get_start_time(),$(".info-total-days span").html(formatDateToString(n)),"boat"!==s&&void 0!==t.target.get_track_tracking().getBounds()._northEast&&void 0!==t.target.get_track_tracking().getBounds()._southWest?o.fitBounds(t.target.get_track_tracking().getBounds()):o.panTo(t.target.get_boat_marker().getLatLng())),window.track_loaded=!0}).addTo(o)}function getOnlyMapStats(){void 0===map&&void 0===gpx&&(map=L.map("dummymap"),gpx=new L.GPX(url.map_data,{async:!0,map:map}).on("loaded",function(t){$(".info-last-pos span").html(t.target.get_last_pos()),$(".info-last-update span").html(formatDateToMinutesAgo(t.target.get_last_updateOBJ())),$(".info-total-distance span").html(parseInt(t.target.get_distance_imp()));var e=t.target.get_avg_speed_imp(),i=t.target.get_avg_pace_per_day(),n=t.target.get_max_speed();$(".info-avg-speed span").html("0.0"===e?"<small><i>"+sblang.map_no_enough_data+"</i></small>":e+" "+sblang.speed_unit),$(".info-pace-day span").html(0===i?"<small><i>"+sblang.map_no_enough_data+"</i></small>":i+" "+sblang.miles),$(".info-max-speed span").html(0===n?"<small><i>"+sblang.map_no_enough_data+"</i></small>":n+" "+sblang.speed_unit),$(".info-total-days span").html(formatDateToString(t.target.get_start_time()))}).addTo(map))}Date.prototype.ddmmyyyyhhmm=function(){var t=this.getFullYear().toString(),e=(this.getMonth()+1).toString(),i=this.getDate().toString(),n=this.getHours().toString(),o=this.getMinutes().toString(),s=(this.getSeconds().toString(),this.getTimezoneOffset()/-60);return(i[1]?i:"0"+i[0])+"."+(e[1]?e:"0"+e[0])+"."+ +t+" @"+(n[1]?n:"0"+n[0])+"h"+(o[1]?o:"0"+o[0])+" UTC"+(s=0<s?"+"+s:s)},L.GPX=L.FeatureGroup.extend({initialize:function(t,e){e.max_point_interval=e.max_point_interval||_MAX_POINT_INTERVAL_MS,e.marker_options=this._merge_objs(_DEFAULT_MARKER_OPTS,e.marker_options||{}),e.polyline_options=e.polyline_options||{},e.gpx_options=this._merge_objs(_DEFAULT_GPX_OPTS,e.gpx_options||{}),void 0===e.load_markers&&(e.load_markers=!0),void 0===e.load_articles&&(e.load_articles=!0),void 0===e.display_tracking_vertex&&(e.display_tracking_vertex=!0),void 0===e.load_only_tracking&&(e.load_only_tracking=!1),L.Util.setOptions(this,e),L.GPXTrackIcon=L.Icon.extend({options:e.marker_options}),this._gpx=t,this._gpx_backup=t,this.map=e.map,this._layers={},this._init_info(),t&&this._parse(t,e,this.options.async)},get_duration_string:function(t,e){var i="";_DAY_IN_MILLIS<=t&&(i+=Math.floor(t/_DAY_IN_MILLIS)+"d ",t%=_DAY_IN_MILLIS),_HOUR_IN_MILLIS<=t&&(i+=Math.floor(t/_HOUR_IN_MILLIS)+":",t%=_HOUR_IN_MILLIS);var n=Math.floor(t/_MINUTE_IN_MILLIS);t%=_MINUTE_IN_MILLIS,n<10&&(i+="0"),i+=n+"'";n=Math.floor(t/_SECOND_IN_MILLIS);return t%=_SECOND_IN_MILLIS,n<10&&(i+="0"),i+=n,i+=!e&&0<t?"."+Math.round(1e3*Math.floor(t))/1e3:'"'},get_duration_string_iso:function(t,e){return this.get_duration_string(t,e).replace("'",":").replace('"',"")},to_miles:function(t){return t/1.852},to_ft:function(t){return 3.28084*t},m_to_km:function(t){return t/1e3},m_to_mi:function(t){return t/1852},ms_to_kmh:function(t){return 3.6*t},ms_to_mih:function(t){return t/1609.34*3600},get_boat_marker:function(){return this._info.boat_marker},get_track_tracking:function(){return this._info.track_tracking},get_name:function(e){var i=null;return this._info.tracks.forEach(t=>{t.id===e&&(i=t.track_name)}),i},get_color:function(e){var i=null;return this._info.tracks.forEach(t=>{t.id===e&&(i=t.color)}),i},get_weight:function(e){var i=null;return this._info.tracks.forEach(t=>{t.id===e&&(i=t.weight)}),i},get_dasharray:function(e){var i=null;return this._info.tracks.forEach(t=>{t.id===e&&(i=t.dasharray)}),i},get_dashoffset:function(e){var i=null;return this._info.tracks.forEach(t=>{t.id===e&&(i=t.dashoffset)}),i},get_desc:function(){return this._info.desc},get_last_pos:function(){return this._info.last_pos},get_last_update:function(){return this._info.last_update},get_last_updateISO:function(){return this._info.last_updateISO},get_last_updateOBJ:function(){return this._info.last_updateOBJ},get_author:function(){return this._info.author},get_copyright:function(){return this._info.copyright},get_distance:function(){return this._info.length},get_distance_imp:function(){return this.to_miles(this.m_to_km(this.get_distance()))},get_start_time:function(){return this._info.duration.start},get_end_time:function(){return this._info.duration.end},get_moving_time:function(){return this._info.duration.moving},get_total_time:function(){return this._info.duration.total},get_max_speed:function(){return this._info.max_speed},get_avg_speed_imp:function(){return avg_speed_imp.toFixed(1)},get_avg_pace_per_day:function(){return parseInt(24*avg_speed_imp)},get_moving_pace:function(){return this.get_moving_time()/this.m_to_km(this.get_distance())},get_moving_pace_imp:function(){return this.get_moving_time()/this.get_distance_imp()},get_moving_speed:function(){return this.m_to_km(this.get_distance())/(this.get_moving_time()/36e5)},get_moving_speed_imp:function(){return this.to_miles(this.m_to_km(this.get_distance()))/(this.get_moving_time()/36e5)},get_total_speed:function(){return this.m_to_km(this.get_distance())/(this.get_total_time()/36e5)},get_total_speed_imp:function(){return this.to_miles(this.m_to_km(this.get_distance()))/(this.get_total_time()/36e5)},get_average_distance_per_day_imp:function(){},get_elevation_gain:function(){return this._info.elevation.gain},get_elevation_loss:function(){return this._info.elevation.loss},get_elevation_gain_imp:function(){return this.to_ft(this.get_elevation_gain())},get_elevation_loss_imp:function(){return this.to_ft(this.get_elevation_loss())},get_elevation_data:function(){var e=this;return this._info.elevation._points.map(function(t){return e._prepare_data_point(t,e.m_to_km,null,function(t,e){return t.toFixed(2)+" km, "+e.toFixed(0)+" m"})})},get_elevation_data_imp:function(){var e=this;return this._info.elevation._points.map(function(t){return e._prepare_data_point(t,e.m_to_mi,e.to_ft,function(t,e){return t.toFixed(2)+" mi, "+e.toFixed(0)+" ft"})})},get_elevation_max:function(){return this._info.elevation.max},get_elevation_min:function(){return this._info.elevation.min},get_elevation_max_imp:function(){return this.to_ft(this.get_elevation_max())},get_elevation_min_imp:function(){return this.to_ft(this.get_elevation_min())},get_speed_data:function(){var e=this;return this._info.speed._points.map(function(t){return e._prepare_data_point(t,e.m_to_km,e.ms_to_kmh,function(t,e){return t.toFixed(2)+" km, "+e.toFixed(2)+" km/h"})})},get_speed_data_imp:function(){var e=this;return this._info.speed._points.map(function(t){return e._prepare_data_point(t,e.m_to_mi,e.ms_to_mih,function(t,e){return t.toFixed(2)+" mi, "+e.toFixed(2)+" mi/h"})})},get_average_hr:function(){return this._info.hr.avg},get_average_temp:function(){return this._info.atemp.avg},get_average_cadence:function(){return this._info.cad.avg},get_heartrate_data:function(){var e=this;return this._info.hr._points.map(function(t){return e._prepare_data_point(t,e.m_to_km,null,function(t,e){return t.toFixed(2)+" km, "+e.toFixed(0)+" bpm"})})},get_heartrate_data_imp:function(){var e=this;return this._info.hr._points.map(function(t){return e._prepare_data_point(t,e.m_to_mi,null,function(t,e){return t.toFixed(2)+" mi, "+e.toFixed(0)+" bpm"})})},get_cadence_data:function(){var e=this;return this._info.cad._points.map(function(t){return e._prepare_data_point(t,e.m_to_km,null,function(t,e){return t.toFixed(2)+" km, "+e.toFixed(0)+" rpm"})})},get_temp_data:function(){var e=this;return this._info.atemp._points.map(function(t){return e._prepare_data_point(t,e.m_to_km,null,function(t,e){return t.toFixed(2)+" km, "+e.toFixed(0)+" degrees"})})},get_cadence_data_imp:function(){var e=this;return this._info.cad._points.map(function(t){return e._prepare_data_point(t,e.m_to_mi,null,function(t,e){return t.toFixed(2)+" mi, "+e.toFixed(0)+" rpm"})})},get_temp_data_imp:function(){var e=this;return this._info.atemp._points.map(function(t){return e._prepare_data_point(t,e.m_to_mi,null,function(t,e){return t.toFixed(2)+" mi, "+e.toFixed(0)+" degrees"})})},reload:function(t=null,e=null){(e=e||this._gpx).split("?v").length<2&&(e+="?v="),e+=Math.floor(1e5*Math.random()),this._init_info(),this.clearLayers(),this._parse(e,this.options,this.options.async,t)},reset:function(t=null){this._init_info(),this.clearLayers(),this._parse(this._gpx_backup,this.options,this.options.async,t)},_merge_objs:function(t,e){var i,n={};for(i in t)n[i]=t[i];for(i in e)n[i]=e[i];return n},_prepare_data_point:function(t,e,i,n){t=[e&&e(t[0])||t[0],i&&i(t[1])||t[1]];return t.push(n&&n(t[0],t[1])||t[0]+": "+t[1]),t},_init_info:function(){this._info={name:null,length:0,elevation:{gain:0,loss:0,max:0,min:1/0,_points:[]},speed:{max:0,_points:[]},hr:{avg:0,_total:0,_points:[]},duration:{start:null,end:null,moving:0,total:0},atemp:{avg:0,_total:0,_points:[]},cad:{avg:0,_total:0,_points:[]}}},_load_xml:function(t,e,i,n){null==n&&(n=this.options.async),null==i&&(i=this.options);var o=new window.XMLHttpRequest;o.open("GET",t,n);try{o.overrideMimeType("text/xml")}catch(t){}o.onreadystatechange=function(){4==o.readyState&&200==o.status&&e(o.responseXML,i)},o.send(null)},_parse:function(t,e,i,n=null){function o(t,e){var i=a._parse_gpx_data(t,e);i?(a.addLayer(i),a.fire("loaded",{layers:i,element:t})):a.fire("error",{err:"No parseable layers of type(s) "+JSON.stringify(e.gpx_options.parseElements)})}var s,a=this;"<"===t.substr(0,1)?(s=new DOMParser,i?setTimeout(function(){o(s.parseFromString(t,"text/xml"),e)}):o(s.parseFromString(t,"text/xml"),e)):this._load_xml(t,o,e,i),n&&n()},_parse_gpx_data:function(t,e){var i,n=[],o=e.map,s=void 0!==t.getElementsByTagName("track_name")?t.getElementsByTagName("track_name"):"",a=void 0!==t.getElementsByTagName("track_type")?t.getElementsByTagName("track_type"):"",r=void 0!==t.getElementsByTagName("track_id")?t.getElementsByTagName("track_id"):"",h=void 0!==t.getElementsByTagName("color")?t.getElementsByTagName("color"):"",l=void 0!==t.getElementsByTagName("weight")?t.getElementsByTagName("weight"):"",c=void 0!==t.getElementsByTagName("dasharray")?t.getElementsByTagName("dasharray"):"",u=void 0!==t.getElementsByTagName("dashoffset")?t.getElementsByTagName("dashoffset"):"";this._info.tracks=[];for(var p=this._info.max_speed=0;p<r.length;p++)this._info.tracks.push({id:r[p].textContent});for(p=0;p<s.length;p++)void 0!==this._info.tracks[p]&&(this._info.tracks[p].track_name=s[p].textContent);for(p=0;p<h.length;p++)void 0!==this._info.tracks[p]&&(this._info.tracks[p].color=h[p].textContent);for(p=0;p<l.length;p++)void 0!==this._info.tracks[p]&&(this._info.tracks[p].weight=l[p].textContent);for(p=0;p<c.length;p++)void 0!==this._info.tracks[p]&&(this._info.tracks[p].dasharray=c[p].textContent);for(p=0;p<u.length;p++)void 0!==this._info.tracks[p]&&(this._info.tracks[p].dashoffset=u[p].textContent);0<(D=t.getElementsByTagName("desc")).length&&(this._info.desc=D[0].textContent);var d=t.getElementsByTagName("author");0<d.length&&(this._info.author=d[0].textContent);d=t.getElementsByTagName("copyright");0<d.length&&(this._info.copyright=d[0].textContent);d=e.gpx_options.parseElements;if(-1<d.indexOf("route")){var _=t.getElementsByTagName("rte");for(p=0;p<_.length;p++)var a=(Z=void 0!==_[p].getElementsByTagName("track_type")?_[p].getElementsByTagName("track_type"):"")[0].textContent,m={boat_icon:b=(y=void 0!==_[p].getElementsByTagName("boat_icon")?_[p].getElementsByTagName("boat_icon"):"")[0].textContent,track_type:a,track_id:w=(g=void 0!==_[p].getElementsByTagName("track_id")?_[p].getElementsByTagName("track_id"):"")[0].textContent},n=n.concat(this._parse_segment(_[p],e,{},"rtept",m))}if(-1<d.indexOf("track")){var f=t.getElementsByTagName("trk");for(p=0;p<f.length;p++){var g,y,v=f[p],x=this._extract_styling(v),w=void 0!==(g=void 0!==v.getElementsByTagName("track_id")?v.getElementsByTagName("track_id"):"")[0]?g[0].textContent:"",a=void 0!==(Z=void 0!==v.getElementsByTagName("track_type")?v.getElementsByTagName("track_type"):"")[0]?Z[0].textContent:"",b=void 0!==(y=void 0!==v.getElementsByTagName("boat_icon")?v.getElementsByTagName("boat_icon"):"")[0]?y[0].textContent:null;if(!x.hidden||"tracking"===a||"undefined"!=typeof display_hidden_tracks&&display_hidden_tracks){var m={boat_icon:b,track_type:a,track_id:w,include_in_stats:x.include_in_stats||"tracking"===a,hidden:x.hidden&&"tracking"!==a},T=[];if(e.gpx_options.joinTrackSegments)n=n.concat(this._parse_segment(v,e,x,"trkpt",m));else{var P=v.getElementsByTagName("trkseg");for(0<v.getElementsByTagName("name").length?m.track_name=v.getElementsByTagName("name")[0].textContent:m.track_name="untitled",G=0;G<P.length;G++)if(n=n.concat(this._parse_segment(P[G],e,x,"trkpt",m)),e.display_tracking_vertex&&"tracking"===a){var k={radius:4,stroke:!0,weight:2,opacity:.6,color:isDark(x.color)?"#000000":"#ffffff",fill:!0,fillColor:x.color,fillOpacity:1};o.getZoom()<8?(k.radius=0,k.opacity=0,k.weight=0,k.fillOpacity=0):8<=o.getZoom()&&(k.radius=o.getZoom()/2+1,k.opacity=.6,k.weight=2,k.fillOpacity=1);for(var M=P[G].getElementsByTagName("trkpt"),C=0;C<M.length;C++){var E=new L.LatLng(M[C].getAttribute("lat"),M[C].getAttribute("lon")),S=null;0<(H=M[C].getElementsByTagName("time")).length&&(S=new Date(Date.parse(H[0].textContent)));var z=M[C].getElementsByTagName("extensions"),B=[];0<z.length&&z[0].childNodes.forEach(function(t){B[t.nodeName]=t.textContent});var I='<div class="tooltip-top">';I+='<span class="source">',void 0!==B.source&&null!==B.source&&""!==B.source&&(I+='<i class="fa fa-location-arrow"></i>&nbsp;'+sblang.position_report+" via "+B.source+"<br>"),I+="</span>",I+='</div><div class="tooltip-body">',null!==S&&(I+=S.ddmmyyyyhhmm()+"<br>"),void 0!==B.country_code&&2===B.country_code.length&&(I+='<span class="country"><img src="https://www.skipperblogs.com/assets/img/country-flags/24x24/'+B.country_code+'.png" title="'+(void 0!==B.country_name?B.country_name:"")+'"></span>'),void 0!==B.course&&0<B.course.length&&(I+=sblang.course+" "+B.course+"<br>"),void 0!==B.speed&&0<B.speed.length&&(I+=sblang.speed+" "+B.speed+"kts<br>"),void 0===B.weathercode&&void 0===B.temperature&&void 0===B.windspeed&&void 0===B.winddirection||(I+='<span class="weather">'),void 0!==B.weathercode&&(void 0!==B.period&&"night"===B.period?I+='<span class="code"><img width="90" height="70" src="https://www.skipperblogs.com/assets/img/weather-icons/codes/'+B.weathercode+'_night.svg"></span>':I+='<span class="code"><img width="90" height="70" src="https://www.skipperblogs.com/assets/img/weather-icons/codes/'+B.weathercode+'.svg"></span>'),void 0!==B.pressure&&(I+='<i><img width="30" src="https://www.skipperblogs.com/assets/img/weather-icons/fill/final/barometer.svg"> '+B.pressure+" hPa</i>"),void 0!==B.temperature&&(I+='<i><img width="30" src="https://www.skipperblogs.com/assets/img/weather-icons/fill/final/thermometer-celsius.svg"> '+B.temperature+"C</i>"),void 0!==B.windspeed&&(I+='<i><img width="30" src="https://www.skipperblogs.com/assets/img/weather-icons/fill/final/windsock.svg"> '+B.windspeed+" "+sblang.speed_unit+" "+B.winddirection+"</i>"),void 0===B.weathercode&&void 0===B.temperature&&void 0===B.windspeed&&void 0===B.winddirection||(I+="</span>"),void 0!==B.text&&(I+="<p>"+B.text+"</p>"),I+="</div>",T[C]=L.circleMarker(E,k).addTo(o);E=L.responsivePopup({className:"popup_waypoint_text",closeButton:!1,offset:new L.Point(-20,20)}).setContent(I);T[C].addTo(o).bindPopup(E).on("mouseover",function(){this.openPopup()}).on("mouseout",function(){this.closePopup()}),setTimeout(function(){void 0!==T[C]&&T[C].bringToFront()},500)}}}o.on("zoomend",function(){T.forEach(function(t){o.getZoom()<6?(k.radius=0,k.weight=0,k.opacity=.6,k.fillOpacity=0,t.setStyle(k)):6<=o.getZoom()&&(k.radius=o.getZoom()/2,k.opacity=.6,k.weight=2,k.fillOpacity=1,t.setStyle(k))})})}}}if(this._info.hr.avg=Math.round(this._info.hr._total/this._info.hr._points.length),this._info.cad.avg=Math.round(this._info.cad._total/this._info.cad._points.length),this._info.atemp.avg=Math.round(this._info.atemp._total/this._info.atemp._points.length),-1<d.indexOf("waypoint"))for(i=t.getElementsByTagName("wpt"),p=0;p<i.length;p++){new L.LatLng(i[p].getAttribute("lat"),i[p].getAttribute("lon"));var N=i[p].getElementsByTagName("name"),A=0<N.length?N[0].textContent:"",I="",z=i[p].getElementsByTagName("extensions"),B=[];0<z.length&&z[0].childNodes.forEach(function(t){B[t.nodeName]=t.textContent});var Z,O=i[p].getElementsByTagName("desc"),D=0<O.length?O[0].textContent:"",R=i[p].getElementsByTagName("sym"),U=0<R.length?R[0].textContent:null,j=0<(Z=i[p].getElementsByTagName("type")).length?Z[0].textContent:null,F=i[p].getElementsByTagName("time"),H=0<F.length?new Date(F[0].textContent):null,N=e.marker_options.wptIcons,O=e.marker_options.wptIconUrls,R=e.marker_options.wptIconsType,F=e.marker_options.wptIconTypeUrls,W=e.marker_options.pointMatchers||[];if(N&&U&&N[U])N[U];else if(R&&j&&R[j])R[j];else if(O&&U&&O[U])new L.GPXTrackIcon({iconUrl:O[U]});else if(F&&j&&F[j])new L.GPXTrackIcon({iconUrl:F[j]});else if(0<W.length){for(var G=0;G<W.length;G++)if(W[G].regex.test(A)){W[G].icon;break}}else N&&N[""]?N[""]:O&&O[""]&&(new L.GPXTrackIcon({iconUrl:O[""]}),L.icon({iconUrl:"https://www.skipperblogs.com/assets/img/map-icons/waypoint.svg",iconSize:[14,14],iconAnchor:[7,7],popupAnchor:[2,-20],className:"article-marker-"}),void 0!==B.point_type&&"waypoint"===B.point_type&&parseFloat(i[p].getAttribute("lat"))!==this._info.boat_marker._latlng.lat&&parseFloat(i[p].getAttribute("lon"))!==this._info.boat_marker._latlng.lng&&(I=waypointPopupContent(B)))}return 1<n.length?new L.FeatureGroup(n):1==n.length?n[0]:void 0},_parse_segment:function(t,e,i,n,o){var s=t.getElementsByTagName(n);if(!s.length)return[];for(var a,r,h=e.map,l=[],c=[],u=[],p=null,d=[],_=s[0],m=0;m<s.length;m++){var f,g=new L.LatLng(s[m].getAttribute("lat"),s[m].getAttribute("lon"));g.meta={time:null,ele:null,hr:null,cad:null,atemp:null,speed:null},0<(f=s[m].getElementsByTagName("time")).length?(g.meta.time=new Date(Date.parse(f[0].textContent)),"tracking"===o.track_type&&(this._info.last_update=g.meta.time.ddmmyyyyhhmm(),this._info.last_updateISO=g.meta.time.toISOString(),this._info.last_updateOBJ=g.meta.time)):g.meta.time=new Date("1970-01-01T00:00:00");var y=null!=p?Math.abs(g.meta.time-p.meta.time):0,v=this._dist2d({lat:_.getAttribute("lat"),lng:_.getAttribute("lon")},{lat:s[m].getAttribute("lat"),lng:s[m].getAttribute("lon")});1e4<v&&y<864e5&&(1<(C=v/1852/(y/1e3/3600))&&C<22&&d.push(C)),_=s[m],0<(f=s[m].getElementsByTagName("ele")).length?g.meta.ele=parseFloat(f[0].textContent):g.meta.ele=null!=p?p.meta.ele:null;var x=null!=p?g.meta.ele-p.meta.ele:0,w=null!=p?this._dist3d(p,g):0;if(0<(f=s[m].getElementsByTagName("speed")).length?g.meta.speed=parseFloat(f[0].textContent):g.meta.speed=0<y?1e3*w/y:0,0<(f=s[m].getElementsByTagName("name")).length)for(var b=f[0].textContent,T=e.marker_options.pointMatchers||[],P=0;P<T.length;P++)if(T[P].regex.test(b)){c.push({label:b,coords:g,icon:T[P].icon,element:s[m]});break}0<s[m].getElementsByTagName("gpxtpx:speed").length&&(M=s[m].getElementsByTagName("gpxtpx:speed")[0].textContent),o.include_in_stats&&M>this._info.max_speed&&(this._info.max_speed=M);var k=null,v=null,M=null,C=null;0<s[m].getElementsByTagName("text").length&&(k=s[m].getElementsByTagName("text")[0].textContent),0<s[m].getElementsByTagName("gpxtpx:course").length&&(v=s[m].getElementsByTagName("gpxtpx:course")[0].textContent),0<s[m].getElementsByTagName("source").length&&s[m].getElementsByTagName("source")[0].textContent,0<s[m].getElementsByTagName("time").length&&(C=s[m].getElementsByTagName("time")[0].textContent),g.meta.speed=M,g.meta.course=v,g.meta.text=k,g.meta.extensions={};try{for(var E,S,z=0;z<=s[m].getElementsByTagName("extensions")[0].childNodes.length;z++)void 0!==s[m].getElementsByTagName("extensions")[0].childNodes[z]&&(E=s[m].getElementsByTagName("extensions")[0].childNodes[z].nodeName,void 0!==(S=s[m].getElementsByTagName("extensions")[0].childNodes[z].innerHTML)&&"gpxtpx:TrackPointExtension"!==E&&(g.meta.extensions[E]=S));g.meta.extensions.time=C,g.meta.extensions.datetime_browser=new Date(C),g.meta.extensions.datetime_utc=(a=new Date(C),r="UTC",r=new Date(a.toLocaleString("en-US",{timeZone:r})),r=a.getTime()-r.getTime(),new Date(a.getTime()-r))}catch(t){"undefined"!=typeof reportJSError&&reportJSError(t,"web/assets/themes/common/js/leaflet-gpx.js",1091,null,t)}"tracking"===o.track_type&&m!==s.length-1&&null!==k&&(j=new L.Marker([s[m].getAttribute("lat"),s[m].getAttribute("lon")],{clickable:e.marker_options.clickable,icon:L.divIcon({html:'<i class="fa fa-comment">',iconSize:[25,25],iconAnchor:[12,12],popupAnchor:[2,-20],className:"waypoint-marker"})}).on("mouseover",function(t){this.openPopup()}),O=s[m],D='<div class="tooltip-top"><span class="source"><i class="fa fa-location-arrow"></i> '+sblang.position_report,0<O.getElementsByTagName("source").length&&(D+=" via "+O.getElementsByTagName("source")[0].textContent),D+="</span>",D+='</div><div class="tooltip-body"><p>',0<O.getElementsByTagName("time").length&&(D+=new Date(C).ddmmyyyyhhmm()+"<br>"),D+=deg_to_dms(s[m].getAttribute("lat"),"lat")+" "+deg_to_dms(s[m].getAttribute("lon"),"lng")+"<br>",0<O.getElementsByTagName("country_code").length&&2===O.getElementsByTagName("country_code")[0].textContent.length&&(D+='<span class="country"><img width="24" height="24" src="https://www.skipperblogs.com/assets/img/country-flags/24x24/'+O.getElementsByTagName("country_code")[0].textContent+'.png">'+O.getElementsByTagName("country_name")[0].textContent+"</span><br>"),0<O.getElementsByTagName("course").length&&0<O.getElementsByTagName("course")[0].textContent.length&&(D+="<br>"+sblang.course+" "+O.getElementsByTagName("course")[0].textContent+""),0<O.getElementsByTagName("speed").length&&0<O.getElementsByTagName("speed")[0].textContent.length&&(D+="<br>"+sblang.speed+" "+O.getElementsByTagName("speed")[0].textContent+"kts<br>"),D+="</p>",0<O.getElementsByTagName("weathercode").length&&(D+='<span class="weather">',0<O.getElementsByTagName("period").length&&"night"===O.getElementsByTagName("period")[0].textContent?D+='<span class="code"><img  width="90" height="70" src="https://www.skipperblogs.com/assets/img/weather-icons/codes/'+O.getElementsByTagName("weathercode")[0].textContent+'_night.svg"></span>':D+='<span class="code"><img  width="90" height="70" src="https://www.skipperblogs.com/assets/img/weather-icons/codes/'+O.getElementsByTagName("weathercode")[0].textContent+'.svg"></span>',0<O.getElementsByTagName("pressure").length&&(D+='<i><img width="30" height="30" src="https://www.skipperblogs.com/assets/img/weather-icons/fill/final/barometer.svg"> '+O.getElementsByTagName("pressure")[0].textContent+" hPa</i>"),0<O.getElementsByTagName("temperature").length&&(D+='<i><img width="30" height="30" src="https://www.skipperblogs.com/assets/img/weather-icons/fill/final/thermometer-celsius.svg"> '+O.getElementsByTagName("temperature")[0].textContent+"C</i>"),0<O.getElementsByTagName("windspeed").length&&0<O.getElementsByTagName("winddirection").length&&(D+='<i><img width="30" height="30" src="https://www.skipperblogs.com/assets/img/weather-icons/fill/final/windsock.svg"> '+O.getElementsByTagName("windspeed")[0].textContent+" "+sblang.speed_unit+" "+O.getElementsByTagName("winddirection")[0].textContent+"</i>"),D+="</span>"),0<O.getElementsByTagName("text").length&&(D+='<div class="comment"><p><i class="fa fa-comment"></i> '+O.getElementsByTagName("text")[0].textContent+"</p></div>"),D+="</div>",R=L.responsivePopup({className:"popup_waypoint_text",closeButton:!1,offset:new L.Point(-20,20)}).setContent(D),j.addTo(h).bindPopup(R),j.on("mouseover",function(t){this.openPopup()}),0<O.getElementsByTagName("text").length&&(this.fire("addpoint",{point:j,point_type:"waypoint",element:s[s.length-1]}),u.push(j))),o.include_in_stats&&(0<(f=s[m].getElementsByTagNameNS("*","hr")).length&&(g.meta.hr=parseInt(f[0].textContent),this._info.hr._points.push([this._info.length,g.meta.hr]),this._info.hr._total+=g.meta.hr),0<(f=s[m].getElementsByTagNameNS("*","cad")).length&&(g.meta.cad=parseInt(f[0].textContent),this._info.cad._points.push([this._info.length,g.meta.cad]),this._info.cad._total+=g.meta.cad),0<(f=s[m].getElementsByTagNameNS("*","atemp")).length&&(g.meta.atemp=parseInt(f[0].textContent),this._info.atemp._points.push([this._info.length,g.meta.atemp]),this._info.atemp._total+=g.meta.atemp),g.meta.ele>this._info.elevation.max&&(this._info.elevation.max=g.meta.ele),g.meta.ele<this._info.elevation.min&&(this._info.elevation.min=g.meta.ele),this._info.elevation._points.push([this._info.length,g.meta.ele]),g.meta.speed>this._info.speed.max&&(this._info.speed.max=g.meta.speed),this._info.speed._points.push([this._info.length,g.meta.speed]),null==p&&null==this._info.duration.start&&(this._info.duration.start=g.meta.time),this._info.duration.end=g.meta.time,this._info.duration.total+=y,y<e.max_point_interval&&(this._info.duration.moving+=y),this._info.length+=w,0<x?this._info.elevation.gain+=x:this._info.elevation.loss+=Math.abs(x)),l.push(p=g)}if(0<d.length){var B=0;for(m=0;m<d.length;m++)B+=d[m];avg_speed_imp=B/d.length}for(var i=this._extract_styling(t,i,e.polyline_options),I=l[0],N=!1,A=!1,Z=0;Z<l.length;Z++)I.lng<0&&0<l[Z].lng&&90<l[Z].lng?A=!(N=!0):N=0<I.lng&&l[Z].lng<0&&l[Z].lng<-90?!(A=!0):A=!1,N?l[Z].lng=l[Z].lng-360:A&&(l[Z].lng=l[Z].lng+360),I=l[Z];i.track_id=o.track_id,i.track_type=o.track_type,i.track_name=o.track_name,i.track_coords=l;var O,D,R,U=new L.Polyline(l,i);if(setTimeout(function(){U.bringToBack()},1e3),(!e.load_only_tracking||e.load_only_tracking&&"tracking"===o.track_type)&&(this.fire("addline",{line:U,element:t,track_type:o.track_type,track_id:o.track_id}),u.push(U)),1<l.length&&(e.marker_options.startIcon||e.marker_options.startIconUrl&&"tracking"===o.track_type)&&(j=new L.Marker(l[0],{clickable:e.marker_options.clickable,icon:e.marker_options.startIcon||new L.GPXTrackIcon({iconUrl:e.marker_options.startIconUrl,className:"start-marker",iconAnchor:[6,44]})}),D='<div class="tooltip-body"><strong class="title">'+sblang.track_departure+'<br><small class="date">'+formatDate(this._info.duration.start)+'</small></strong></div><div class="tooltip-body"><p style="margin-bottom: 0"></p></div>',R=L.responsivePopup({closeButton:!1,offset:new L.Point(-40,20),className:"popup_departure popup_no-img"}).setContent(D),j.addTo(h).bindPopup(R).on("mouseover",function(t){this.openPopup()}),this.fire("addpoint",{point:j,track_type:o.track_type,point_type:"start",element:s[0]}),u.push(j)),"tracking"===o.track_type&&null!==o.boat_icon?(i=!0,void 0!==l[l.length-2]&&(i=l[l.length-1].lng<l[l.length-2].lng),t=o.boat_icon,i&&(t=(i=o.boat_icon.split("."))[0]+"-reverse."+i[1]),j=new L.Marker(l[l.length-1],{clickable:e.marker_options.clickable,icon:L.icon({iconUrl:"https://www.skipperblogs.com/"+t,iconSize:[40,40],iconAnchor:[20,20],popupAnchor:[2,-20],className:"boat-marker"})}),this._info.last_pos=deg_to_dms(l[l.length-1].lat,"lat")+" "+deg_to_dms(l[l.length-1].lng,"lng"),this._info.boat_marker=j,this._info.track_tracking=U,O=s[s.length-1],D='<div class="tooltip-top"><span class="source"><i class="fa fa-location-arrow"></i> '+sblang.last_position,0<O.getElementsByTagName("source").length&&(D+=" via "+O.getElementsByTagName("source")[0].textContent),D+="</span>",D+='</div><div class="tooltip-body"><p>',D+=this._info.last_update+"<br>"+this._info.last_pos,0<O.getElementsByTagName("country_code").length&&2===O.getElementsByTagName("country_code")[0].textContent.length&&(D+='<br><span class="country"><img  src="https://www.skipperblogs.com/assets/img/country-flags/24x24/'+O.getElementsByTagName("country_code")[0].textContent+'.png">'+O.getElementsByTagName("country_name")[0].textContent+"</span>"),0<O.getElementsByTagName("course").length&&0<O.getElementsByTagName("course")[0].textContent.length&&(D+="<br>"+sblang.course+" "+O.getElementsByTagName("course")[0].textContent+""),0<O.getElementsByTagName("speed").length&&0<O.getElementsByTagName("speed")[0].textContent.length&&(D+="<br>"+sblang.speed+" "+O.getElementsByTagName("speed")[0].textContent+"kts<br>"),D+="</p>",0<O.getElementsByTagName("weathercode").length&&(D+='<span class="weather">',0<O.getElementsByTagName("period").length&&"night"===O.getElementsByTagName("period")[0].textContent?D+='<span class="code"><img  width="90" height="70" src="https://www.skipperblogs.com/assets/img/weather-icons/codes/'+O.getElementsByTagName("weathercode")[0].textContent+'_night.svg"></span>':D+='<span class="code"><img  width="90" height="70" src="https://www.skipperblogs.com/assets/img/weather-icons/codes/'+O.getElementsByTagName("weathercode")[0].textContent+'.svg"></span>',0<O.getElementsByTagName("pressure").length&&(D+='<i><img width="30" height="30" src="https://www.skipperblogs.com/assets/img/weather-icons/fill/final/barometer.svg"> '+O.getElementsByTagName("pressure")[0].textContent+" hPa</i>"),0<O.getElementsByTagName("temperature").length&&(D+='<i><img width="30" height="30" src="https://www.skipperblogs.com/assets/img/weather-icons/fill/final/thermometer-celsius.svg"> '+O.getElementsByTagName("temperature")[0].textContent+"C</i>"),0<O.getElementsByTagName("windspeed").length&&0<O.getElementsByTagName("winddirection").length&&(D+='<i><img width="30" height="30" src="https://www.skipperblogs.com/assets/img/weather-icons/fill/final/windsock.svg"> '+O.getElementsByTagName("windspeed")[0].textContent+sblang.speed_unit+" "+O.getElementsByTagName("winddirection")[0].textContent+"</i>"),D+="</span>"),0<O.getElementsByTagName("text").length&&(D+='<div class="comment"><p>'+O.getElementsByTagName("text")[0].textContent+"</p></div>"),D+="</div>",R=L.responsivePopup({className:"popup_waypoint_text",closeButton:!1,offset:new L.Point(-20,20)}).setContent(D),j.addTo(h).bindPopup(R),j.on("mouseover",function(t){this.openPopup()}).on("mouseout",function(){this.closePopup()}),this.fire("addpoint",{point:j,track_type:o.track_type,point_type:"end",element:s[s.length-1]}),u.push(j)):(e.marker_options.endIcon||e.marker_options.endIconUrl&&"tracking"===o.track_type)&&(j=new L.Marker(l[l.length-1],{clickable:e.marker_options.clickable,icon:e.marker_options.endIcon||new L.GPXTrackIcon({iconUrl:e.marker_options.endIconUrl})}),this.fire("addpoint",{point:j,point_type:"end",track_type:o.track_type,element:s[s.length-1]}),u.push(j)),e.load_markers)for(m=0;m<c.length;m++){var j=new L.Marker(c[m].coords,{clickable:e.marker_options.clickable,title:c[m].label,icon:c[m].icon});this.fire("addpoint",{point:j,point_type:"label",element:c[m].element}),u.push(j)}return u},_extract_styling:function(t,e,i){var n=this._merge_objs(_DEFAULT_POLYLINE_OPTS,e),e=t.getElementsByTagNameNS(_GPX_STYLE_NS,"line");return 0<e.length&&(0<(t=e[0].getElementsByTagName("color")).length&&(n.color="#"+t[0].textContent),0<(t=e[0].getElementsByTagName("opacity")).length&&(n.opacity=t[0].textContent),0<(t=e[0].getElementsByTagName("weight")).length&&(n.weight=t[0].textContent),0<(t=e[0].getElementsByTagName("linecap")).length&&(n.lineCap=t[0].textContent),0<(t=e[0].getElementsByTagName("linejoin")).length&&(n.lineJoin=t[0].textContent),0<(t=e[0].getElementsByTagName("dasharray")).length&&(n.dashArray=t[0].textContent),0<(t=e[0].getElementsByTagName("dashoffset")).length&&(n.dashOffset=t[0].textContent),0<(t=e[0].getElementsByTagName("hidden")).length&&(n.hidden=!!+t[0].textContent),0<(t=e[0].getElementsByTagName("include_in_stats")).length&&(n.include_in_stats=!!+t[0].textContent)),this._merge_objs(n,i)},_dist2d:function(t,e){var i=this._deg2rad(e.lat-t.lat),n=this._deg2rad(e.lng-t.lng),n=Math.sin(i/2)*Math.sin(i/2)+Math.cos(this._deg2rad(t.lat))*Math.cos(this._deg2rad(e.lat))*Math.sin(n/2)*Math.sin(n/2);return 6371e3*(2*Math.atan2(Math.sqrt(n),Math.sqrt(1-n)))},_dist3d:function(t,e){var i=this._dist2d(t,e),t=Math.abs(e.meta.ele-t.meta.ele);return Math.sqrt(Math.pow(i,2)+Math.pow(t,2))},_deg2rad:function(t){return t*Math.PI/180}}),"object"==typeof module&&"object"==typeof module.exports?module.exports=L:"function"==typeof define&&define.amd&&define(L),L.ResponsivePopup=L.Popup.extend({options:{hasTip:!0},_initLayout:function(){var t="leaflet-popup",e=this._container=L.DomUtil.create("div",t+" "+(this.options.className||"")+" leaflet-zoom-animated"),i=this._wrapper=L.DomUtil.create("div",t+"-content-wrapper",e);this._contentNode=L.DomUtil.create("div",t+"-content",i),L.DomEvent.disableClickPropagation(e),L.DomEvent.disableScrollPropagation(this._contentNode),L.DomEvent.on(e,"contextmenu",L.DomEvent.stopPropagation),this._tipContainer=L.DomUtil.create("div",t+"-tip-container",e),this.options.hasTip||(this._tipContainer.style.visibility="hidden"),this._tip=L.DomUtil.create("div",t+"-tip",this._tipContainer),this.options.closeButton&&((e=this._closeButton=L.DomUtil.create("a",t+"-close-button",e)).setAttribute("role","button"),e.setAttribute("aria-label","Close popup"),e.href="#close",e.innerHTML='<span aria-hidden="true">&#215;</span>',L.DomEvent.on(e,"click",function(t){L.DomEvent.preventDefault(t),this.close()},this))},_updatePosition:function(){var t,e,i,n,o,s,a,r,h,l,c,u,p,d,_,m,f,g,y;this._map&&(g=this._map.latLngToLayerPoint(this._latlng),t=this._map.layerPointToContainerPoint(g),e=this._container.offsetWidth,i=this._container.offsetHeight,d=L.point(this.options.autoPanPadding),n=L.point(this.options.autoPanPaddingTopLeft||d),o=L.point(this.options.autoPanPaddingBottomRight||d),s=this._map.getSize(),a=this._getAnchor(),_=L.point(this.options.offset),r=Math.abs(_.x),h=Math.abs(_.y),this.options.hasTip&&(r+=11,h+=11,L.DomUtil.removeClass(this._container,"leaflet-resp-popup-north"),L.DomUtil.removeClass(this._container,"leaflet-resp-popup-south"),L.DomUtil.removeClass(this._container,"leaflet-resp-popup-east"),L.DomUtil.removeClass(this._container,"leaflet-resp-popup-west"),L.DomUtil.removeClass(this._container,"leaflet-resp-popup-north-east"),L.DomUtil.removeClass(this._container,"leaflet-resp-popup-north-west"),L.DomUtil.removeClass(this._container,"leaflet-resp-popup-south-east"),L.DomUtil.removeClass(this._container,"leaflet-resp-popup-south-west"),L.DomUtil.removeClass(this._container,"leaflet-resp-popup-east-north"),L.DomUtil.removeClass(this._container,"leaflet-resp-popup-east-south"),L.DomUtil.removeClass(this._container,"leaflet-resp-popup-west-north"),L.DomUtil.removeClass(this._container,"leaflet-resp-popup-west-south")),y=!(p=u=c=l=!0),t.y+a.y-h-i-Math.abs(n.y)<0&&(l=!1),t.y+a.y+h+i+Math.abs(o.y)>s.y&&(c=!1),t.x+a.x-r-e-Math.abs(n.x)<0&&(u=!1),t.x+a.x+r+e+Math.abs(o.x)>s.x&&(p=!1),d=e/2-a.x,_=i/2-a.y,(l||c)&&(m=t.x+a.x-e/2,f=t.x+a.x+e/2,m<Math.abs(n.x)&&(d=e/2-a.x-Math.abs(n.x)+m),f>s.x-Math.abs(o.x)&&(d=e/2-a.x+f-s.x+Math.abs(o.x))),(u||p)&&(m=t.y+a.y-i/2,f=t.y+a.y+i/2,m<Math.abs(n.y)&&(_=i/2-a.y-Math.abs(n.y)+m),f>s.y-Math.abs(o.y)&&(_=i/2-a.y+f-s.y+Math.abs(o.y))),l?(y=g.subtract(L.point(d,-a.y+i+h,!0)),this.options.hasTip&&(t.x+a.x<n.x+12+11?(y.x=g.x+a.x,L.DomUtil.addClass(this._container,"leaflet-resp-popup-north-east"),this._tipContainer.style.top=i+"px",this._tipContainer.style.left="0px"):t.x+a.x>s.x-o.x-12-11?(y.x=g.x+a.x-e,L.DomUtil.addClass(this._container,"leaflet-resp-popup-north-west"),this._tipContainer.style.top=i+"px",this._tipContainer.style.left=e+"px"):(L.DomUtil.addClass(this._container,"leaflet-resp-popup-north"),this._tipContainer.style.top=i+"px",this._tipContainer.style.left=g.x+a.x-y.x+"px"))):u?(y=g.subtract(L.point(-a.x+e+r,_,!0)),this.options.hasTip&&(t.y+a.y<n.y+12+11?(y.y=g.y+a.y,L.DomUtil.addClass(this._container,"leaflet-resp-popup-west-south"),this._tipContainer.style.top="0px"):t.y+a.y>s.y-o.y-12-11?(y.y=g.y+a.y-i,L.DomUtil.addClass(this._container,"leaflet-resp-popup-west-north"),this._tipContainer.style.top=i+"px"):(L.DomUtil.addClass(this._container,"leaflet-resp-popup-west"),this._tipContainer.style.top=g.y+a.y-y.y+"px"),this._tipContainer.style.left=e+"px")):c?(y=g.subtract(L.point(d,-a.y-h,!0)),this.options.hasTip&&(t.x+a.x<n.x+12+11?(y.x=g.x+a.x,L.DomUtil.addClass(this._container,"leaflet-resp-popup-south-east"),this._tipContainer.style.top="0px",this._tipContainer.style.left="0px"):t.x+a.x>s.x-o.x-12-11?(y.x=g.x+a.x-e,L.DomUtil.addClass(this._container,"leaflet-resp-popup-south-west"),this._tipContainer.style.top="0px",this._tipContainer.style.left=e+"px"):(L.DomUtil.addClass(this._container,"leaflet-resp-popup-south"),this._tipContainer.style.top="0px",this._tipContainer.style.left=g.x+a.x-y.x+"px"))):p?(y=g.subtract(L.point(-a.x-r,_,!0)),this.options.hasTip&&(t.y+a.y<n.y+12+11?(y.y=g.y+a.y,L.DomUtil.addClass(this._container,"leaflet-resp-popup-east-south"),this._tipContainer.style.top="0px"):t.y+a.y>s.y-o.y-12-11?(y.y=g.y+a.y-i,L.DomUtil.addClass(this._container,"leaflet-resp-popup-east-north"),this._tipContainer.style.top=i+"px"):(L.DomUtil.addClass(this._container,"leaflet-resp-popup-east"),this._tipContainer.style.top=g.y+a.y-y.y+"px"),this._tipContainer.style.left="0px")):(y=(g=this._map.latLngToLayerPoint(this._map.getCenter())).subtract(L.point(e/2,i/2)),this.options.hasTip),t.x<0||t.y<0||t.x>s.x||(t.y,s.y),e-Math.abs(n.x)-Math.abs(o.x)>s.x||(Math.abs(n.y),Math.abs(o.y),s.y),L.DomUtil.setPosition(this._container,y))}}),L.responsivePopup=function(t,e){return new L.ResponsivePopup(t,e)},"object"==typeof exports&&"undefined"!=typeof module&&(exports.responsivePopup=L.responsivePopup,exports.ResponsivePopup=L.ResponsivePopup),$(document).ready(function(){void 0===navigation_initialized&&(navigation_initialized=!0),"undefined"!=typeof map_override&&!1!==map_override||($("#map").length&&navigation_initialized?(mapLoader(3e4),initMainMap($("#map"))):$("#windy").length&&navigation_initialized?(mapLoader(3e4),initWindyMap($("#windy"))):navigation_initialized?0<$(".widget-map-stats").length&&getOnlyMapStats():$("#map,#windy").addClass("mapnotinit").append("<div>"+sblang.map_not_init+"</div>"))}),function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("leaflet")):"function"==typeof define&&define.amd?define(["leaflet"],e):(t.L=t.L||{},t.L.terminator=e(t.L))}(this,function(e){"use strict";var i=(e=e&&e.hasOwnProperty("default")?e.default:e).Polygon.extend({options:{color:"#00",opacity:.5,fillColor:"#00",fillOpacity:.5,resolution:2},initialize:function(t){this.version="0.1.0",this._R2D=180/Math.PI,this._D2R=Math.PI/180,e.Util.setOptions(this,t);t=this._compute(this.options.time);this.setLatLngs(t)},setTime:function(t){this.options.time=t;t=this._compute(t);this.setLatLngs(t)},_sunEclipticPosition:function(t){var e=t-2451545,t=280.46+.9856474*e,e=357.528+.9856003*e;return e%=360,{lambda:(t%=360)+1.915*Math.sin(e*this._D2R)+.02*Math.sin(2*e*this._D2R),R:1.00014-.01671*Math.cos(e*this._D2R)-.0014*Math.cos(2*e*this._D2R)}},_eclipticObliquity:function(t){t=(t-2451545)/36525;return 23.43929111-t*(46.836769/3600-t*(1831e-7/3600+t*(5.565e-7-t*(1.6e-10-4.34e-8*t/3600))))},_sunEquatorialPosition:function(t,e){var i=Math.atan(Math.cos(e*this._D2R)*Math.tan(t*this._D2R))*this._R2D,e=Math.asin(Math.sin(e*this._D2R)*Math.sin(t*this._D2R))*this._R2D;return{alpha:i=90*Math.floor(t/90)-90*Math.floor(i/90)+i,delta:e}},_hourAngle:function(t,e,i){return 15*(i+t/15)-e.alpha},_latitude:function(t,e){return Math.atan(-Math.cos(t*this._D2R)/Math.tan(e.delta*this._D2R))*this._R2D},_compute:function(t){for(var e=(t?new Date(t):new Date)/864e5+2440587.5,i=(18.697374558+24.06570982441908*(e-2451545))%24,n=[],t=this._sunEclipticPosition(e),e=this._eclipticObliquity(e),o=this._sunEquatorialPosition(t.lambda,e),s=0;s<=720*this.options.resolution;s++){var a=s/this.options.resolution-360,r=this._hourAngle(a,o,i);n[s+1]=[this._latitude(r,o),a]}return o.delta<0?(n[0]=[90,-360],n[n.length]=[90,360]):(n[0]=[-90,-360],n[n.length]=[-90,360]),n}});return function(t){return new i(t)}}),$(document).on("click",".tooltip-top.link",function(){window.location=$(this).data("url")});var k=[38,38,40,40,37,39,37,39,66,65],n=0;$(document).keydown(function(t){if(t.keyCode===k[n++]){if(n===k.length){L.tileLayer("https://map1.vis.earthdata.nasa.gov/wmts-webmerc/VIIRS_CityLights_2012/default/{time}/{tilematrixset}{maxZoom}/{z}/{y}/{x}.{format}",{attribution:'Imagery provided by services from the Global Imagery Browse Services (GIBS), operated by the NASA/GSFC/Earth Science Data and Information System (<a href="https://earthdata.nasa.gov">ESDIS</a>) with funding provided by NASA/HQ.',bounds:[[-85.0511287776,-179.999999975],[85.0511287776,179.999999975]],minZoom:1,maxZoom:8,format:"jpg",time:"",tilematrixset:"GoogleMapsCompatible_Level"}).addTo(map);return n=0,!1}}else n=0});